<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> Hexo </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>
<a href="https://github.com/anguoli"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hexo</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-something">
          <a href="/something" rel="section">
            
            那你你你你
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/18/Runtime1/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/18/Runtime1/" itemprop="url">
                  Runtime原理探究
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-18T09:34:26+08:00">
                2017-12-18
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、Runtime简介"><a href="#一、Runtime简介" class="headerlink" title="一、Runtime简介"></a>一、Runtime简介</h2><p>Runtime简称运行时。OC就是运行时机制，也就是在运行时候的一些机制，其中最主要的是消息机制。</p>
<ul>
<li>对于C语言，函数的调用在编译的时候会决定调用哪个函数。</li>
<li>对于OC的函数，属于<code>动态调用过程</code>，在编译的时候并不能决定真正调用哪个函数，只有在真正运行的时候才会根据函数的名称找到对应的函数来调用。</li>
<li>事实证明：</li>
<li>在编译阶段，OC可以调用任何函数，即使这个函数并未实现，只要声明过就不会报错。</li>
<li>在编译阶段，C语言调用未实现的函数就会报错。</li>
<li>如果向某个对象传递消息，在底层，所有的方法都是普通的C语言函数，然而对象收到消息之后，究竟该调用哪个方法则完全取决于运行期决定，甚至可能在运行期改变，这些特性使得Objective-C变成一门真正的动态语言。</li>
<li>在Runtime中，对象可以用C语言中的结构体表示，而方法可以用C函数来实现，另外再加上了一些额外的特性。这些结构体和函数被Runtime函数封装后，让OC的面向对象编程变为可能。</li>
</ul>
<h2 id="二、Objective-C中的数据结构"><a href="#二、Objective-C中的数据结构" class="headerlink" title="二、Objective-C中的数据结构"></a>二、Objective-C中的数据结构</h2><p>描述Objective-C对象所有的数据结构定义都在Runtime的头文件里，下面我们逐一分析。</p>
<h3 id="1-id"><a href="#1-id" class="headerlink" title="1.id"></a>1.id</h3><p>运行期系统如何知道某个对象的类型呢？对象类型并不是在编译期就知道了，而是要在运行期查找。Objective-C有个特殊的类型id，它可以表示Objective-C的任意对象类型，id类型定义在Runtime的头文件中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">struct objc_object &#123;</div><div class="line">Class isa;</div><div class="line">&#125; *id;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>由此可见，每个对象结构体的首个成员是Class类的变量。该变量定义了对象所属的类，通常称为isa指针。</p>
</blockquote>
<h3 id="objc-object"><a href="#objc-object" class="headerlink" title="objc_object"></a>objc_object</h3><p>objc_object是表示一个类的实例的结构体<br>它的定义如下(objc/objc.h)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">struct objc_object&#123;</div><div class="line">Class isa OBJC_ISA_AVAILABILITY;</div><div class="line">&#125;;</div><div class="line">typedef struct objc_object *id;</div></pre></td></tr></table></figure></p>
<p>可以看到，这个结构体只有一个字体，即指向其类的isa指针。这样，当我们向一个Objective-C对象发送消息时，运行时库会根据实例对象的isa指针找到这个实例对象所属的类。Runtime库会在类的方法列表及父类的方法列表中去寻找与消息对应的selector指向的方法，找到后即运行这个方法。</p>
<h3 id="2-Class"><a href="#2-Class" class="headerlink" title="2.Class"></a>2.Class</h3><p>Class对象也定义在Runtime的头文件中,查看objc/runtime.h中的objc_class结构体：<br>Objective-C中,类是由Class类型来表示的，它实际上是一个指<br>向objc_class结构体的指针。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">typedef struct objc_class *Class;</div><div class="line"></div><div class="line">struct objc_class &#123;</div><div class="line">Class isa                                 OBJC_ISA_AVAILABILITY;</div><div class="line">#if !__OBJC2__</div><div class="line">Class super_class                         OBJC2_UNAVAILABLE;   // 父类</div><div class="line">const char *name                          OBJC2_UNAVAILABLE;   // 类名</div><div class="line">long version                              OBJC2_UNAVAILABLE;   // 类的版本信息，默认为0</div><div class="line">long info                                 OBJC2_UNAVAILABLE;   // 类信息，供运行期使用的一些位标识</div><div class="line">long instance_size                        OBJC2_UNAVAILABLE;   // 该类的实例变量大小</div><div class="line">struct objc_ivar_list *ivars              OBJC2_UNAVAILABLE;   // 该类的成员变量链表</div><div class="line">struct objc_method_list **methodLists     OBJC2_UNAVAILABLE;   // 方法定义的链表</div><div class="line">struct objc_cache *cache                  OBJC2_UNAVAILABLE;   // 方法缓存</div><div class="line">struct objc_protocol_list *protocols      OBJC2_UNAVAILABLE;   // 协议链表</div><div class="line">#endif</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>下面说下Class的结构体中的几个主要变量：</p>
<ul>
<li>1.isa：<br>结构体的首个变量也是isa指针，这说明Class本身也是Objective-C中的对象。isa指针非常重要, 对象需要通过isa指针找到它的类, 类需要通过isa找到它的元类. 这在调用实例方法和类方法的时候起到重要的作用.</li>
<li>2.super_class：<br>结构体里还有个变量是super_class，它定义了本类的超类。类对象所属类型（isa指针所指向的类型）是另外一个类，叫做“元类”。</li>
<li>3.ivars：<br>成员变量列表，类的成员变量都在ivars里面。</li>
<li>4.methodLists：<br>方法列表，类的实例方法都在methodLists里，类方法在元类的methodLists里面。methodLists是一个指针的指针，通过修改该指针指向指针的值，就可以动态的为某一个类添加成员方法。这也就是Category实现的原理，同时也说明了Category只可以为对象添加成员方法，不能添加成员变量。</li>
<li>5.cache：<br>方法缓存列表，objc_msgSend（下文详解）每调用一次方法后，就会把该方法缓存到cache列表中，下次调用的时候，会优先从cache列表中寻找，如果cache没有，才从methodLists中查找方法。提高效率。</li>
</ul>
<h3 id="元类-Meta-Class"><a href="#元类-Meta-Class" class="headerlink" title="元类(Meta Class)"></a>元类(Meta Class)</h3><p>meta-class是一个类对象的类。<br>在上面我们提到，所有的类自身也是一个对象，我们可以向这个对象发送消息(即调用类方法)。既然是对象，那么它也是一个objc_object指针，它包含一个指向其类的一个isa指针。那么，这个isa指针指向什么呢？<br>为了调用类方法，这个类的isa指针必须指向一个包含这些类方法的一个objc_class结构体。这就引出了meta-class的概念，meta-class中存储着一个类的所有类方法。<br>所以，调用类方法的这个类对象的isa指针指向的就是meta-class<br>当我们向一个对象发送消息时，runtime会在这个对象所属的这个类的方法列表中查找方法；而向一个类发送消息时，会在这个类的meta-class的方法列表中查找。</p>
<p>再深入一下，meta-class也是一个类，也可以向它发送一个消息，那么它的isa又是指向什么呢？为了不让这种结构无限延伸下去，Objective-C的设计者让所有的meta-class的isa指向基类的meta-class，以此作为它们的所属类。</p>
<p>即，任何NSObject继承体系下的meta-class都使用NSObject的meta-class作为自己的所属类，而基类的meta-class的isa指针是指向它自己。</p>
<p>通过上面的描述，再加上对objc_class结构体中super_class指针的分析，我们就可以描绘出类及相应meta-class类的一个继承体系了，如下代码</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-47250191c7f985ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>看图说话：<br>上图中：superclass指针代表继承关系，isa指针代表实例所属的类。<br>类也是一个对象，它是另外一个类的实例，这个就是“元类”，元类里面保存了类方法的列表，类里面保存了实例方法的列表。实例对象的isa指向类，类对象的isa指向元类，元类对象的isa指针指向一个“根元类”（root metaclass）。所有子类的元类都继承父类的元类，换而言之，类对象和元类对象有着同样的继承关系。</p>
<blockquote>
<p>1.Class是一个指向objc_class结构体的指针，而id是一个指向objc_object结构体的指针，其中的isa是一个指向objc_class结构体的指针。其中的id就是我们所说的对象，Class就是我们所说的类。<br>2.isa指针不总是指向实例对象所属的类，不能依靠它来确定类型，而是应该用isKindOfClass:方法来确定实例对象的类。因为KVO的实现机制就是将被观察对象的isa指针指向一个中间类而不是真实的类。</p>
<h3 id="Category"><a href="#Category" class="headerlink" title="Category"></a>Category</h3><p>Category是表示一个指向分类的结构体的指针，其定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">typedef struct objc_category *Category</div><div class="line">struct objc_category&#123;</div><div class="line">char *category_name                         OBJC2_UNAVAILABLE; // 分类名</div><div class="line">char *class_name                            OBJC2_UNAVAILABLE;  // 分类所属的类名</div><div class="line">struct objc_method_list *instance_methods   OBJC2_UNAVAILABLE;  // 实例方法列表</div><div class="line">struct objc_method_list *class_methods      OBJC2_UNAVAILABLE; // 类方法列表</div><div class="line">struct objc_protocol_list *protocols        OBJC2_UNAVAILABLE; // 分类所实现的协议列表</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<p>这个结构体主要包含了分类定义的实例方法与类方法，其中instance_methods列表是objc_class中方法列表的一个子集，而class_methods列表是元类方法列表的一个子集。<br>可发现，类别中没有ivar成员变量指针，也就意味着：类别中不能够添加实例变量和属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">struct objc_ivar_list *ivars             OBJC2_UNAVAILABLE;  // 该类的成员变量链表</div></pre></td></tr></table></figure></p>
<h3 id="3-SEL"><a href="#3-SEL" class="headerlink" title="3.SEL"></a>3.SEL</h3><p>//// <a href="http://www.jianshu.com/p/3e050ec3b759" target="_blank" rel="external">http://www.jianshu.com/p/3e050ec3b759</a><br>SEL是选择子的类型，选择子指的就是方法的名字。在Runtime的头文件中的定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">typedef struct objc_selector *SEL;</div></pre></td></tr></table></figure></p>
<p>它就是个映射到方法的C字符串，SEL类型代表着方法的签名，在类对象的方法列表中存储着该签名与方法代码的对应关系，每个方法都有一个与之对应的SEL类型的对象，根据一个SEL对象就可以找到方法的地址，进而调用方法。<br>////<a href="http://www.jianshu.com/p/adf0d566c887" target="_blank" rel="external">http://www.jianshu.com/p/adf0d566c887</a><br>SEL又叫选择器，是表示一个方法的selector的指针，其定义如下：<br>方法的selector用于表示运行时方法的名字。Objective-C在编译时，会依据每一个方法的名字、参数序列，生成一个唯一的整型标识(Int类型的地址)，这个标识就是SEL。<br>两个类之间，只要方法名相同，那么方法的SEL就是一样的，每一个方法都对应着一个SEL。所以在Objective-C同一个类(及类的继承体系)中，不能存在2个同名的方法，即使参数类型不同也不行<br>如在某一个类中定义以下两个方法: 错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (void)setWidth:(int)width;</div><div class="line">- (void)setWidth:(double)width;</div></pre></td></tr></table></figure></p>
<p>当然，不同的类可以拥有相同的selector，这个没有问题。不同类的实例对象执行相同的selector时，会在各自的方法列表中去根据selector去寻找自己对应的IMP。<br>工程中的所有的SEL组成一个Set集合，如果我们想到这个方法集合中查找某个方法时，只需要去找到这个方法对应的SEL就行了，SEL实际上就是根据方法名hash化了的一个字符串，而对于字符串的比较仅仅需要比较他们的地址就可以了，可以说速度上无语伦比！<br>本质上，SEL只是一个指向方法的指针（准确的说，只是一个根据方法名hash化了的KEY值，能唯一代表一个方法），它的存在只是为了加快方法的查询速度。<br>@selector()就是取类方法的编号<br>通过下面三种方法可以获取SEL:<br>a、sel_registerName函数<br>b、Objective-C编译器提供的@selector()<br>c、NSSelectorFromString()方法</p>
<h3 id="4-Method"><a href="#4-Method" class="headerlink" title="4.Method"></a>4.Method</h3><p>Method代表类中的某个方法的类型，在Runtime的头文件中的定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">typedef struct objc_method *Method;</div></pre></td></tr></table></figure></p>
<p>objc_method的结构体定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">struct objc_method&#123;</div><div class="line">SEL method_name      OBJC2_UNAVAILABLE; // 方法名</div><div class="line">char *method_types   OBJC2_UNAVAILABLE;</div><div class="line">IMP method_imp       OBJC2_UNAVAILABLE; // 方法实现</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>1.method_name：方法名。</li>
<li>2.method_types：方法类型，主要存储着方法的参数类型和返回值类型。</li>
<li>3.IMP：方法的实现，函数指针。（下文详解）<br><code>class_copyMethodList(Class cls, unsigned int *outCount)</code>可以使用这个方法获取某个类的成员方法列表。</li>
</ul>
<p>////<br>Method用于表示类定义中的方法<br>我们可以看到该结构体中包含一个SEL和IMP，实际上相当于在SEL和IMP之间作了一个映射。有了SEL，我们便可以找到对应的IMP，从而调用方法的实现代码。</p>
<h3 id="5-Ivar"><a href="#5-Ivar" class="headerlink" title="5.Ivar"></a>5.Ivar</h3><p>Ivar代表类中实例变量的类型，在Runtime的头文件中的定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">typedef struct objc_ivar *Ivar;</div></pre></td></tr></table></figure></p>
<p>objc_ivar的定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">struct objc_ivar &#123;</div><div class="line">char *ivar_name                   OBJC2_UNAVAILABLE;</div><div class="line">char *ivar_type                   OBJC2_UNAVAILABLE;</div><div class="line">int ivar_offset                   OBJC2_UNAVAILABLE;</div><div class="line">#ifdef __LP64__</div><div class="line">int space                         OBJC2_UNAVAILABLE;</div><div class="line">#endif</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>class_copyIvarList(Class cls, unsigned int *outCount)</code> 可以使用这个方法获取某个类的成员变量列表。</p>
<h3 id="6-objc-property-t"><a href="#6-objc-property-t" class="headerlink" title="6.objc_property_t"></a>6.objc_property_t</h3><p>objc_property_t是属性，在Runtime的头文件中的的定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">typedef struct objc_property *objc_property_t;</div></pre></td></tr></table></figure></p>
<p><code>class_copyPropertyList(Class cls, unsigned int *outCount)</code> 可以使用这个方法获取某个类的属性列表。</p>
<h3 id="7-IMP"><a href="#7-IMP" class="headerlink" title="7.IMP"></a>7.IMP</h3><p>IMP在Runtime的头文件中的的定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">typedef id (*IMP)(id, SEL, ...);</div></pre></td></tr></table></figure></p>
<p>IMP是一个函数指针，它是由编译器生成的。当你发起一个消息后，这个函数指针决定了最终执行哪段代码。<br>////<br>IMP实际上是一个函数指针，指向方法实现的地址。<br>其定义如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">id (*IMP)(id, SEL,...)</div></pre></td></tr></table></figure></p>
<p>第一个参数：是指向self的指针(如果是实例方法，则是类实例的内存地址；如果是类方法，则是指向元类的指针)<br>第二个参数：是方法选择器(selector)<br>接下来的参数：方法的参数列表。</p>
<p>前面介绍过的SEL就是为了查找方法的最终实现IMP的。由于每个方法对应唯一的SEL，因此我们可以通过SEL方便快速准确地获得它所对应的IMP，查找过程将在下面讨论。取得IMP后，我们就获得了执行这个方法代码的入口点，此时，我们就可以像调用普通的C语言函数一样来使用这个函数指针了。</p>
<h3 id="8-Cache"><a href="#8-Cache" class="headerlink" title="8.Cache"></a>8.Cache</h3><p>Cache在Runtime的头文件中的的定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">typedef struct objc_cache *Cache</div></pre></td></tr></table></figure></p>
<p>objc_cache的定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">struct objc_cache &#123;</div><div class="line">unsigned int mask                   OBJC2_UNAVAILABLE;</div><div class="line">unsigned int occupied               OBJC2_UNAVAILABLE;</div><div class="line">Method buckets[1]                   OBJC2_UNAVAILABLE;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>每调用一次方法后，不会直接在isa指向的类的方法列表（methodLists）中遍历查找能够响应消息的方法，因为这样效率太低。它会把该方法缓存到cache列表中，下次的时候，就直接优先从cache列表中寻找，如果cache没有，才从isa指向的类的方法列表（methodLists）中查找方法。提高效率。</p>
<h2 id="三-发送消息（objc-msgSend）"><a href="#三-发送消息（objc-msgSend）" class="headerlink" title="三.发送消息（objc_msgSend）"></a>三.发送消息（objc_msgSend）</h2><p>在Objective-C中，调用方法是经常使用的。用Objective-C的术语来说，这叫做“传递消息”（pass a message）。消息有“名称”（name）或者“选择子”（selector），也可以接受参数，而且可能还有返回值。<br>如果向某个对象传递消息，在底层，所有的方法都是普通的C语言函数，然而对象收到消息之后，究竟该调用哪个方法则完全取决于运行期决定，甚至可能在运行期改变，这些特性使得Objective-C变成一门真正的动态语言。<br>给对象发送消息可以这样来写：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">id returnValue = [someObject message:parm];</div></pre></td></tr></table></figure></p>
<p>someObject叫做“接收者”（receiver），message是“选择子”（selector），选择子和参数结合起来就叫做“消息”（message）。编译器看到此消息后，将其转换成C语言函数调用，所调用的函数乃是消息传递机制中的核心函数，叫做<code>objc_msgSend</code>，其原型如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">id objc_msgSend (id self, SEL _cmd, ...);</div></pre></td></tr></table></figure></p>
<p>后面的…表示这是个“参数个数可变的函数”，能接受两个或两个以上的参数。第一个参数是接收者（receiver），第二个参数是选择子（selector），后续参数就是消息中传递的那些参数（parm），其顺序不变。</p>
<p>编译器会把上面的那个消息转换成:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">id returnValue objc_mgSend(someObject, @selector(message:), parm);</div></pre></td></tr></table></figure></p>
<p><code>objc_msgSend</code>发送消息的原理：</p>
<ul>
<li>第一步：检测这个selector是不是要被忽略的。</li>
<li>第二步：检测这个target对象是不是nil对象。（nil对象执行任何一个方法都不会Crash，因为会被忽略掉）</li>
<li>第三步：首先会根据target(objc_object)对象的isa指针获取它所对应的类（objc_class）。</li>
<li>第四步：查看缓存中是否存在方法，系统把近期发送过的消息记录在其中，苹果认为这样可以提高效率: 优先在类（class）的cache里面查找是否有与选择子（selector）名称相符的方法。<br>如果有，则找到objc_method中的IMP类型（函数指针）的成员method_imp去找到实现内容，并执行;<br>如果缓存中没有命中，那么到该类的方法表(methodLists)查找该方法，依次从后往前查找。</li>
<li>第五步：如果没有在类（class）找到，再到父类（super_class）查找，直至根类。</li>
<li>第六步：一旦找到与选择子（selector）名称相符的方法，就跳至其实现代码。</li>
<li>第七步: 如果没有找到，就会执行消息转发（message forwarding）的第一步动态解析。</li>
</ul>
<p><strong>如果是调用类方法</strong><br>objc_class中的isa指向该类的元类(metaclass)<br>如果是调用类方法的话，那么就会利用objc_class中的成员isa找到元类(metaclass)，然后寻找方法，直至根metaclass,没有找到的话则仍然进入动态解析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#import &lt;objc/message.h&gt;</div><div class="line">// 创建person对象</div><div class="line">Person *p = [[Person alloc] init];</div><div class="line"></div><div class="line">// 调用对象方法</div><div class="line">[p eat];</div><div class="line"></div><div class="line">// 本质：让对象发送消息</div><div class="line">objc_msgSend(p, @selector(eat));</div><div class="line"></div><div class="line">// 调用类方法的方式：两种</div><div class="line">// 第一种通过类名调用</div><div class="line">[Person eat];</div><div class="line">// 第二种通过类对象调用</div><div class="line">[[Person class] eat];</div><div class="line"></div><div class="line">// 用类名调用类方法，底层会自动把类名转换成类对象调用</div><div class="line">// 本质：让类对象发送消息</div><div class="line">objc_msgSend([Person class], @selector(eat));</div></pre></td></tr></table></figure>
<ul>
<li>消息机制原理：对象根据方法编号SEL去映射表查找对应的方法实现<br><img src="http://upload-images.jianshu.io/upload_images/1742252-794ab74d4e98c578.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
</ul>
<h2 id="四-消息转发（message-forwarding）"><a href="#四-消息转发（message-forwarding）" class="headerlink" title="四.消息转发（message forwarding）"></a>四.消息转发（message forwarding）</h2><p>当一个对象能接收一个消息时，就会走正常的方法调用流程。但如果一个对象无法接收指定消息时，又会发生什么事呢？默认情况下，如果是以<code>[object message]</code>的方式调用方法，如果<code>object</code>无法响应<code>message</code>消息时，编译器会报错。但如果是以<code>perform...</code>的形式来调用，则需要等到运行时才能确定<code>object</code>是否能接收<code>message</code>消息。如果不能，则程序崩溃。</p>
<p>通常，当我们不能确定一个对象是否能接收某个消息时，会先调用respondsToSelector:来判断一下。如下代码所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if ([self respondsToSelector:@selector(method)]) &#123;</div><div class="line">[self performSelector:@selector(method)];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>不过，我们这边想讨论下不使用<code>respondsToSelector:</code>判断的情况。这才是我们这一节的重点。</p>
<p>当一个对象无法接收某一消息时，就会启动所谓<strong>消息转发(message forwarding)</strong>机制，通过这一机制，我们可以告诉对象如何处理未知的消息。默认情况下，对象接收到未知的消息，会导致程序崩溃，通过控制台，我们可以看到以下异常信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-[SUTRuntimeMethod method]: unrecognized selector sent to instance 0x100111940</div><div class="line">*** Terminating app due to uncaught exception &apos;NSInvalidArgumentException&apos;, reason: &apos;-[SUTRuntimeMethod method]: unrecognized selector sent to instance 0x100111940&apos;</div></pre></td></tr></table></figure></p>
<p>这段异常信息实际上是由NSObject的<code>doesNotRecognizeSelector</code>方法抛出的。不过，我们可以采取一些措施，让我们的程序执行特定的逻辑，而避免程序的崩溃。<br>消息转发机制基本上分为三个步骤：</p>
<ul>
<li>1.动态方法解析</li>
<li>2.备用接收者</li>
<li>3.完整转发<br>下面我们详细讨论一下这三个步骤。</li>
</ul>
<h2 id="动态方法解析"><a href="#动态方法解析" class="headerlink" title="动态方法解析"></a>动态方法解析</h2><p>对象在接收到未知的消息时，首先会调用所属类的类方法<code>+resolveInstanceMethod:</code>(实例方法)或者<code>+resolveClassMethod:</code>(类方法)。在这个方法中，我们有机会为该未知消息新增一个”处理方法””。不过使用该方法的前提是我们已经实现了该“处理方法”，只需要在运行时通过<code>class_addMethod</code>函数动态添加到类里面就可以了。如下代码所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">void functionForMethod1(id self, SEL _cmd) &#123;</div><div class="line">NSLog(@&quot;%@, %p&quot;, self, _cmd);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel &#123;</div><div class="line">NSString *selectorString = NSStringFromSelector(sel);</div><div class="line">if ([selectorString isEqualToString:@&quot;method1&quot;]) &#123;</div><div class="line">class_addMethod(self.class, @selector(method1), (IMP)functionForMethod1, &quot;@:&quot;);</div><div class="line">&#125;</div><div class="line">return [super resolveInstanceMethod:sel];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">void otherEat(id self, SEL cmd) &#123;</div><div class="line">NSLog(@&quot;blog.yoonangel.com&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel &#123;</div><div class="line">if ([NSStringFromSelector(sel) isEqualToString:@&quot;eat&quot;]) &#123;</div><div class="line">class_addMethod(self, sel, (IMP)otherEat, &quot;v@&quot;);</div><div class="line">return YES;</div><div class="line">&#125;</div><div class="line">return [super resolveInstanceMethod:sel];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>class_addMethod方法可谓是核心，那么依次来看他的参数的含义：</p>
<ul>
<li>first：添加到哪个类</li>
<li>second：添加方法的方法编号（选择子）</li>
<li>third：添加方法的函数实现(IMP函数指针)</li>
<li>fourth：IMP指针指向的函数返回值和参数类型<br>v代表无返回值void @代表id类型对象-&gt;self  :代表选择子SEL-&gt;_cmd</li>
<li>“v@:” v代表无返回值void，如果是i则代表int 无参数</li>
<li>“i@:” 代表返回值是int类型，无参数</li>
<li>“v@:i@:” 代表返回值是void类型，参数是int类型，存在一个参数（多参数依次累加）”v@:@@” 代表 两个参数的没有返回值。</li>
</ul>
<p>这种方案更多的是为了实现@dynamic属性。</p>
<h2 id="备用接收者"><a href="#备用接收者" class="headerlink" title="备用接收者"></a>备用接收者</h2><p>如果在上一步无法处理消息，则Runtime会继续调以下方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (id)forwardingTargetForSelector:(SEL)aSelector</div></pre></td></tr></table></figure></p>
<p>如果一个对象实现了这个方法，并返回一个非nil的结果，则这个对象会作为消息的新接收者，且消息会被分发到这个对象。当然这个对象不能是<code>self</code>自身，否则就是出现无限循环。当然，如果我们没有指定相应的对象来处理<code>aSelector</code>，则应该调用父类的实现来返回结果。</p>
<p>使用这个方法通常是在对象内部，可能还有一系列其它对象能处理该消息，我们便可借这些对象来处理消息并返回，这样在对象外部看来，还是由该对象亲自处理了这一消息。如下代码所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">@interface SUTRuntimeMethodHelper : NSObject</div><div class="line">- (void)method2;</div><div class="line">@end</div><div class="line">@implementation SUTRuntimeMethodHelper</div><div class="line">- (void)method2 &#123;</div><div class="line">NSLog(@&quot;%@, %p&quot;, self, _cmd);</div><div class="line">&#125;</div><div class="line">@end</div><div class="line">#pragma mark -</div><div class="line">@interface SUTRuntimeMethod () &#123;</div><div class="line">SUTRuntimeMethodHelper *_helper;</div><div class="line">&#125;</div><div class="line">@end</div><div class="line">@implementation SUTRuntimeMethod</div><div class="line">+ (instancetype)object &#123;</div><div class="line">return [[self alloc] init];</div><div class="line">&#125;</div><div class="line">- (instancetype)init &#123;</div><div class="line">self = [super init];</div><div class="line">if (self != nil) &#123;</div><div class="line">_helper = [[SUTRuntimeMethodHelper alloc] init];</div><div class="line">&#125;</div><div class="line">return self;</div><div class="line">&#125;</div><div class="line">- (void)test &#123;</div><div class="line">[self performSelector:@selector(method2)];</div><div class="line">&#125;</div><div class="line">- (id)forwardingTargetForSelector:(SEL)aSelector &#123;</div><div class="line">NSLog(@&quot;forwardingTargetForSelector&quot;);</div><div class="line">NSString *selectorString = NSStringFromSelector(aSelector);</div><div class="line">// 将消息转发给_helper来处理</div><div class="line">if ([selectorString isEqualToString:@&quot;method2&quot;]) &#123;</div><div class="line">return _helper;</div><div class="line">&#125;</div><div class="line">return [super forwardingTargetForSelector:aSelector];</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>这一步合适于我们只想将消息转发到另一个能处理该消息的对象上。但这一步无法对消息进行处理，如操作消息的参数和返回值。</p>
<h2 id="完整消息转发"><a href="#完整消息转发" class="headerlink" title="完整消息转发"></a>完整消息转发</h2><p>如果在上一步还不能处理未知消息，则唯一能做的就是启用完整的消息转发机制了。此时会调用以下方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation</div></pre></td></tr></table></figure></p>
<p>运行时系统会在这一步给消息接收者最后一次机会将消息转发给其它对象。对象会创建一个表示消息的<code>NSInvocation</code>对象，把与尚未处理的消息有关的全部细节都封装在<code>anInvocation</code>中，包括selector，目标(<code>target</code>)和参数。我们可以在<code>forwardInvocation</code>方法中选择将消息转发给其它对象。<br><code>forwardInvocation</code>:方法的实现有两个任务：</p>
<ul>
<li>1.定位可以响应封装在anInvocation中的消息的对象。这个对象不需要能处理所有未知消息。</li>
<li>2.使用<code>anInvocation</code>作为参数，将消息发送到选中的对象。<code>anInvocation</code>将会保留调用结果，运行时系统会提取这一结果并将其发送到消息的原始发送者。</li>
</ul>
<p>不过，在这个方法中我们可以实现一些更复杂的功能，我们可以对消息的内容进行修改，比如追回一个参数等，然后再去触发消息。另外，若发现某个消息不应由本类处理，则应调用父类的同名方法，以便继承体系中的每个类都有机会处理此调用请求。<br>还有一个很重要的问题，我们必须重写以下方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</div></pre></td></tr></table></figure></p>
<p>消息转发机制使用从这个方法中获取的信息来创建<code>NSInvocation</code>对象。因此我们必须重写这个方法，为给定的<code>selector</code>提供一个合适的方法签名。<br>完整的示例如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123;</div><div class="line">NSMethodSignature *signature = [super methodSignatureForSelector:aSelector];</div><div class="line">if (!signature) &#123;</div><div class="line">if ([SUTRuntimeMethodHelper instancesRespondToSelector:aSelector]) &#123;</div><div class="line">signature = [SUTRuntimeMethodHelper instanceMethodSignatureForSelector:aSelector];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">return signature;</div><div class="line">&#125;</div><div class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation &#123;</div><div class="line">if ([SUTRuntimeMethodHelper instancesRespondToSelector:anInvocation.selector]) &#123;</div><div class="line">[anInvocation invokeWithTarget:_helper];</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>NSObject的<code>forwardInvocation</code>:方法实现只是简单调用了<code>doesNotRecognizeSelector</code>:方法，它不会转发任何消息。这样，如果不在以上所述的三个步骤中处理未知消息，则会引发一个异常。<br>从某种意义上来讲，<code>forwardInvocation:</code>就像一个未知消息的分发中心，将这些未知的消息转发给其它对象。或者也可以像一个运输站一样将所有未知消息都发送给同一个接收对象。这取决于具体的实现。</p>
<h2 id="消息转发与多重继承"><a href="#消息转发与多重继承" class="headerlink" title="消息转发与多重继承"></a>消息转发与多重继承</h2><p>回过头来看第二和第三步，通过这两个方法我们可以允许一个对象与其它对象建立关系，以处理某些未知消息，而表面上看仍然是该对象在处理消息。通过这种关系，我们可以模拟“多重继承”的某些特性，让对象可以“继承”其它对象的特性来处理一些事情。不过，这两者间有一个重要的区别：多重继承将不同的功能集成到一个对象中，它会让对象变得过大，涉及的东西过多；而消息转发将功能分解到独立的小的对象中，并通过某种方式将这些对象连接起来，并做相应的消息转发。<br>不过消息转发虽然类似于继承，但NSObject的一些方法还是能区分两者。如<code>respondsToSelector:</code>和<code>isKindOfClass:</code>只能用于继承体系，而不能用于转发链。便如果我们想让这种消息转发看起来像是继承，则可以重写这些方法，如以下代码所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (BOOL)respondsToSelector:(SEL)aSelector</div><div class="line">&#123;</div><div class="line">if ( [super respondsToSelector:aSelector])</div><div class="line">return YES;</div><div class="line">else &#123;</div><div class="line">/* Here, test whether the aSelector message can     *</div><div class="line">* be forwarded to another object and whether that  *</div><div class="line">* object can respond to it. Return YES if it can.  */</div><div class="line">&#125;</div><div class="line">return NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当一个对象在收到无法解读的消息之后，它会将消息实施转发。转发的主要步骤如下：</p>
<h2 id="消息转发步骤"><a href="#消息转发步骤" class="headerlink" title="消息转发步骤:"></a>消息转发步骤:</h2><ul>
<li>第一步：对象在收到无法解读的消息后，首先调用resolveInstanceMethod：方法决定是否动态添加方法。如果返回YES，则调用class_addMethod动态添加方法，消息得到处理，结束；如果返回NO，则进入下一步；</li>
<li>第二步：当前接收者还有第二次机会处理未知的选择子，在这一步中，运行期系统会问：能不能把这条消息转给其他接收者来处理。会进入forwardingTargetForSelector:方法，用于指定备选对象响应这个selector，不能指定为self。如果返回某个对象则会调用对象的方法，结束。如果返回nil，则进入下一步；</li>
<li>第三步：这步我们要通过methodSignatureForSelector:方法签名，如果返回nil，则消息无法处理。如果返回methodSignature，则进入下一步；</li>
<li>第四步：这步调用forwardInvocation：方法，我们可以通过anInvocation对象做很多处理，比如修改实现方法，修改响应对象等，如果方法调用成功，则结束。如果失败，则进入doesNotRecognizeSelector方法，抛出异常，此异常表示选择子最终未能得到处理。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">消息转发第一步：对象在收到无法解读的消息后，首先调用此方法，可用于动态添加方法，方法决定是否动态添加方法。如果返回YES，则调用class_addMethod动态添加方法，消息得到处理，结束；如果返回NO，则进入下一步；</div><div class="line">*/</div><div class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</div><div class="line">&#123;</div><div class="line">return NO;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line">当前接收者还有第二次机会处理未知的选择子，在这一步中，运行期系统会问：能不能把这条消息转给其他接收者来处理。会进入此方法，用于指定备选对象响应这个selector，不能指定为self。如果返回某个对象则会调用对象的方法，结束。如果返回nil，则进入下一步；</div><div class="line">*/</div><div class="line">- (id)forwardingTargetForSelector:(SEL)aSelector</div><div class="line">&#123;</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line">这步我们要通过该方法签名，如果返回nil，则消息无法处理。如果返回methodSignature，则进入下一步。</div><div class="line">*/</div><div class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</div><div class="line">&#123;</div><div class="line">if ([NSStringFromSelector(aSelector) isEqualToString:@&quot;study&quot;])</div><div class="line">&#123;</div><div class="line">return [NSMethodSignature signatureWithObjCTypes:&quot;v@:&quot;];</div><div class="line">&#125;</div><div class="line">return [super methodSignatureForSelector:aSelector];</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line">这步调用该方法，我们可以通过anInvocation对象做很多处理，比如修改实现方法，修改响应对象等，如果方法调用成功，则结束。如果失败，则进入doesNotRecognizeSelector方法。</div><div class="line">*/</div><div class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation</div><div class="line">&#123;</div><div class="line">[anInvocation setSelector:@selector(play)];</div><div class="line">[anInvocation invokeWithTarget:self];</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line">抛出异常，此异常表示选择子最终未能得到处理。</div><div class="line">*/</div><div class="line">- (void)doesNotRecognizeSelector:(SEL)aSelector</div><div class="line">&#123;</div><div class="line">NSLog(@&quot;无法处理消息：%@&quot;, NSStringFromSelector(aSelector));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-3d69f0d3b41f0cf8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-37d7f5310f20127d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<blockquote>
<p>接收者在每一步中均有机会处理消息，步骤越靠后，处理消息的代价越大。最好在第一步就能处理完，这样系统就可以把此方法缓存起来了。</p>
</blockquote>
<h2 id="五-关联对象-（AssociatedObject）"><a href="#五-关联对象-（AssociatedObject）" class="headerlink" title="五.关联对象 （AssociatedObject）"></a>五.关联对象 （AssociatedObject）</h2><p>使用场景：<br>可以在类别中添加属性<br>有时我们需要在对象中存放相关信息，Objective-C中有一种强大的特性可以解决此类问题，就是“关联对象”。<br>可以给某个对象关联许多其他对象，这些对象通过“键”来区分。存储对象值时，可以指明“存储策略”，用以维护相应地“内存管理语义”。存储策略由名为“objc_AssociationPolicy” 的枚举所定义。下表中列出了该枚举值得取值，同时还列出了与之等下的@property属性：假如关联对象成为了属性，那么他就会具备对应的语义。<br><strong>1.设置关联值</strong><br>参数说明：<br>object：与谁关联，通常是传self<br>key：唯一键，在获取值时通过该键获取，通常是使用static<br>const void *来声明<br>value：关联所设置的值<br>policy：内存管理策略，比如使用copy<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 以给定的键和策略为某对象设置关联对象值。</div><div class="line">void objc_setAssociatedObject(id object, const void *key, id value, objc _AssociationPolicy policy)</div></pre></td></tr></table></figure></p>
<p><strong>2.获取关联值</strong><br>参数说明：<br>object：与谁关联，通常是传self，在设置关联时所指定的与哪个对象关联的那个对象<br>key：唯一键，在设置关联时所指定的键<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 根据给定的键从某对象中获取对应的对象值。</div><div class="line">id objc_getAssociatedObject(id object, const void *key)</div></pre></td></tr></table></figure></p>
<p><strong>3.取消关联</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 移除指定对象的全部关联对象。</div><div class="line">void objc_removeAssociatedObjects(id object)</div></pre></td></tr></table></figure></p>
<p><strong>关联策略</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">typedef OBJC_ENUM(uintptr_t, objc_AssociationPolicy)&#123;</div><div class="line">OBJC_ASSOCIATION_ASSIGN = 0,             // 表示弱引用关联，通常是基本数据类型 @property (assign) or @ property (unsafe_unretained)</div><div class="line">OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1,   // 表示强引用关联对象，是线程安全的 @property (nonatomic, strong)</div><div class="line">OBJC_ASSOCIATION_COPY_NONATOMIC = 3,     // 表示关联对象copy，是线程安全的 @property (nonatomic, copy)</div><div class="line">OBJC_ASSOCIATION_RETAIN = 01401,         // 表示强引用关联对象，不是线程安全的 @property (atomic, strong)</div><div class="line">OBJC_ASSOCIATION_COPY = 01403            // 表示关联对象copy，不是线程安全的 @property (atomic, copy)</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h2 id="六-交换方法（method-swizzing）"><a href="#六-交换方法（method-swizzing）" class="headerlink" title="六.交换方法（method swizzing）"></a>六.交换方法（method swizzing）</h2><ul>
<li><code>开发使用场景</code>:系统自带的方法功能不够，给系统自带的方法扩展一些功能，并且保持原有的功能。</li>
<li><code>方式一</code>:继承系统的类，重写方法.</li>
<li><p><code>方式二</code>:使用runtime,交换方法.<br>在Objective-C中，对象收到消息之后，究竟会调用哪种方法需要在运行期才能解析出来。查找消息的唯一依据是选择子(selector)，选择子(selector)与相应的方法(IMP)对应，利用Objective-C的动态特性，可以实现在运行时偷换选择子（selector）对应的方法实现，这就是方法交换（method swizzling）。<br>每个类都有一个方法列表，存放着selector的名字和方法实现的映射关系。IMP有点类似函数指针，指向具体的Method实现。</p>
</li>
<li><p>交换原理：</p>
</li>
<li>交换之前：<br><img src="http://upload-images.jianshu.io/upload_images/1742252-0fef9dd74410e946.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
<li>交换之后：<br><img src="http://upload-images.jianshu.io/upload_images/1742252-4da4906e3b197def.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-9d63f8e7703f4de8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="类的方法列表会把每个选择子都映射到相关的IMP之上"><br><img src="http://upload-images.jianshu.io/upload_images/1742252-6176fa7cccbbdc6e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>我们可以新增选择子，也可以改变某个选择子所对应的方法实现，还可以交换两个选择子所映射到的指针。</p>
<h3 id="Objective-C中提供了三种API来动态替换类方法或实例方法的实现："><a href="#Objective-C中提供了三种API来动态替换类方法或实例方法的实现：" class="headerlink" title="Objective-C中提供了三种API来动态替换类方法或实例方法的实现："></a>Objective-C中提供了三种API来动态替换类方法或实例方法的实现：</h3><ul>
<li><p>1.<code>class_replaceMethod</code>替换类方法的定义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">class_replaceMethod(Class cls, SEL name, IMP imp, const char *types)</div></pre></td></tr></table></figure>
</li>
<li><p>2.<code>method_exchangeImplementations</code>交换两个方法的实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">method_exchangeImplementations(Method m1, Method m2)</div></pre></td></tr></table></figure>
</li>
<li><p>3.<code>method_setImplementation</code>设置一个方法的实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">method_setImplementation(Method m, IMP imp)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>先说下这三个方法的区别：</p>
<ul>
<li><code>class_replaceMethod</code>：当类中没有想替换的原方法时，该方法调用<code>class_addMethod</code>来为该类增加一个新方法，也正因如此，<code>class_replaceMethod</code>在调用时需要传入types参数，而其余两个却不需要。</li>
<li><code>method_exchangeImplementations</code>：内部实现就是调用了两次<code>method_setImplementation</code>方法。<br>再来看看他们的使用场景：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">+ (void)load</div><div class="line">&#123;</div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line"></div><div class="line">SEL originalSelector = @selector(willMoveToSuperview:);</div><div class="line">SEL swizzledSelector = @selector(myWillMoveToSuperview:);</div><div class="line"></div><div class="line">Method originalMethod = class_getInstanceMethod(self, originalSelector);</div><div class="line">Method swizzledMethod = class_getInstanceMethod(self, swizzledSelector);</div><div class="line"></div><div class="line">BOOL didAddMethod = class_addMethod(self,</div><div class="line">originalSelector,</div><div class="line">method_getImplementation(swizzledMethod),</div><div class="line">method_getTypeEncoding(swizzledMethod));</div><div class="line"></div><div class="line">if (didAddMethod) &#123;</div><div class="line">class_replaceMethod(self,</div><div class="line">swizzledSelector,</div><div class="line">method_getImplementation(originalMethod),</div><div class="line">method_getTypeEncoding(originalMethod));</div><div class="line">&#125; else &#123;</div><div class="line">method_exchangeImplementations(originalMethod, swizzledMethod);</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)myWillMoveToSuperview:(UIView *)newSuperview</div><div class="line">&#123;</div><div class="line">NSLog(@&quot;WillMoveToSuperview: %@&quot;, self);</div><div class="line">[self myWillMoveToSuperview:newSuperview];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">@implementation ViewController</div><div class="line"></div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">[super viewDidLoad];</div><div class="line">// Do any additional setup after loading the view, typically from a nib.</div><div class="line">// 需求：给imageNamed方法提供功能，每次加载图片就判断下图片是否加载成功。</div><div class="line">// 步骤一：先搞个分类，定义一个能加载图片并且能打印的方法+ (instancetype)imageWithName:(NSString *)name;</div><div class="line">// 步骤二：交换imageNamed和imageWithName的实现，就能调用imageWithName，间接调用imageWithName的实现。</div><div class="line">UIImage *image = [UIImage imageNamed:@&quot;123&quot;];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line">@implementation UIImage (Image)</div><div class="line">// 加载分类到内存的时候调用</div><div class="line">+ (void)load</div><div class="line">&#123;</div><div class="line">// 交换方法</div><div class="line"></div><div class="line">// 获取imageWithName方法地址</div><div class="line">Method imageWithName = class_getClassMethod(self, @selector(imageWithName:));</div><div class="line"></div><div class="line">// 获取imageName方法地址</div><div class="line">Method imageName = class_getClassMethod(self, @selector(imageNamed:));</div><div class="line"></div><div class="line">// 交换方法地址，相当于交换实现方式</div><div class="line">method_exchangeImplementations(imageWithName, imageName);</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">// 不能在分类中重写系统方法imageNamed，因为会把系统的功能给覆盖掉，而且分类中不能调用super.</div><div class="line"></div><div class="line">// 既能加载图片又能打印</div><div class="line">+ (instancetype)imageWithName:(NSString *)name</div><div class="line">&#123;</div><div class="line"></div><div class="line">// 这里调用imageWithName，相当于调用imageName</div><div class="line">UIImage *image = [self imageWithName:name];</div><div class="line"></div><div class="line">if (image == nil) &#123;</div><div class="line">NSLog(@&quot;加载空的图片&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">return image;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">+ (void)load&#123;</div><div class="line"></div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line"></div><div class="line">Method objectAtIndex = class_getInstanceMethod(self, @selector(objectAtIndex:));</div><div class="line">Method db_objectAtIndex = class_getInstanceMethod(self, @selector(db_objectAtIndex:));</div><div class="line"></div><div class="line">method_exchangeImplementations(objectAtIndex, db_objectAtIndex);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">- (id)db_objectAtIndex:(NSUInteger)inex&#123;</div><div class="line">NSLog(@&quot;%s&quot;,__FUNCTION__);</div><div class="line">id item;</div><div class="line">if ( self.count &gt; inex ) &#123;</div><div class="line">item = [self db_objectAtIndex:inex];</div><div class="line">&#125;</div><div class="line">else&#123;</div><div class="line">item = nil;</div><div class="line">&#125;</div><div class="line">return item;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>总结</strong></p>
<blockquote>
<p>1.<code>class_replaceMethod</code>，当需要替换的方法有可能不存在时，可以考虑使用该方法。<br>2.<code>method_exchangeImplementations</code>，当需要交换两个方法的时使用。<br>3.<code>method_setImplementation</code>是最简单的用法，当仅仅需要为一个方法设置其实现方式时实现。</p>
</blockquote>
<h2 id="Swizzling应该总是在-load中执行"><a href="#Swizzling应该总是在-load中执行" class="headerlink" title="Swizzling应该总是在+load中执行"></a>Swizzling应该总是在+load中执行</h2><p>在Objective-C中，运行时会自动调用每个类的两个方法。<code>+load</code>会在类初始加载时调用，<code>+initialize</code>会在第一次调用类的类方法或实例方法之前被调用。这两个方法是可选的，且只有在实现了它们时才会被调用。由于<code>method swizzling</code>会影响到类的全局状态，因此要尽量避免在并发处理中出现竞争的情况。<code>+load</code>能保证在类的初始化过程中被加载，并保证这种改变应用级别的行为的一致性。相比之下，<code>+initialize</code>在其执行时不提供这种保证–事实上，如果在应用中没为给这个类发送消息，则它可能永远不会被调用。</p>
<h2 id="Swizzling应该总是在dispatch-once中执行"><a href="#Swizzling应该总是在dispatch-once中执行" class="headerlink" title="Swizzling应该总是在dispatch_once中执行"></a><a href="http://southpeak.github.io/2014/11/06/objective-c-runtime-4/#Swizzling应该总是在dispatch-once中执行" title="Swizzling应该总是在dispatch_once中执行" target="_blank" rel="external"></a>Swizzling应该总是在dispatch_once中执行</h2><p>与上面相同，因为<code>swizzling</code>会改变全局状态，所以我们需要在运行时采取一些预防措施。原子性就是这样一种措施，它确保代码只被执行一次，不管有多少个线程。GCD的<code>dispatch_once</code>可以确保这种行为，我们应该将其作为<code>method swizzling</code>的最佳实践。</p>
<h2 id="选择器、方法与实现"><a href="#选择器、方法与实现" class="headerlink" title="选择器、方法与实现"></a><a href="http://southpeak.github.io/2014/11/06/objective-c-runtime-4/#选择器、方法与实现" title="选择器、方法与实现" target="_blank" rel="external"></a>选择器、方法与实现</h2><p>在Objective-C中，选择器(<code>selector</code>)、方法(<code>method</code>)和实现(<code>implementation</code>)是运行时中一个特殊点，虽然在一般情况下，这些术语更多的是用在消息发送的过程描述中。</p>
<p>以下是<code>Objective-C Runtime Reference</code>中的对这几个术语一些描述：</p>
<ol>
<li><code>Selector(typedef struct objc_selector *SEL)</code>：用于在运行时中表示一个方法的名称。一个方法选择器是一个C字符串，它是在Objective-C运行时被注册的。选择器由编译器生成，并且在类被加载时由运行时自动做映射操作。</li>
<li><code>Method(typedef struct objc_method *Method)</code>：在类定义中表示方法的类型</li>
<li><code>Implementation(typedef id (*IMP)(id, SEL, ...))</code>：这是一个指针类型，指向方法实现函数的开始位置。这个函数使用为当前CPU架构实现的标准C调用规范。每一个参数是指向对象自身的指针(self)，第二个参数是方法选择器。然后是方法的实际参数。</li>
</ol>
<p>理解这几个术语之间的关系最好的方式是：一个类维护一个运行时可接收的消息分发表；分发表中的每个入口是一个方法(Method)，其中key是一个特定名称，即选择器(SEL)，其对应一个实现(IMP)，即指向底层C函数的指针。</p>
<p>为了swizzle一个方法，我们可以在分发表中将一个方法的现有的选择器映射到不同的实现，而将该选择器对应的原始实现关联到一个新的选择器中。</p>
<p>在 Cocoa 编程中，大部分的类都继承于 NSObject ，有些 NSObject 提供的方法仅仅是为了查询运动时系统的相关信息，这此方法都可以反查自己。比如 <code>-isKindOfClass:</code> 和 <code>-isMemberOfClass:</code> 都是用于查询在继承体系中的位置。 <code>-respondsToSelector:</code>指明是否接受特定的消息。 <code>+conformsToProtocol:</code> 指明是否要求实现在指定的协议中声明的方法。 <code>-methodForSelector:</code>提供方法实现的地址。</p>
<p>简单概括下Runtime的方法列表和用法</p>
<ol>
<li>objc_getClass 获取类名</li>
<li>objc_msgSend 调用对象的sel</li>
<li>class_getClassMethod 获取类方法</li>
<li>method_exchangeImplementations 交换两个方法</li>
<li>class_addMethod 给类添加方法</li>
<li>class_copyIvarList 获取成员变量信息</li>
<li>class_copyPropertyList 获取属性信息</li>
<li>class_copyMethodList 获取方法信息</li>
<li>class_copyProtocolList 获取协议信息</li>
<li>objc_setAssociatedObject 动态关联set方法</li>
<li>objc_getAssociatedObject 动态关联get方法</li>
<li>ivar_getName 获取变量名<code>char *</code>类型</li>
<li>ivar_getTypeEncoding 获取到属性变量的类型<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html" target="_blank" rel="external">详情类型介绍</a></li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://southpeak.github.io/2014/10/25/objective-c-runtime-1/" target="_blank" rel="external">http://southpeak.github.io/2014/10/25/objective-c-runtime-1/</a></li>
<li><a href="http://yulingtianxia.com/blog/2017/11/05/Objective-C-Message-Throttle-and-Debounce/" target="_blank" rel="external">http://yulingtianxia.com/blog/2017/11/05/Objective-C-Message-Throttle-and-Debounce/</a></li>
<li><a href="https://draveness.me/message" target="_blank" rel="external">https://draveness.me/message</a></li>
<li><a href="http://www.desgard.com/objc_msgSend1/" target="_blank" rel="external">http://www.desgard.com/objc_msgSend1/</a></li>
<li><a href="http://www.jianshu.com/p/3e050ec3b759" target="_blank" rel="external">http://www.jianshu.com/p/3e050ec3b759</a></li>
<li><a href="http://www.jianshu.com/p/950d7c8797bc" target="_blank" rel="external">http://www.jianshu.com/p/950d7c8797bc</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/22/iOS图片拉伸-resizableImage/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/22/iOS图片拉伸-resizableImage/" itemprop="url">
                  iOS图片拉伸(resizableImage)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-22T16:19:53+08:00">
                2017-11-22
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="返回一张受保护且被拉伸的图片"><a href="#返回一张受保护且被拉伸的图片" class="headerlink" title="返回一张受保护且被拉伸的图片"></a>返回一张受保护且被拉伸的图片</h1><p>应用场景:聊天窗口的气泡</p>
<h2 id="方法一-弃用"><a href="#方法一-弃用" class="headerlink" title="方法一(弃用):"></a>方法一(弃用):</h2><p>iOS 5.0以前使用(弃用)这个方法会自动计算出偏向中间的一个1*1的方格也就是被拉伸的地方(默认使用拉伸),一般传入的值为图片大小的一半.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[image stretchableImageWithLeftCapWidth:imageHeight *0.5 topCapHeight:imageHeight *0.5 ];</div></pre></td></tr></table></figure></p>
<h2 id="方法二-常用"><a href="#方法二-常用" class="headerlink" title="方法二(常用):"></a>方法二(常用):</h2><p>将图片没有保护的部分进行拉伸。<br>上下左右的值定义了受保护区域，能被拉伸的地方是中间区域，一般我们都设成中心点为了安全。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 1. 直接传入保护的范围，没有设置图拉伸的模式，默认为UIImageResizingModeTile（瓦片式）就是将图片以原来的大小就行平铺显示</div><div class="line">[image resizableImageWithCapInsets:UIEdgeInsetsMake(&lt;#CGFloat top#&gt;, &lt;#CGFloat left#&gt;, &lt;#CGFloat bottom#&gt;, &lt;#CGFloat right#&gt;)];</div><div class="line">// 2. 设置图片拉伸的模式</div><div class="line">// UIImageResizingModeTile平铺 UIImageResizingModeStretch拉伸</div><div class="line">[image resizableImageWithCapInsets:UIEdgeInsetsMake(imageheight * 0.5, imagewidth * 0.5, imageheight * 0.5 -1, imagewidth * 0.5 - 1) resizingMode:UIImageResizingModeTile];</div></pre></td></tr></table></figure></p>
<p>传入的第一个参数<code>capInsets</code>是<code>UIEdgeInsets</code>类型的数据: <code>UIEdgeInsetsMake(&lt;#CGFloat top#&gt;, &lt;#CGFloat left#&gt;, &lt;#CGFloat bottom#&gt;, &lt;#CGFloat right#&gt;)</code><br>这个参数是一个结构体,定义如下<br><code>typedef struct { CGFloat top, left , bottom, right ; } UIEdgeInsets;</code><br>该参数的意思是被保护的区域到原始图像外轮廓的上部,左部,底部,右部的直线距离<br><code>比如 UIEdgeInsetsMake(42, 0, 0, 0) 指的是拉伸区，详细点解释就是，从顶部一直到y=42部分是保护区，从y=42一直到底部是拉伸区</code></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-4cc4663c1c055c74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br><img src="http://upload-images.jianshu.io/upload_images/1742252-0f7035683b8d9bce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>对于拉伸的方式，有以下两种：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM(NSInteger, UIImageResizingMode) &#123;</div><div class="line">UIImageResizingModeTile,（瓦片）</div><div class="line">UIImageResizingModeStretch,（伸展）</div><div class="line">　&#125;;</div></pre></td></tr></table></figure></p>
<ul>
<li><code>IUIImageResizingModeStretch</code>：拉伸模式，通过拉伸<code>UIEdgeInsets</code>指定的矩形区域来填充图片</li>
<li><code>UIImageResizingModeTile</code>：平铺模式(瓦片)，通过重复显示<code>UIEdgeInsets</code>指定的矩形区域来填充图片<br>　<br>来做四个测试，假如我们的原始图像尺寸为60<em>128<br><img src="http://upload-images.jianshu.io/upload_images/1742252-dc11efb82e910732.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="原始图像"><br>　<br>在一个 180 </em> 384 的窗口进行测试图像<br>　<br><strong>测试的界面设计如图</strong><br>正上方为原始图像窗口,用于显示原始图像的效果<br>左下方为测试图像窗口,用于显示测试状况的效果<br>右下方为对比图像窗口,用于显示默认状况的效果<br><img src="http://upload-images.jianshu.io/upload_images/1742252-156d2a51cf642c85.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="测试软件的界面设计"><br>　<br>当我们设置<code>capInsets</code>为以下四种值的时候有什么样子的效果：</li>
<li>1:<code>capInsets</code>参数为<code>UIEdgeInsetsMake(0, 0, 0, 0)</code></li>
<li>2:<code>capInsets</code>参数为<code>UIEdgeInsetsMake(42, 0, 0, 0)</code></li>
<li>3:<code>capInsets</code>参数为<code>UIEdgeInsetsMake(0, 20, 0, 0)</code></li>
<li>4:<code>capInsets</code>参数为<code>UIEdgeInsetsMake(42, 20, 42, 20)</code>
　<h2 id="拉伸模式"><a href="#拉伸模式" class="headerlink" title="拉伸模式"></a>拉伸模式</h2>resizingMode参数为UIImageResizingModeStretch
　<h3 id="1-capInsets参数为UIEdgeInsetsMake-0-0-0-0-时"><a href="#1-capInsets参数为UIEdgeInsetsMake-0-0-0-0-时" class="headerlink" title="1.capInsets参数为UIEdgeInsetsMake(0, 0, 0, 0)时"></a>1.capInsets参数为UIEdgeInsetsMake(0, 0, 0, 0)时</h3>　<br>当我们向拉伸方法传入该组参数时,代表我们未对原始图像的任何区域进行保护.其拉伸效果如图<br><strong>在该种情况下,我们发现原始图像按比例放大了3倍,因此我们将该情况当做拉伸模式下的默认状况<br>　在之后的实验中,我们将该种状况当做参考对象,显示在界面的右下角</strong><br><img src="http://upload-images.jianshu.io/upload_images/1742252-28c3bf4f5242f230.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Stretch实验结果1.png">
　<h3 id="2-capInsets参数为UIEdgeInsetsMake-42-0-0-0-时"><a href="#2-capInsets参数为UIEdgeInsetsMake-42-0-0-0-时" class="headerlink" title="2.capInsets参数为UIEdgeInsetsMake(42, 0, 0, 0)时"></a>2.capInsets参数为UIEdgeInsetsMake(42, 0, 0, 0)时</h3>当我们向拉伸方法传入该组参数时,代表我们对原始图像上部的三分之一进行保护(即红色方块区域).其拉伸效果如图<br><strong>在该种情况下,我们可以发现拉伸后的图像中:</strong></li>
<li>原始图像中受保护的区域(即红色方块区域)在Y轴方向保持了原比例,但在X轴方向进行了拉伸</li>
<li>原始图像中未受保护的区域,直接按比例进行了拉伸<br><img src="http://upload-images.jianshu.io/upload_images/1742252-af350d6b5d37f187.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Stretch实验结果2.png">
　<h3 id="3-capInsets参数为UIEdgeInsetsMake-0-20-0-0-时"><a href="#3-capInsets参数为UIEdgeInsetsMake-0-20-0-0-时" class="headerlink" title="3.capInsets参数为UIEdgeInsetsMake(0,20, 0, 0)时"></a>3.capInsets参数为UIEdgeInsetsMake(0,20, 0, 0)时</h3>当我们向拉伸方法传入该组参数时,代表我们对原始图像左部的三分之一进行保护(即红色方块区域).其拉伸效果如图<br><strong>在该种情况下,我们可以发现拉伸后的图像中:</strong>
　</li>
<li>原始图像中受保护的区域(即红色方块区域)在X轴方向保持了原比例,但在Y轴方向进行了拉伸</li>
<li>原始图像中未受保护的区域,直接按比例进行了拉伸<br><img src="http://upload-images.jianshu.io/upload_images/1742252-c37c3f84606eb438.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Stretch实验结果3.png">
　<h3 id="4-capInsets参数为UIEdgeInsetsMake-42-20-42-20-时"><a href="#4-capInsets参数为UIEdgeInsetsMake-42-20-42-20-时" class="headerlink" title="4.capInsets参数为UIEdgeInsetsMake(42, 20, 42, 20)时"></a>4.capInsets参数为UIEdgeInsetsMake(42, 20, 42, 20)时</h3>当我们向拉伸方法传入该组参数时,代表我们对原始图像除数字5以外的区域进行保护(即两个红色方块围起来的区域).其拉伸效果如图<br><strong>在该种情况下,我们可以发现拉伸后的图像中:</strong>
　</li>
<li>在X轴上,由于1被左边和上边的设置保护,3被右边和上边的设置保护,所以只能用中间的2来拉伸,同理最底下的7,8,9</li>
<li>在Y轴上,由于1被左边和上边的设置保护,7被左边和下边的设置保护,所以只能用中间的4来拉伸,同理最底下的3,6,9</li>
<li>由于5没有被保护,所以在整个剩余的空间中,用5进行拉伸填充<br><img src="http://upload-images.jianshu.io/upload_images/1742252-dc9568cdb0b74f41.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Stretch实验结果4.png">
　<h2 id="选择平铺模式"><a href="#选择平铺模式" class="headerlink" title="选择平铺模式"></a>选择平铺模式</h2>resizingMode参数为UIImageResizingModeTile<h3 id="1-capInsets参数为UIEdgeInsetsMake-0-0-0-0-时-1"><a href="#1-capInsets参数为UIEdgeInsetsMake-0-0-0-0-时-1" class="headerlink" title="1.capInsets参数为UIEdgeInsetsMake(0, 0, 0, 0)时"></a>1.capInsets参数为UIEdgeInsetsMake(0, 0, 0, 0)时</h3>当我们向拉伸方法传入该组参数时,代表我们未对原始图像的任何区域进行保护.其平铺效果如图<br><strong>在该种情况下,我们发现原始图像按比例填充了相框,因此我们将该情况当做拉伸模式下的默认状况<br>在之后的实验中,我们将该种状况当做参考对象,显示在界面的右下角</strong><br><img src="http://upload-images.jianshu.io/upload_images/1742252-1f0404afec6c0190.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Tile测试1.png">
　<h3 id="2-capInsets参数为UIEdgeInsetsMake-42-0-0-0-时-1"><a href="#2-capInsets参数为UIEdgeInsetsMake-42-0-0-0-时-1" class="headerlink" title="2.capInsets参数为UIEdgeInsetsMake(42, 0, 0, 0)时"></a>2.capInsets参数为UIEdgeInsetsMake(42, 0, 0, 0)时</h3>当我们向拉伸方法传入该组参数时,代表我们对原始图像上部的三分之一进行保护(即红色方块区域).其平铺效果如图<br><strong>在该种情况下,我们可以发现拉伸后的图像中:</strong></li>
<li>原始图像中受保护的区域(即红色方块区域)在Y轴方向保持了原比例,但在X轴方向进行了平铺填充</li>
<li>原始图像中未受保护的区域,直接按比例进行了平铺,但不包含被保护的区域(注意观察蓝色箭头所指的区域)<br><img src="http://upload-images.jianshu.io/upload_images/1742252-7c3b8907f4bd53de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Tile测试2.png">
　<h3 id="3-capInsets参数为UIEdgeInsetsMake-0-20-0-0-时-1"><a href="#3-capInsets参数为UIEdgeInsetsMake-0-20-0-0-时-1" class="headerlink" title="3.capInsets参数为UIEdgeInsetsMake(0,20, 0, 0)时"></a>3.capInsets参数为UIEdgeInsetsMake(0,20, 0, 0)时</h3>当我们向拉伸方法传入该组参数时,代表我们对原始图像左部的三分之一进行保护(即红色方块区域).其平铺效果如图4.2.3<br><strong>在该种情况下,我们可以发现拉伸后的图像中:</strong></li>
<li>原始图像中受保护的区域(即红色方块区域)在X轴方向保持了原比例,但在Y轴方向进行了平铺填充</li>
<li>原始图像中未受保护的区域,直接按比例进行了平铺,但不包含被保护的区域(注意观察蓝色箭头所指的区域)<br>　<br><img src="http://upload-images.jianshu.io/upload_images/1742252-39d9aa8e13e3fb7d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Tile测试3.png">
　<h3 id="4-capInsets参数为UIEdgeInsetsMake-42-20-42-20-时-1"><a href="#4-capInsets参数为UIEdgeInsetsMake-42-20-42-20-时-1" class="headerlink" title="4.capInsets参数为UIEdgeInsetsMake(42, 20, 42, 20)时"></a>4.capInsets参数为UIEdgeInsetsMake(42, 20, 42, 20)时</h3>当我们向拉伸方法传入该组参数时,代表我们对原始图像除数字5以外的区域进行保护(即两个红色方块围起来的区域).其拉伸效果如图<br><strong>在该种情况下,我们可以发现拉伸后的图像中:</strong></li>
<li>在X轴上,由于1被左边和上边的设置保护,3被右边和上边的设置保护,所以只能用中间的2来平铺,同理最底下的7,8,9</li>
<li>在Y轴上,由于1被左边和上边的设置保护,7被左边和下边的设置保护,所以只能用中间的4来平铺,同理最底下的3,6,9</li>
<li>由于5没有被保护,所以在整个剩余的空间中,用5进行平铺填充<br><img src="http://upload-images.jianshu.io/upload_images/1742252-fcec68c654db9e16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Tile测试4.png">
　<h2 id="结论和建议"><a href="#结论和建议" class="headerlink" title="结论和建议"></a>结论和建议</h2>　<br>通过8组实验数据可以观察出拉伸方法在平铺模式和拉伸模式下的变化过程和主要区别,由此我们可知:
　</li>
<li>对原始图形使用拉伸方法且在四周增加保护区域后,能保证原始图形的四个角不失真,但其余部分的变化细节则有不同</li>
<li>如果原始图像的外轮廓不平整的话,使用拉伸方式会让外轮廓的不平整度放大,使用平铺方式应该能减小这种情况
　<h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码:"></a>测试代码:</h2>使用了Storyboard搭建软件界面<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div></pre></td><td class="code"><pre><div class="line">　#import &quot;ViewController.h&quot;</div><div class="line">　</div><div class="line">　@interface ViewController ()</div><div class="line">　@property (weak, nonatomic) IBOutlet UIImageView *imageView1;</div><div class="line">　@property (weak, nonatomic) IBOutlet UIImageView *imageView2;</div><div class="line">　@property (weak, nonatomic) IBOutlet UIImageView *imageView3;</div><div class="line">　@end</div><div class="line">　</div><div class="line">　@implementation ViewController</div><div class="line">　</div><div class="line">　- (void)viewDidLoad &#123;</div><div class="line">　[super viewDidLoad];</div><div class="line">　</div><div class="line">　//--imageView1的相关内容------------------------------------------------------------------------------------</div><div class="line">　</div><div class="line">　//相框大小为60 * 128    图片尺寸为60 * 128</div><div class="line">　//读取图片</div><div class="line">　UIImage *testImage1 = [UIImage imageNamed:@&quot;123456789&quot;];</div><div class="line">　</div><div class="line">　testImage1 = [testImage1 resizableImageWithCapInsets:UIEdgeInsetsMake(0, 0, 0, 0) resizingMode:UIImageResizingModeStretch];</div><div class="line">　self.imageView1.image = testImage1;</div><div class="line">　</div><div class="line">　//---imageView2的相关内容-----------------------------------------------------------------------------------</div><div class="line">　</div><div class="line">　//相框为180 * 384    图片尺寸为60 * 128    相框大小为原始图片的3倍</div><div class="line">　//读取图片</div><div class="line">　UIImage *testImage2 = [UIImage imageNamed:@&quot;123456789&quot;];</div><div class="line">　/***********************************************/</div><div class="line">　//方法1 resizableImageWithCapInsets:默认是平铺</div><div class="line">　//方法2 resizableImageWithCapInsets: resizingMode: 方法</div><div class="line">　//  UIImageResizingModeTile,     平铺</div><div class="line">　//平铺的概念是保证原图像大小不变,将新图像填充满</div><div class="line">　//testImage2 = [testImage2 resizableImageWithCapInsets:UIEdgeInsetsMake(0, 0, 0, 0) resizingMode:UIImageResizingModeTile];</div><div class="line">　</div><div class="line">　//将上部的三分之一&quot;保护&quot;,然后进行显示</div><div class="line">　//这代表新图像中,上部的三分之一和原图像一样,而其余部分的填充不会使用原图像上部的三分之一</div><div class="line">　// testImage2 = [testImage2 resizableImageWithCapInsets:UIEdgeInsetsMake(42, 0, 0, 0) resizingMode:UIImageResizingModeTile];</div><div class="line">　</div><div class="line">　//将左部的三分之一&quot;保护&quot;,然后进行显示</div><div class="line">　//这代表新图像中,上部的三分之一和原图像一样,而其余部分的填充不会使用原图像上部的三分之一</div><div class="line">　// testImage2 = [testImage2 resizableImageWithCapInsets:UIEdgeInsetsMake(0,20, 0, 0) resizingMode:UIImageResizingModeTile];</div><div class="line">　</div><div class="line">　//将四周进行保护后</div><div class="line">　//在X轴上,由于1被左边的设置保护,3被右边的设置保护,所以中间只能用2来平铺,同理,7和9之间的8</div><div class="line">　//在Y轴上,由于1被上边的设置保护,7被下边的设置保护,所以中间只能用4来平铺,同理,3和9之间的6</div><div class="line">　//由于5没有被保护,所以在整个空间中,用5进行平铺来填充剩余的区域</div><div class="line">　// testImage2 = [testImage2 resizableImageWithCapInsets:UIEdgeInsetsMake(42, 20, 42, 20) resizingMode:UIImageResizingModeTile];</div><div class="line">　</div><div class="line">　/***********************************************/</div><div class="line">　//resizableImageWithCapInsets: resizingMode: 方法</div><div class="line">　//  UIImageResizingModeStretch,  拉伸</div><div class="line">　//  拉伸的概念是直接按比例将图片放大到与相框尺寸相同的图像,</div><div class="line">　//testImage2 = [testImage2 resizableImageWithCapInsets:UIEdgeInsetsMake(0, 0, 0, 0) resizingMode:UIImageResizingModeStretch];</div><div class="line">　</div><div class="line">　//将上部的三分之一&quot;保护&quot;,然后进行显示</div><div class="line">　//保证原图像上部的三分之一在Y轴上不被拉伸,其余部分按剩余比例拉伸</div><div class="line">　//testImage2 = [testImage2 resizableImageWithCapInsets:UIEdgeInsetsMake(42, 0, 0, 0) resizingMode:UIImageResizingModeStretch];</div><div class="line">　</div><div class="line">　//将左部的三分之一&quot;保护&quot;,然后进行显示</div><div class="line">　//保证原图像左部的三分之一在Y轴上不被拉伸,其余部分按剩余比例拉伸</div><div class="line">　//testImage2 = [testImage2 resizableImageWithCapInsets:UIEdgeInsetsMake(0, 20, 0, 0) resizingMode:UIImageResizingModeStretch];</div><div class="line">　</div><div class="line">　//将四周进行保护后</div><div class="line">　//在X轴上,由于1被左边的设置保护,3被右边的设置保护,所以中间只能用2来拉伸,同理,7和9之间的8</div><div class="line">　//在Y轴上,由于1被上边的设置保护,7被下边的设置保护,所以中间只能用4来拉伸,同理,3和9之间的6</div><div class="line">　//由于5没有被保护,所以在整个空间中,用5进行拉伸来填充剩余的区域</div><div class="line">　//testImage2 = [testImage2 resizableImageWithCapInsets:UIEdgeInsetsMake(42, 20, 42, 20) resizingMode:UIImageResizingModeStretch];</div><div class="line">　</div><div class="line">　//将图片添加到相框</div><div class="line">　self.imageView2.image = testImage2;</div><div class="line">　</div><div class="line">　//-----imageView3的相关内容----------------------------------------------------------------------------------</div><div class="line">　</div><div class="line">　//读取图片</div><div class="line">　UIImage *testImage3 = [UIImage imageNamed:@&quot;123456789&quot;];</div><div class="line">　</div><div class="line">　/***********************************************/</div><div class="line">　//resizableImageWithCapInsets默认是平铺</div><div class="line">　//resizableImageWithCapInsets默认情况对比图</div><div class="line">　//testImage3 = [testImage3 resizableImageWithCapInsets:UIEdgeInsetsMake(0, 0, 0, 0) resizingMode:UIImageResizingModeTile];</div><div class="line">　</div><div class="line">　/***********************************************/</div><div class="line">　//resizableImageWithCapInsets: resizingMode: 方法</div><div class="line">　//  UIImageResizingModeTile,     平铺 (已经测试过了,)</div><div class="line">　//  UIImageResizingModeStretch,  拉伸</div><div class="line">　//testImage3 = [testImage3 resizableImageWithCapInsets:UIEdgeInsetsMake(0, 0, 0, 0) resizingMode:UIImageResizingModeStretch];</div><div class="line">　/***********************************************/</div><div class="line">　</div><div class="line">　//将图片添加到相框</div><div class="line">　self.imageView3.image = testImage3;</div><div class="line">　// Do any additional setup after loading the view, typically from a nib.</div><div class="line">　&#125;</div><div class="line">　</div><div class="line">　@end</div></pre></td></tr></table></figure>
</li>
</ul>
<p>　</p>
<h2 id="方法三"><a href="#方法三" class="headerlink" title="方法三:"></a>方法三:</h2><p>Image Slicing 可视化缩放<br>相当于一个可视化的<code>resizableImageWithCapInsets</code>，可以用于指定在图片缩放时用来填充的像素。我们可以在<code>Xcode</code>的<code>Assets.xcassets</code>目录中选择要<code>slicing</code>的图片，点击图片界面右下方的<code>Show Slicing</code>按钮，在想要设定切片的图片上点击<code>Start Slicing</code>，将出现左中右（或者上中下）三条可以拖动的指示线，通过拖动它们来设定实际的缩放范围。<br>　<br>他是可视化的resizableImageWithCapInsets，那么它的capInsets在哪里呢？打开图片对应的.json文件，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">　&#123;</div><div class="line">　&quot;images&quot; : [</div><div class="line">　&#123;</div><div class="line">　&quot;resizing&quot; : &#123;</div><div class="line">　&quot;mode&quot; : &quot;9-part&quot;,</div><div class="line">　&quot;center&quot; : &#123;</div><div class="line">　&quot;mode&quot; : &quot;tile&quot;,</div><div class="line">　&quot;width&quot; : 42,</div><div class="line">　&quot;height&quot; : 92</div><div class="line">　&#125;,</div><div class="line">　&quot;cap-insets&quot; : &#123;</div><div class="line">　&quot;bottom&quot; : 0,</div><div class="line">　&quot;top&quot; : 95,</div><div class="line">　&quot;right&quot; : 41,</div><div class="line">　&quot;left&quot; : 0</div><div class="line">　&#125;</div><div class="line">　&#125;,</div></pre></td></tr></table></figure></p>
<p>从文件可以看出来<code>top</code>、<code>left</code>、<code>bottom</code>、<code>right</code>对应的就是上左下右的指示线，看到<code>mode</code>为<code>tile</code>，就知道<code>Image Slicing</code>默认为平铺缩放，对于<code>width</code>与<code>Height</code>是做什么的呢？<code>Width</code>代表的是左侧线（或者上方线）和中间线之间的区域，<code>Height</code>代表的是上侧线和中间线之间的区域。<br>　<br><strong>做个测试:</strong><br><img src="http://upload-images.jianshu.io/upload_images/1742252-b34b0ba9c060b6b5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>这是一张2倍像素的图片，我把它拖入<code>Assets.xcassets</code>中。选择右下角<code>Slices</code>的类型为<code>Horizontal and Vertical</code>：<br><img src="http://upload-images.jianshu.io/upload_images/1742252-e7a7d9c4985dcfbe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>左侧ShowSlicing显示如下：<br><img src="http://upload-images.jianshu.io/upload_images/1742252-eb33b0aeff17a826.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>　<br>在<code>storyboard</code>拖入一个<code>ImageView</code>，上下左右距离边框均为20。则显示如下：<br><img src="http://upload-images.jianshu.io/upload_images/1742252-125247c0447ce40d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>　<br>　<br>简单来记就是纵横各三条线，线之外的四个角不会拉伸。六条线内部交汇处，亮色区域为拉伸区域，灰色蒙版区域被截取掉，不显示。<br><img src="http://upload-images.jianshu.io/upload_images/1742252-8466683618f04182.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20171122_5.png"><br>　<br>　<br>如果在Xib或者StoryBoard中可以通过View 的Stretching属性来设置。<br><img src="http://upload-images.jianshu.io/upload_images/1742252-93e53b20cb9013f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png">
　</p>
<h1 id="UIEdgeInsetsMake使用例子"><a href="#UIEdgeInsetsMake使用例子" class="headerlink" title="UIEdgeInsetsMake使用例子"></a>UIEdgeInsetsMake使用例子</h1><p>在创建button的时候经常需要在button上添加图片和按钮，而且一般情况下我们需要的都是图片在上、标题在下的效果（灰色的为button）：<br><img src="http://upload-images.jianshu.io/upload_images/1742252-88d42bbe9fd22132.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>而当我们设置好title和image后发现是图片居左，标题居右的：<br><img src="http://upload-images.jianshu.io/upload_images/1742252-efb0d15ff27c14f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>　<br>当然这不是我们想要的效果，于是通过设置<code>UIEdgeInsetsMake</code>属性来达到我们想要的效果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">　typedef struct UIEdgeInsets &#123;</div><div class="line">　CGFloat top, left, bottom, right; // specify amount to inset (positive) for each of the edges. values can be negative to &apos;outset&apos;</div><div class="line">　&#125; UIEdgeInsets;</div></pre></td></tr></table></figure></p>
<p>UIEdgeInsetsMake(&lt;#CGFloat top#&gt;, &lt;#CGFloat left#&gt;, &lt;#CGFloat bottom#&gt;, &lt;#CGFloat right#&gt;)要设置的就是四个边距<br><img src="http://upload-images.jianshu.io/upload_images/1742252-a6e661e7724231bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>　<br>图中，蓝色标识为可变区域， 绿色标识为不变区域。<br>上面的图片来自于<a href="https://00red.com/blog/2015/07/28/teacher-swift-ui-button/" target="_blank" rel="external">一叶博客</a><br>可以这样理解:<code>top</code>就是距离顶部的距离在默认的基础上又加上设置的距离，拿开头的button来说，在button仅设置image的时候（如果同时设置了image和title效果又是不一样的，下面会详解，稍安勿躁），image默认是居中的，相当于进行了这样的设置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　[button setImageEdgeInsets:UIEdgeInsetsMake(0, 0, 0, 0)];</div></pre></td></tr></table></figure></p>
<p>如果我们在这个时候设置了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　[button setImageEdgeInsets:UIEdgeInsetsMake(20, 0, 0, 0)];</div></pre></td></tr></table></figure></p>
<p>就相当于在图片居中的基础上，将图片又下移了20，如果是-20则是在原有的基础上向上移20，其他几个参数同理，正数就是距相应的边的距离增加，负数就是距相应的距离减少。
　</p>
<h2 id="为button同时设置图片和标题"><a href="#为button同时设置图片和标题" class="headerlink" title="为button同时设置图片和标题"></a>为button同时设置图片和标题</h2><p>当我们给button设置图片和title的时候默认是图片居左，标题距右并排排列的<br>当我们同时添加图片和标题时，图片默认会向左偏移button的titleLabel的宽度，而标题会向右偏移图片的宽度，既然如此，我们就可以设置偏移量来达到我们想要的任何效果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">　[button setImageEdgeInsets:UIEdgeInsetsMake(0, 0, 0, -button.titleLabel.intrinsicContentSize.width)];</div><div class="line">　[button setTitleEdgeInsets:UIEdgeInsetsMake(0, -button.currentImage.size.width, 0, 0)];</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-c82e31f9bd421e28.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>设置image偏移量的时候并不是设置的-button.titleLabel.bounds.size.width，而是-button.titleLabel.intrinsicContentSize.width，因为在iOS8之后-button.titleLabel.bounds.size.width的值为0，经多方搜索才找到一个替代的方法，这样设置的意义就是将image的偏移量距右边的距离减少了titleLabel的宽度，由于默认是向左便宜了这么多，我们这样设置之后相当于抵消了左移的偏移量，所以图片就居中了，对于title道理是一样的。这一点明白之后剩下的就没什么难题了，继续，title下移，image上移：<br>　<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">　[button setImageEdgeInsets:UIEdgeInsetsMake(-button.titleLabel.intrinsicContentSize.height, 0, 0, -button.titleLabel.intrinsicContentSize.width)];</div><div class="line">　[button setTitleEdgeInsets:UIEdgeInsetsMake(button.currentImage.size.height, -button.currentImage.size.width, 0, 0)];</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-8d7bafae6b318462.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>图片和标题好像有点近，好办，再加一点：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　[button setTitleEdgeInsets:UIEdgeInsetsMake(button.currentImage.size.height + 20, -button.currentImage.size.width, 0, 0)];</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-0aa223f06c30ba91.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">　UIButton *button = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, 160, 160)];</div><div class="line">　[button setImage:[UIImage imageNamed:@&quot;ffw_32&quot;] forState:UIControlStateNormal];</div><div class="line">　[button setTitle:@&quot;按钮&quot; forState:UIControlStateNormal];</div><div class="line">　button.titleLabel.font = [UIFont systemFontOfSize:14];</div><div class="line">　[button setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];</div><div class="line">　button.center = self.view.center;</div><div class="line">　button.backgroundColor = [UIColor grayColor];</div><div class="line">　[self.view addSubview:button];</div><div class="line">　NSLog(@&quot;%f&quot;,-button.titleLabel.bounds.size.width);</div><div class="line">　</div><div class="line">　</div><div class="line">　[button setImageEdgeInsets:UIEdgeInsetsMake(-button.titleLabel.intrinsicContentSize.height, 0, 0, -button.titleLabel.intrinsicContentSize.width)];</div><div class="line">　[button setTitleEdgeInsets:UIEdgeInsetsMake(button.currentImage.size.height + 20, -button.currentImage.size.width, 0, 0)];</div></pre></td></tr></table></figure></p>
<p>　</p>
<h2 id="例子-在代码中使用UIProgressView-设置了Progress-Image和Track-Image没能正常的工作"><a href="#例子-在代码中使用UIProgressView-设置了Progress-Image和Track-Image没能正常的工作" class="headerlink" title="例子:在代码中使用UIProgressView 设置了Progress Image和Track Image没能正常的工作"></a>例子:在代码中使用UIProgressView 设置了Progress Image和Track Image没能正常的工作</h2><p>Progress Image：<br><img src="http://upload-images.jianshu.io/upload_images/1742252-fe70f7155a5118fc.png" alt=""><br>　<br>Track Image：<br><img src="http://upload-images.jianshu.io/upload_images/1742252-d41db1f45fd4a787.png" alt=""><br>　<br>效果图：<br><img src="http://upload-images.jianshu.io/upload_images/1742252-91b7df981a1985ab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>　<br>解决方法：<br>新建个子类继承UIProgressView,并添加两个属性分别是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">　@property (nonatomic,strong)UIImage *ggTrackImage;</div><div class="line">　@property (nonatomic,strong)UIImage *ggProgressImage;</div></pre></td></tr></table></figure></p>
<p>分别在set方法里对<code>UIProgressView</code>自带的<code>trackImage</code>,和<code>ProgressImge</code>进行赋值，因为iOS的bug就不能直接拿到属性进行赋值了，取出<code>UIProgressView</code>的<code>SubViews</code>，并根据自己的需求对图片进行拉伸，我这里选择的是平滑拉伸，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">　-(void)setGgTrackImage:(UIImage *)ggTrackImage</div><div class="line">　&#123;</div><div class="line">　_ggTrackImage=ggTrackImage;</div><div class="line">　UIImageView *trackImageView=self.subviews.firstObject;</div><div class="line">　CGRect trackProgressFrame=trackImageView.frame;</div><div class="line">　trackProgressFrame.size.height=self.frame.size.height;</div><div class="line">　trackImageView.frame=trackProgressFrame;</div><div class="line">　CGFloat width = _ggTrackImage.size.width/2.0;</div><div class="line">　CGFloat height = _ggTrackImage.size.height/2.0;</div><div class="line">　UIImage *imgTrack = [_ggTrackImage resizableImageWithCapInsets:UIEdgeInsetsMake(height, width, height, width)];</div><div class="line">　trackImageView.image=imgTrack;</div><div class="line">　&#125;</div><div class="line">　</div><div class="line">　-(void)setGgProgressImage:(UIImage *)ggProgressImage</div><div class="line">　&#123;</div><div class="line">　_ggProgressImage=ggProgressImage;</div><div class="line">　CGFloat width = _ggProgressImage.size.width/2.0;</div><div class="line">　CGFloat height = _ggProgressImage.size.height/2.0;</div><div class="line">　UIImageView *progressImageView=self.subviews.lastObject;</div><div class="line">　CGRect ProgressFrame=progressImageView.frame;</div><div class="line">　ProgressFrame.size.height=self.frame.size.height;</div><div class="line">　progressImageView.frame=ProgressFrame;</div><div class="line">　UIImage *imgProgress = [_ggProgressImage resizableImageWithCapInsets:UIEdgeInsetsMake(height, width, height， width)];progressImageView.image=imgProgress;</div><div class="line">　&#125;</div></pre></td></tr></table></figure></p>
<p>搞定，将这个类导入其他使用直接进行图片赋值即可
　
　</p>
<h3 id="参考博客"><a href="#参考博客" class="headerlink" title="参考博客:"></a>参考博客:</h3><p>　<a href="http://www.jianshu.com/p/3907e6116f41" target="_blank" rel="external">http://www.jianshu.com/p/3907e6116f41</a><br>　<a href="http://www.jianshu.com/p/af2d471f7b9c" target="_blank" rel="external">http://www.jianshu.com/p/af2d471f7b9c</a><br>　<a href="http://www.jianshu.com/p/a577023677c1" target="_blank" rel="external">http://www.jianshu.com/p/a577023677c1</a><br>　<a href="http://www.jianshu.com/p/4e4801cbda2b" target="_blank" rel="external">http://www.jianshu.com/p/4e4801cbda2b</a><br>　<a href="http://www.jianshu.com/p/901f9b98f7c2" target="_blank" rel="external">http://www.jianshu.com/p/901f9b98f7c2</a><br>　<a href="http://www.jianshu.com/p/0d3dbc30fad5" target="_blank" rel="external">http://www.jianshu.com/p/0d3dbc30fad5</a>
　
　
　
　
　</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/17/2017-10-17/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/17/2017-10-17/" itemprop="url">
                  CocoaPods安装指南
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-17T23:50:38+08:00">
                2017-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这两年因为升级系统、更换电脑,帮助同事等前前后后安了4次CocoaPods,整理了一下CocoaPods的安装流程及过程中遇到的一些坑,算是比较全面,覆盖了所有可能碰到的问题。(taobao Gems 源已停止维护，现由 ruby-china 提供镜像服务.)</p>
<h1 id="CocoaPods是什么"><a href="#CocoaPods是什么" class="headerlink" title="CocoaPods是什么?"></a>CocoaPods是什么?</h1><p>CocoaPods 是开发 OS X 和 iOS 应用程序的一个第三方库的依赖管理工具。利用 CocoaPods，可以定义自己的依赖关系 (称作 pods)，并且随着时间的变化，以及在整个开发环境中对第三方库的版本管理非常方便。<br>CocoaPods 背后的理念主要体现在两个方面。<br>首先，在工程中引入第三方代码会涉及到许多内容。对开发者来说，工程文件的配置会让人很沮丧。在配置 build phases 和 linker flags 过程中，会引起许多人为因素的错误。CocoaPods 简化了这一切，它能够自动配置编译选项。<br>通过 CocoaPods，可以很方便的查找到新的第三方库。<br>CocoaPods是用 Ruby 写的，想要使用它首先要有Ruby环境.<br>RubyGems简称gems,是一个用于对Ruby组件进行打包的Ruby打包系统</p>
<h1 id="一-流程"><a href="#一-流程" class="headerlink" title="一. 流程"></a>一. 流程</h1><p>##第一步：安装rvm</p>
<p>不管需不需要升级ruby，rvm可以让你拥有多个版本的Ruby，并且可以在多个版本之间自由切换。如果已经安装过跳到第2步（rvm -v 查看是否安装）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ curl -L get.rvm.io | bash -s stable</div><div class="line"></div><div class="line">//需要等一会</div><div class="line"></div><div class="line">$ source ~/.bashrc</div><div class="line"></div><div class="line">$ source ~/.bash_profile</div></pre></td></tr></table></figure></p>
<p>等待终端加载完毕,后输入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rvm -v</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-258fa148e864fec2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>如果能显示版本好则安装成功了。</p>
<h2 id="第二步：安装ruby"><a href="#第二步：安装ruby" class="headerlink" title="第二步：安装ruby"></a>第二步：安装ruby</h2><p>CocoaPods目前安装需要<em>Ruby的版本大于2.2.2</em>,不然会报错：<em>Error installing pods: activesupport requires Ruby version &gt;= 2.2.2</em>。目前Mac系统默认自带是2.0，所以需要升级。</p>
<p>查看已安装的ruby:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rvm list</div><div class="line">//ruby -v  //也可以查看ruby版本</div></pre></td></tr></table></figure></p>
<p>如果已安装版本大于2.2.2，直接到第3步。</p>
<p>//列出ruby可安装的版本信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rvm list known</div><div class="line"></div><div class="line">rvm install 2.2.2  //安装一个ruby版本</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-afd56a08f1f9be63.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>这里一定要设置为默认版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rvm use 2.2.2 --default</div></pre></td></tr></table></figure></p>
<h2 id="第三步：更换源"><a href="#第三步：更换源" class="headerlink" title="第三步：更换源"></a>第三步：更换源</h2><p>我们需要来修改更换源（由于国内被墙）所以要把源切换至 ruby-china 在终端执行以下命令</p>
<p>网上文章大都是这面这种：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo gem update --system</div><div class="line"></div><div class="line">$ gem sources --remove https://rubygems.org/</div></pre></td></tr></table></figure></p>
<p>等有反应之后再敲入以下命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ gem sources -a https://ruby.taobao.org/</div></pre></td></tr></table></figure></p>
<p>这里是个大坑：会报错 <em>_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed (<a href="https://ruby.taobao.org/specs.4.8.gz" target="_blank" rel="external">https://ruby.taobao.org/specs.4.8.gz</a>)</em><br>这是因为taobao Gems 源已停止维护，现由 ruby-china 提供镜像服务，正确的操作是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ sudo gem update --system</div><div class="line"></div><div class="line">$ gem sources --remove https://rubygems.org/</div><div class="line"></div><div class="line">$ gem sources --remove https://ruby.taobao.org/       //如果安装了淘宝的镜像</div></pre></td></tr></table></figure></p>
<p>等有反应之后再敲入以下命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem sources -a https://gems.ruby-china.org/</div></pre></td></tr></table></figure></p>
<p>为了验证你的Ruby镜像是并且仅是<em>ruby-china</em>，可以用以下命令查看：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ gem sources -l</div></pre></td></tr></table></figure></p>
<p>只有在终端中出现下面文字才表明你上面的命令是成功的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">*** CURRENT SOURCES ***</div><div class="line"></div><div class="line">https://gems.ruby-china.org/</div></pre></td></tr></table></figure></p>
<p>确保只有 <em>gems.ruby-china.org</em></p>
<p>##第四步：安装CocoaPods<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo gem install -n /usr/local/bin cocoapods</div><div class="line">(苹果系统 OS X EL Capitan 前为sudo gem install cocoapods)</div></pre></td></tr></table></figure></p>
<p>看看这样就成功了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Fetching: nap-1.1.0.gem (100%)</div><div class="line">Successfully installed nap-1.1.0</div><div class="line">Fetching: fourflusher-0.3.2.gem (100%)</div><div class="line">Successfully installed fourflusher-0.3.2</div><div class="line">...</div><div class="line">Parsing documentation for cocoapods-1.0.1</div><div class="line">Installing ri documentation for cocoapods-1.0.1</div><div class="line">Done installing documentation for nap, fourflusher, escape, colored, concurrent-ruby, thread_safe, tzinfo, i18n, activesupport, claide, xcodeproj, molinillo, cocoapods-try, netrc, cocoapods-trunk, cocoapods-stats, cocoapods-search, cocoapods-plugins, cocoapods-downloader, cocoapods-deintegrate, fuzzy_match, cocoapods-core, cocoapods after 146 seconds</div><div class="line">23 gems installed</div></pre></td></tr></table></figure></p>
<p>再加一句，完美解决<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo xcode-select --switch/Applications/Xcode.app</div></pre></td></tr></table></figure></p>
<p>在终端中输入如下命令来完成安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod setup</div></pre></td></tr></table></figure></p>
<p>它需要一点时间来完成，你等就是了</p>
<p>如果安装失败 ~/.cocoapods 里面是空的，就需要重新setup</p>
<p>命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pod repo remove master</div><div class="line"></div><div class="line">pod setup</div></pre></td></tr></table></figure></p>
<p>完毕之后这个文件夹大概有 100多M，需要花费比较多时间，请耐心等待。</p>
<p>到这里你已经成功安装了CocoaPods</p>
<p><strong>终极办法：把你已经装好了cocoaPods同时~/.cocoapods目录下的repo目录拷贝下来，放进自己的目录里。再  pod setup</strong></p>
<p>为了确定CocoaPods是否可以使用，可以用CocoaPods的搜索功能验证一下。在终端中输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pod search AFNetworking</div></pre></td></tr></table></figure></p>
<p>过一段时间之后（可能会比较久），你会在终端中看到一些红色的错误信息，<strong>Setting up CocoaPods master repo</strong>如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Setting up CocoaPods master repo</div><div class="line"></div><div class="line">[!] /usr/bin/[Git](http://lib.csdn.net/base/28)clone &apos;https://github.com/CocoaPods/Specs.git&apos; master --depth=1</div><div class="line"></div><div class="line">Cloning into &apos;master&apos;...</div><div class="line"></div><div class="line">error: RPC failed; result=52, HTTP code = 0</div><div class="line"></div><div class="line">fatal: The remote end hung up unexpectedly</div></pre></td></tr></table></figure></p>
<p>这说明CocoaPods还不能正常使用，需要更新pod，下载它的一些依赖包；在终端中输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pod setup</div></pre></td></tr></table></figure></p>
<p>过一段时间之后，你会在终端中看到跟上面同样的红色的错误信息。</p>
<p>敲入以上命令时，我终端上是这个样子的（由于太长，仅截取前面一部分）：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-6093391e737dedcd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>这说明某些环境原因导致pod更新不了，可能原因有，1）gem版本太低；2）github无法链接；3）.cocoapods目录下的配置信息错误。我们可以一个一个来排除，</p>
<p>首先更新gem到最新版本，在终端中输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo gem update --system</div></pre></td></tr></table></figure></p>
<p>然后检查是否可以ping通github，在终端中输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ping github.com</div></pre></td></tr></table></figure></p>
<p>然后查看pob repo list：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pod repo list</div></pre></td></tr></table></figure></p>
<p>cd  到该目录里，用du -sh <em>命令来查看文件大小<br>`cd ~/.cocoapods 进入cocoapods文件后在终端输入：du -sh </em>`<br>结果显示0 repos，说明没有安装成功；<br>在终端输入：<br>删除.cocoapods目录，重新下载pod更新：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ cd ~/.cocoapods/</div><div class="line"></div><div class="line">$ sudo -rm -rf ~/.cocoapods/</div></pre></td></tr></table></figure></p>
<p>重新执行pod setup，过一段时间后提示setup completed,在终端中输入 pod list，展示出安装列表；</p>
<p>敲入以上命令时，小编终端上是这个样子的（由于太长，仅截取前面一部分）：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-dc1c847659af1fc1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-a897e0769b07b1b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-843d249d88a57eac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-3a4efe2c2d7c694a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-530c4c0424e8bb89.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>如果还是报错<code>unable to access &#39;https://github.com/CocoaPods/Specs.git/&#39;: SSLRead() return error -9806</code><br>遇到这种问题的话，可以手动去克隆一份到repos目录下面。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1.通过finder的前往文件夹进行查看       ~/.cocoapods/repos</div><div class="line">2.通过终端，进入到   ~/.cocoapods/repos</div><div class="line">3.然后通过   git clone https://github.com/CocoaPods/Specs.git</div></pre></td></tr></table></figure></p>
<p>可怜的你发现，速度真是慢啊，你等不了，还有一个解决方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">直接打开仓库链接，下载下来拷贝到相应的文件夹</div></pre></td></tr></table></figure></p>
<p>可怜的你还是发现，下载速度也很慢啊，这里还有一个解决方案<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">终极解决方案，找一台工作正常的电脑，到他的~/.cocoapods/repos目录下面拷贝出master文件到自己的Mac上的相应位置</div></pre></td></tr></table></figure></p>
<p>好了，现在我们重新检测一下是否能正常运行。<br>如果又报错：<code>[!] Unable to find a pod with name, author, summary, or descriptionmatching &#39;AFNetworking&#39;</code><br>重置下json文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm ~/Library/Caches/CocoaPods/search_index.json</div></pre></td></tr></table></figure></p>
<p>看到这里，你心里会不会说，我靠！太爽了，终于下载并且安装好了！接下来看下如何使用吧。。</p>
<blockquote>
<p><strong>关于vim命令</strong><br>比如打开_config.yml文件:vim _config.yml<br><em>先按ESC键，然后敲：，这是才可以敲命令</em>，比如强行退出可以敲 q!  ，如果需要保存退出就敲  x 或者 wq .<br><strong>vim命令合集: <a href="http://www.cnblogs.com/softwaretesting/archive/2011/07/12/2104435.html" target="_blank" rel="external">http://www.cnblogs.com/softwaretesting/archive/2011/07/12/2104435.html</a></strong></p>
</blockquote>
<p>我们先创建这个神奇的PodFile。在终端中进入（cd命令）你项目所在目录，然后在当前目录下，利用vim创建Podfile，运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vim Podfile</div></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ touch Podfile</div></pre></td></tr></table></figure></p>
<p>然后在Podfile文件中输入以下文字：</p>
<p>需要注意的是podfile里面输入的格式变了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">platform :ios, &apos;8.0&apos;</div><div class="line">#use_frameworks!个别需要用到它，比如reactiveCocoa</div><div class="line"></div><div class="line">target &apos;你的项目名称&apos; do</div><div class="line">pod &apos;AFNetworking&apos;, &apos;~&gt; 3.1.0&apos;</div><div class="line"></div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>然后保存退出。vim环境下，保存退出命令是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">:wq</div></pre></td></tr></table></figure></p>
<p>这时候，你会发现你的项目目录中，出现一个名字为Podfile的文件，而且文件内容就是你刚刚输入的内容。注意，Podfile文件应该和你的工程文件.xcodeproj在同一个目录下。</p>
<p>这时候，你就可以利用CocoPods下载AFNetworking类库了。还是在终端中的当前项目目录下，运行以下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pod install</div></pre></td></tr></table></figure></p>
<p>使用下面的命令会更快<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pod install --verbose --no-repo-update</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-bcb0bc1ee40549de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>注意最后一句话，意思是：以后打开项目就用 CocoaPodsDemo.xcworkspace 打开，而不是之前的.xcodeproj文件。否则无法关联pod下来的类库。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-5776c1240402ceeb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>#二. 遇到的一些坑</p>
<p>##Setting up CocoaPods master repo 卡着不动<br>1、那是因为 淘宝的那个镜像(<a href="https://ruby.taobao.org/" target="_blank" rel="external">https://ruby.taobao.org/</a> )已经不可用了。所以我们现在用最新支持的ruby镜像(<a href="https://gems.ruby-china.org/" target="_blank" rel="external">https://gems.ruby-china.org/</a>)</p>
<p>需要的命令行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ gem sources -r https://rubygems.org/ （移除旧版本的镜像，如果你不知道你电脑上目前用的是什么镜像，可用  $ gem sources -l  来查看）</div><div class="line">$ gem sources -a https://gems.ruby-china.org/ （增加可用的镜像）</div><div class="line">$ gem sources -l  （用来检查使用替换镜像位置成功）</div></pre></td></tr></table></figure></p>
<p>2、当pod setup 进入Setting up CocoaPods master repo 等待的时候表示正在下载了，此时你可通过新开一个终端窗口，输入”cd ~/.cocoapods/“命令行跳到cocoapods文件夹内，执行”du -sh *”查看正在下载的文件夹的大小</p>
<p>3、当出现如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[!] An error occurred while performing `git pull` on repo `master`.</div><div class="line"></div><div class="line">[!] /usr/bin/git pull --ff-only</div></pre></td></tr></table></figure></p>
<p>这个错误应该是说这个节点有问题。试试把cocoapods的节点删除，重新添加一个节点，或许就行，说干就干：</p>
<p><em>原因： Cocoapods的分支不支持当前最新的Xcode版本</em></p>
<p><em>解决办法: 删除master分支 重新建立新的分支</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo rm -fr ~/.cocoapods/repos/master</div><div class="line"></div><div class="line">然后再: pod setup</div></pre></td></tr></table></figure></p>
<p>##Cocoapods的安装报错 - （ERROR: Error installing cocoapods: activesupport requires Ruby version &gt;= 2.2）<br>1.移除现有 Ruby 默认源<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$gem sources --remove https://rubygems.org/</div></pre></td></tr></table></figure></p>
<p>2.使用新的源 淘宝镜像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$gem sources -a https://ruby.taobao.org/</div></pre></td></tr></table></figure></p>
<p>3.验证新源是否替换成功<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$gem sources -l</div></pre></td></tr></table></figure></p>
<p>成功后提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">*** CURRENT SOURCES ***</div><div class="line">https://ruby.taobao.org/</div></pre></td></tr></table></figure></p>
<p>4.开始安装cocoapods<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$sudo gem install cocoapods</div></pre></td></tr></table></figure></p>
<p>这时候提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Fetching: i18n-0.7.0.gem (100%)</div><div class="line">Successfully installed i18n-0.7.0</div><div class="line">Fetching: thread_safe-0.3.5.gem (100%)</div><div class="line">Successfully installed thread_safe-0.3.5</div><div class="line">Fetching: tzinfo-1.2.2.gem (100%)</div><div class="line">Successfully installed tzinfo-1.2.2</div><div class="line">Fetching: minitest-5.9.0.gem (100%)</div><div class="line">Successfully installed minitest-5.9.0</div><div class="line">Fetching: concurrent-ruby-1.0.2.gem (100%)</div><div class="line">Successfully installed concurrent-ruby-1.0.2</div><div class="line">Fetching: activesupport-5.0.0.gem (100%)</div><div class="line">ERROR:  Error installing cocoapods:</div><div class="line">activesupport requires Ruby version &gt;= 2.2.2.</div></pre></td></tr></table></figure></p>
<p>这个地方很坑，之前安装cocoapods一直是没有这个问题的，这里提示Ruby版本要大于或等于2.2.2<br>于是查看已安装的ruby版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ruby -v</div></pre></td></tr></table></figure></p>
<p>ruby 2.0.0p648 (2015-12-16 revision 53162) [universal.x86_64-darwin15]<br>果然这里就要升级ruby版本啦<br>列出ruby可安装的版本信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$rvm list known</div></pre></td></tr></table></figure></p>
<p><em>如果提示command not found,说明没安装RVM;否则跳过</em><br><strong>安装rvm baby 版本管理器</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$curl -L get.rvm.io | bash -s stable</div></pre></td></tr></table></figure>
<p>//<strong><em>__</em></strong>等安装完成 出现下面这行提示以下<strong><strong>___</strong></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">In case of problems: https://rvm.io/helpandhttps://twitter.com/rvm_io</div></pre></td></tr></table></figure></p>
<p>执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$source ~/.bashrc</div><div class="line"></div><div class="line">$source ~/.bash_profile</div></pre></td></tr></table></figure></p>
<p>测试 RVM baby 版本管理器 是否安装正常<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$rvm -v</div></pre></td></tr></table></figure></p>
<p>//<strong><em>__</em></strong>提示以下<strong><strong>___</strong></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rvm 1.27.0 (latest) by Wayne E. Seguin, Michal Papis[https://rvm.io/]</div></pre></td></tr></table></figure></p>
<p><strong>用RVM升级Ruby 查看当前已安装ruby版本</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ruby -v</div><div class="line"></div><div class="line">$rvm list known</div></pre></td></tr></table></figure></p>
<p>列出ruby可安装的版本信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"># MRI Rubies</div><div class="line">[ruby-]1.8.6[-p420]</div><div class="line">[ruby-]1.8.7[-head] # security released on head</div><div class="line">[ruby-]1.9.1[-p431]</div><div class="line">[ruby-]1.9.2[-p330]</div><div class="line">[ruby-]1.9.3[-p551]</div><div class="line">[ruby-]2.0.0[-p648]</div><div class="line">[ruby-]2.1[.8]</div><div class="line">[ruby-]2.2[.4]</div><div class="line">[ruby-]2.3[.0]</div><div class="line">[ruby-]2.2-head</div><div class="line">ruby-head</div><div class="line"></div><div class="line"># for forks use: rvm install ruby-head-&lt;name&gt; --url https://github.com/github/ruby.git --branch 2.2</div><div class="line"></div><div class="line"># JRuby</div><div class="line">jruby-1.6[.8]</div><div class="line">jruby-1.7[.23]</div><div class="line">jruby[-9.0.5.0]</div><div class="line">jruby-head</div><div class="line"></div><div class="line"># Rubinius</div><div class="line">rbx-1[.4.3]</div><div class="line">rbx-2.3[.0]</div><div class="line">rbx-2.4[.1]</div><div class="line">rbx[-2.5.8]</div><div class="line">rbx-head</div><div class="line"></div><div class="line"># Opal</div><div class="line">opal</div><div class="line"></div><div class="line"># Minimalistic ruby implementation - ISO 30170:2012</div><div class="line">mruby[-head]</div><div class="line"></div><div class="line"># Ruby Enterprise Edition</div><div class="line">ree-1.8.6</div><div class="line">ree[-1.8.7][-2012.02]</div><div class="line"></div><div class="line"># GoRuby</div><div class="line">goruby</div><div class="line"></div><div class="line"># Topaz</div><div class="line">topaz</div><div class="line"></div><div class="line"># MagLev</div><div class="line">maglev[-head]</div><div class="line">maglev-1.0.0</div><div class="line"></div><div class="line"># Mac OS X Snow Leopard Or Newer</div><div class="line">macruby-0.10</div><div class="line">macruby-0.11</div><div class="line">macruby[-0.12]</div><div class="line">macruby-nightly</div><div class="line">macruby-head</div><div class="line"></div><div class="line"># IronRuby</div><div class="line">ironruby[-1.1.3]</div><div class="line">ironruby-head</div></pre></td></tr></table></figure></p>
<p>这里我们安装2.2.2:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$rvm install 2.2.2</div></pre></td></tr></table></figure></p>
<p>终端运行结果：（如果直接成功请绕过homebrew的卸载安装）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Searching for binary rubies, this might take some time.</div><div class="line">Found remote file https://rvm_io.global.ssl.fastly.net/binaries/osx/10.11/x86_64/ruby-2.2.2.tar.bz2</div><div class="line">Checking requirements for osx.</div><div class="line">About to install Homebrew, press `Enter` for default installation in `/usr/local`,</div><div class="line">type new path if you wish custom Homebrew installation (the path needs to be writable for user)</div><div class="line">:</div></pre></td></tr></table></figure></p>
<p>回车：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">It appears Homebrew is already installed. If your intent is to reinstall you</div><div class="line">should do the following before running this installer again:</div><div class="line">ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)&quot;</div><div class="line">The current contents of /usr/local are .git</div><div class="line">Requirements installation failed with status: 1.</div></pre></td></tr></table></figure></p>
<p>这里执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)&quot;</div></pre></td></tr></table></figure></p>
<p>卸载home-brew<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Warning: This script will remove:</div><div class="line">/Library/Caches/Homebrew/</div><div class="line">/usr/local/.git/</div><div class="line">Are you sure you want to uninstall Homebrew? [y/N] y</div><div class="line">==&gt; Removing Homebrew installation...</div><div class="line">==&gt; Removing empty directories...</div><div class="line">==&gt; Homebrew uninstalled!</div><div class="line">You may want to restore /usr/local&apos;s original permissions</div><div class="line">sudo chmod 0755 /usr/local</div><div class="line">sudo chgrp wheel /usr/local</div></pre></td></tr></table></figure></p>
<p>再执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ rvm install 2.2.2</div><div class="line">提示：</div><div class="line">Searching for binary rubies, this might take some time.</div><div class="line">Found remote file https://rvm_io.global.ssl.fastly.net/binaries/osx/10.11/x86_64/ruby-2.2.2.tar.bz2</div><div class="line">Checking requirements for osx.</div><div class="line">About to install Homebrew, press `Enter` for default installation in `/usr/local`,</div><div class="line">type new path if you wish custom Homebrew installation (the path needs to be writable for user)</div><div class="line">:</div></pre></td></tr></table></figure></p>
<p>按回车：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">==&gt; This script will install:</div><div class="line">/usr/local/bin/brew</div><div class="line">/usr/local/Library/...</div><div class="line">/usr/local/share/doc/homebrew</div><div class="line">/usr/local/share/man/man1/brew.1</div><div class="line">/usr/local/share/zsh/site-functions/_brew</div><div class="line">/usr/local/etc/bash_completion.d/brew</div><div class="line"></div><div class="line">Press RETURN to continue or any other key to abort</div><div class="line">==&gt; /usr/bin/sudo /bin/mkdir /Library/Caches/Homebrew</div><div class="line">Password:</div></pre></td></tr></table></figure></p>
<p>这里需要输入电脑密码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">==&gt; /usr/bin/sudo /bin/chmod g+rwx /Library/Caches/Homebrew</div><div class="line">==&gt; /usr/bin/sudo /usr/sbin/chown haha /Library/Caches/Homebrew</div><div class="line">==&gt; Downloading and installing Homebrew...</div><div class="line">remote: Counting objects: 501, done.</div><div class="line">remote: Compressing objects: 100% (445/445), done.</div><div class="line">remote: Total 501 (delta 29), reused 360 (delta 27), pack-reused 0</div><div class="line">Receiving objects: 100% (501/501), 787.83 KiB | 169.00 KiB/s, done.</div><div class="line">Resolving deltas: 100% (29/29), done.</div><div class="line">From https://github.com/Homebrew/brew</div><div class="line">* [new branch]      master     -&gt; origin/master</div><div class="line">HEAD is now at 32f7e73 download_strategy: ensure fixed commit hash length</div><div class="line">==&gt; Tapping homebrew/core</div><div class="line">Cloning into &apos;/usr/local/Library/Taps/homebrew/homebrew-core&apos;...</div><div class="line">remote: Counting objects: 3714, done.</div><div class="line">remote: Compressing objects: 100% (3598/3598), done.</div><div class="line">remote: Total 3714 (delta 14), reused 2112 (delta 6), pack-reused 0</div><div class="line">Receiving objects: 100% (3714/3714), 2.88 MiB | 240.00 KiB/s, done.</div><div class="line">Resolving deltas: 100% (14/14), done.</div><div class="line">Checking connectivity... done.</div><div class="line">Checking out files: 100% (3717/3717), done.</div><div class="line">Tapped 3591 formulae (3,740 files, 9.0M)</div><div class="line">==&gt; Installation successful!</div><div class="line">==&gt; Next steps</div><div class="line">Run `brew help` to get started</div><div class="line">Further documentation: https://git.io/brew-docs</div><div class="line">==&gt; Homebrew has enabled anonymous aggregate user behaviour analytics</div><div class="line">Read the analytics documentation (and how to opt-out) here:</div><div class="line">https://git.io/brew-analytics</div><div class="line">Installing requirements for osx.</div><div class="line">Updating system.....</div><div class="line">Installing required packages: autoconf, automake, libtool, pkg-config, libyaml, readline, libksba, openssl........</div><div class="line">Certificates in &apos;/usr/local/etc/openssl/cert.pem&apos; are already up to date.</div><div class="line">Requirements installation successful.</div><div class="line">ruby-2.2.2 - #configure</div><div class="line">ruby-2.2.2 - #download</div><div class="line">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</div><div class="line">Dload  Upload   Total   Spent    Left  Speed</div><div class="line">100 6854k  100 6854k    0     0  61342      0  0:01:54  0:01:54 --:--:--  132k</div><div class="line">ruby-2.2.2 - #validate archive</div><div class="line">...</div><div class="line">ruby-2.2.2 - #generating default wrappers........</div><div class="line">Updating certificates in &apos;/etc/openssl/cert.pem&apos;.</div><div class="line">mkdir: /etc/openssl: Permission denied</div><div class="line">mkdir -p &quot;/etc/openssl&quot; failed, retrying with sudo</div><div class="line">haha password required for &apos;mkdir -p /etc/openssl&apos;:</div><div class="line">and sudo mkdir worked</div></pre></td></tr></table></figure></p>
<p>这样ruby2.2.2就安装好了<br>现在就可以安装cocoapods啦 (上跳流程第四步)：</p>
<p>##安装ruby遇到” Installing Homebrew - Brew Command Not Found”命令找不到解决方案：<br>Check XCode is installed or not.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$gcc --version</div><div class="line"></div><div class="line">$ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</div><div class="line"></div><div class="line">$brew doctor</div><div class="line"></div><div class="line">$brew update.</div></pre></td></tr></table></figure></p>
<p>完成后 执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ruby -v</div></pre></td></tr></table></figure></p>
<p>//–––––打印输出–––––––<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ruby 2.2.2p95 (2015-04-13 revision 50295) [x86_64-darwin14]</div></pre></td></tr></table></figure></p>
<p>##CocoaPods报错：The dependency <code>AFNetworking</code> is not used in any concrete target<br>在创建Podfile的时候，用这种格式使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">platform :ios, &apos;8.0&apos;</div><div class="line">#use_frameworks!个别需要用到它，比如reactiveCocoa</div><div class="line"></div><div class="line">target &apos;MyApp&apos; do</div><div class="line">pod &apos;AFNetworking&apos;, &apos;~&gt; 2.6&apos;</div><div class="line">pod &apos;ORStackView&apos;, &apos;~&gt; 3.0&apos;</div><div class="line">pod &apos;SwiftyJSON&apos;, &apos;~&gt; 2.3&apos;</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>里面的 MyApp 记得替换为自己攻城里面的target。这样就基本OK了，执行pod install / pod update 就都可以了。（use_frameworks! 这个是个别需要的，这里修改一下，可以把我上面的代码中的这一行【删除】）<br>下面是另外一种写法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">platform :ios, &apos;8.0&apos;</div><div class="line">#use_frameworks!个别需要用到它，比如reactiveCocoa</div><div class="line"></div><div class="line">def pods</div><div class="line">pod &apos;AFNetworking&apos;, &apos;~&gt; 2.6&apos;</div><div class="line">pod &apos;ORStackView&apos;, &apos;~&gt; 3.0&apos;</div><div class="line">pod &apos;SwiftyJSON&apos;, &apos;~&gt; 2.3&apos;</div><div class="line">end</div><div class="line">target &apos;MyApp&apos; do</div><div class="line">pods</div><div class="line">end</div></pre></td></tr></table></figure></p>
<p>##运行 sudo gem update –system 终端提示Updating rubygems-update ERROR: While executing gem … (Errno::EPERM) Operation not permitted - /usr/bin/update_rubygems</p>
<p>Mac OS X 10.11后不能使用sudo gem update –system了<br>需要替换成：sudo gem update -n /usr/local/bin —system<br>$ sudo gem update -n /usr/local/bin —system<br>终端提示貌似没有可以更新的内容<br><code>Updating installed gems Nothing to update</code></p>
<p>本文参考:</p>
<blockquote>
<p><a href="http://www.jianshu.com/p/6fff9dcaac3c" target="_blank" rel="external">海旋意境的博客&lt;<cocoapods安装2017>&gt;</cocoapods安装2017></a><br><a href="http://blog.csdn.net/fairytale_1/article/details/51850734" target="_blank" rel="external">fairytale_1的博客&lt;&lt;关于安装cocoapods遇到的一些坑（ERROR: Error installing cocoapods: activesupport requires Ruby version &gt;= 2.2）&gt;&gt;</a><br><a href="http://www.cnblogs.com/gongyuhonglou/p/5801681.html" target="_blank" rel="external">公羽寒的博客&lt;<cocoapods的安装报错 -="" error="" installing="" pods:activesupport="" requires="" ruby="" version="">=2.2.2&gt;&gt;</cocoapods的安装报错></a><br><a href="http://www.jianshu.com/p/5a8a86dc36a6" target="_blank" rel="external">CrazySteven的博客&lt;<cocoapods的更新>&gt;</cocoapods的更新></a><br><a href="http://blog.csdn.net/sjl_leaf/article/details/50506057" target="_blank" rel="external">史金亮的博客&lt;<cocoapods报错：the dependency="" 'afnetworking="" '="" is="" not="" used="" in="" any="" concrete="" target="">&gt;</cocoapods报错：the></a><br><a href="http://www.jianshu.com/p/d5a9e4bee015" target="_blank" rel="external">果啤的博客&lt;&lt;我第一次成功安装CocoaPods的过程&gt;&gt;</a><br><a href="http://www.cnblogs.com/lidarui/p/6015698.html" target="_blank" rel="external">timeToShow的博客&lt;<cocoapods安装及常用命令>&gt;</cocoapods安装及常用命令></a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/10/iOS-TIPS/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/10/iOS-TIPS/" itemprop="url">
                  iOS TIPS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-10T23:49:27+08:00">
                2017-03-10
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、设置UILabel行间距</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">NSMutableAttributedString* attrString = [[NSMutableAttributedString  alloc] initWithString:label.text];</div><div class="line">NSMutableParagraphStyle *style = [[NSMutableParagraphStyle alloc] init];</div><div class="line">[style setLineSpacing:20];</div><div class="line">[attrString addAttribute:NSParagraphStyleAttributeName value:style range:NSMakeRange(0, label.text.length)];</div><div class="line">label.attributedText = attrString;</div><div class="line">// 或者使用xib，看下gif图</div></pre></td></tr></table></figure>
<p><img src="http://ofutv2nt8.bkt.clouddn.com/1499657090104458.gif" alt=""></p>
<p>2、当使用-performSelector:withObject:withObject:afterDelay:方法时，需要传入多参数问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">// 方法一、</div><div class="line">// 把参数放进一个数组／字典，直接把数组／字典当成一个参数传过去，具体方法实现的地方再解析这个数组／字典</div><div class="line">NSArray * array =</div><div class="line">[NSArray arrayWithObjects: @&quot;first&quot;, @&quot;second&quot;, nil];</div><div class="line">[self performSelector:@selector(fooFirstInput:) withObject: array afterDelay:15.0];</div><div class="line"></div><div class="line">// 方法二、</div><div class="line">// 使用NSInvocation</div><div class="line">SEL aSelector = NSSelectorFromString(@&quot;doSoming:argument2:&quot;);</div><div class="line">NSInteger argument1 = 10;</div><div class="line">NSString *argument2 = @&quot;argument2&quot;;</div><div class="line">if([self respondsToSelector:aSelector]) &#123;</div><div class="line">NSInvocation *inv = [NSInvocation invocationWithMethodSignature:[self methodSignatureForSelector:aSelector]];</div><div class="line">[inv setSelector:aSelector];</div><div class="line">[inv setTarget:self];</div><div class="line">[inv setArgument:&amp;(argument1) atIndex:2];</div><div class="line">[inv setArgument:&amp;(argument2) atIndex:3];</div><div class="line">[inv performSelector:@selector(invoke) withObject:nil afterDelay:15.0];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>3、UILabel显示不同颜色字体</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">NSMutableAttributedString * string = [[NSMutableAttributedString alloc] initWithString:label.text];</div><div class="line">[string addAttribute:NSForegroundColorAttributeName value:[UIColor redColor] range:NSMakeRange(0,5)];</div><div class="line">[string addAttribute:NSForegroundColorAttributeName value:[UIColor greenColor] range:NSMakeRange(5,6)];</div><div class="line">[string addAttribute:NSForegroundColorAttributeName value:[UIColor blueColor] range:NSMakeRange(11,5)];</div><div class="line">label.attributedText = string;</div></pre></td></tr></table></figure>
<p>4、比较两个CGRect/CGSize/CGPoint是否相等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">if (CGRectEqualToRect(rect1, rect2)) &#123; // 两个区域相等</div><div class="line">// do some</div><div class="line">&#125;</div><div class="line">if (CGPointEqualToPoint(point1, point2)) &#123; // 两个点相等</div><div class="line">// do some</div><div class="line">&#125;</div><div class="line">if (CGSizeEqualToSize(size1, size2)) &#123; // 两个size相等</div><div class="line">// do some</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>5、比较两个NSDate相差多少小时</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">NSDate* date1 = someDate;</div><div class="line">NSDate* date2 = someOtherDate;</div><div class="line">NSTimeInterval distanceBetweenDates = [date1 timeIntervalSinceDate:date2];</div><div class="line">double secondsInAnHour = 3600;</div><div class="line">// 除以3600是把秒化成小时，除以60得到结果为相差的分钟数</div><div class="line">NSInteger hoursBetweenDates = distanceBetweenDates / secondsInAnHour;</div></pre></td></tr></table></figure>
<p>6、每个cell之间增加间距</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// 方法一，每个分区只显示一行cell，分区头当作你想要的间距(注意，从数据源数组中取值的时候需要用indexPath.section而不是indexPath.row)</div><div class="line">- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView</div><div class="line">&#123;</div><div class="line">return yourArry.count;</div><div class="line">&#125;</div><div class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section</div><div class="line">&#123;</div><div class="line">return 1;</div><div class="line">&#125;</div><div class="line">-(CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section</div><div class="line">&#123;</div><div class="line">return cellSpacingHeight;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 方法二，在cell的contentView上加个稍微低一点的view，cell上原本的内容放在你的view上，而不是contentView上，这样能伪造出一个间距来。</div><div class="line"></div><div class="line">// 方法三，自定义cell，重写setFrame：方法</div><div class="line">- (void)setFrame:(CGRect)frame</div><div class="line">&#123;</div><div class="line">frame.size.height -= 20;</div><div class="line">[super setFrame:frame];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>7、播放一张张连续的图片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// 加入现在有三张图片分别为animate_1、animate_2、animate_3</div><div class="line">// 方法一</div><div class="line">imageView.animationImages = @[[UIImage imageNamed:@&quot;animate_1&quot;], [UIImage imageNamed:@&quot;animate_2&quot;], [UIImage imageNamed:@&quot;animate_3&quot;]];</div><div class="line">imageView.animationDuration = 1.0;</div><div class="line">// 方法二</div><div class="line">imageView.image = [UIImage animatedImageNamed:@&quot;animate_&quot; duration:1.0];</div><div class="line">// 方法二解释下，这个方法会加载animate_为前缀的，后边0-1024，也就是animate_0、animate_1一直到animate_1024</div></pre></td></tr></table></figure>
<p>8、加载gif图片</p>
<p>推荐使用这个框架 FLAnimatedImage</p>
<p>9、防止离屏渲染为image添加圆角</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">// image分类</div><div class="line">- (UIImage *)circleImage</div><div class="line">&#123;</div><div class="line">// NO代表透明</div><div class="line">UIGraphicsBeginImageContextWithOptions(self.size, NO, 1);</div><div class="line">// 获得上下文</div><div class="line">CGContextRef ctx = UIGraphicsGetCurrentContext();</div><div class="line">// 添加一个圆</div><div class="line">CGRect rect = CGRectMake(0, 0, self.size.width, self.size.height);</div><div class="line">// 方形变圆形</div><div class="line">CGContextAddEllipseInRect(ctx, rect);</div><div class="line">// 裁剪</div><div class="line">CGContextClip(ctx);</div><div class="line">// 将图片画上去</div><div class="line">[self drawInRect:rect];</div><div class="line">UIImage *image = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">UIGraphicsEndImageContext();</div><div class="line">return image;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>10、查看系统所有字体</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// 打印字体</div><div class="line">for (id familyName in [UIFont familyNames]) &#123;</div><div class="line">NSLog(@&quot;%@&quot;, familyName);</div><div class="line">for (id fontName in [UIFont fontNamesForFamilyName:familyName]) NSLog(@&quot;  %@&quot;, fontName);</div><div class="line">&#125;</div><div class="line">// 也可以进入这个网址查看 http://iosfonts.com/</div></pre></td></tr></table></figure>
<p>11、获取随机数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSInteger i = arc4random();</div></pre></td></tr></table></figure>
<p>12、获取随机数小数(0-1之间)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#define ARC4RANDOM_MAX      0x100000000</div><div class="line">double val = ((double)arc4random() / ARC4RANDOM_MAX);</div></pre></td></tr></table></figure>
<p>13、AVPlayer视频播放完成的通知监听</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[[NSNotificationCenter defaultCenter]</div><div class="line">addObserver:self</div><div class="line">selector:@selector(videoPlayEnd)</div><div class="line">name:AVPlayerItemDidPlayToEndTimeNotification</div><div class="line">object:nil];</div></pre></td></tr></table></figure>
<p>14、判断两个rect是否有交叉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">if (CGRectIntersectsRect(rect1, rect2)) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>15、判断一个字符串是否为数字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">NSCharacterSet *notDigits = [[NSCharacterSet decimalDigitCharacterSet] invertedSet];</div><div class="line">if ([str rangeOfCharacterFromSet:notDigits].location == NSNotFound)</div><div class="line">&#123;</div><div class="line">// 是数字</div><div class="line">&#125; else</div><div class="line">&#123;</div><div class="line">// 不是数字</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>16、将一个view保存为pdf格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (void)createPDFfromUIView:(UIView*)aView saveToDocumentsWithFileName:(NSString*)aFilename</div><div class="line">&#123;</div><div class="line">NSMutableData *pdfData = [NSMutableData data];</div><div class="line">UIGraphicsBeginPDFContextToData(pdfData, aView.bounds, nil);</div><div class="line">UIGraphicsBeginPDFPage();</div><div class="line">CGContextRef pdfContext = UIGraphicsGetCurrentContext();</div><div class="line">[aView.layer renderInContext:pdfContext];</div><div class="line">UIGraphicsEndPDFContext();</div><div class="line"></div><div class="line">NSArray* documentDirectories = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask,YES);</div><div class="line">NSString* documentDirectory = [documentDirectories objectAtIndex:0];</div><div class="line">NSString* documentDirectoryFilename = [documentDirectory stringByAppendingPathComponent:aFilename];</div><div class="line">[pdfData writeToFile:documentDirectoryFilename atomically:YES];</div><div class="line">NSLog(@&quot;documentDirectoryFileName: %@&quot;,documentDirectoryFilename);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>17、让一个view在父视图中心</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">child.center = [parent convertPoint:parent.center fromView:parent.superview];</div></pre></td></tr></table></figure>
<p>18、获取当前导航控制器下前一个控制器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (UIViewController *)backViewController</div><div class="line">&#123;</div><div class="line">NSInteger myIndex = [self.navigationController.viewControllers indexOfObject:self];</div><div class="line"></div><div class="line">if ( myIndex != 0 &amp;&amp; myIndex != NSNotFound ) &#123;</div><div class="line">return [self.navigationController.viewControllers objectAtIndex:myIndex-1];</div><div class="line">&#125; else &#123;</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>19、保存UIImage到本地</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);</div><div class="line">NSString *filePath = [[paths objectAtIndex:0] stringByAppendingPathComponent:@&quot;Image.png&quot;];</div><div class="line"></div><div class="line">[UIImagePNGRepresentation(image) writeToFile:filePath atomically:YES];</div></pre></td></tr></table></figure>
<p>20、键盘上方增加工具栏</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">UIToolbar *keyboardDoneButtonView = [[UIToolbar alloc] init];</div><div class="line">[keyboardDoneButtonView sizeToFit];</div><div class="line">UIBarButtonItem *doneButton = [[UIBarButtonItem alloc] initWithTitle:@&quot;Done&quot;</div><div class="line">style:UIBarButtonItemStyleBordered target:self</div><div class="line">action:@selector(doneClicked:)];</div><div class="line">[keyboardDoneButtonView setItems:[NSArray arrayWithObjects:doneButton, nil]];</div><div class="line">txtField.inputAccessoryView = keyboardDoneButtonView;</div></pre></td></tr></table></figure>
<p>21、copy一个view</p>
<p>因为UIView没有实现copy协议，因此找不到copyWithZone方法，使用copy的时候导致崩溃<br>但是我们可以通过归档再解档实现copy，这相当于对视图进行了一次深拷贝，代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">id copyOfView =</div><div class="line">[NSKeyedUnarchiver unarchiveObjectWithData:[NSKeyedArchiver archivedDataWithRootObject:originalView]];</div></pre></td></tr></table></figure>
<p>22、在image上绘制文字并生成新的image</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">UIFont *font = [UIFont boldSystemFontOfSize:12];</div><div class="line">UIGraphicsBeginImageContext(image.size);</div><div class="line">[image drawInRect:CGRectMake(0,0,image.size.width,image.size.height)];</div><div class="line">CGRect rect = CGRectMake(point.x, point.y, image.size.width, image.size.height);</div><div class="line">[[UIColor whiteColor] set];</div><div class="line">[text drawInRect:CGRectIntegral(rect) withFont:font];</div><div class="line">UIImage *newImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">UIGraphicsEndImageContext();</div></pre></td></tr></table></figure>
<p>23、判断一个view是否为另一个view的子视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 如果myView是self.view本身，也会返回yes</div><div class="line">BOOL isSubView = [myView isDescendantOfView:self.view];</div></pre></td></tr></table></figure>
<p>24、判断一个字符串是否包含另一个字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// 方法一、这种方法只适用于iOS8之后，如果是配iOS8之前用方法二</div><div class="line">if ([str containsString:otherStr]) NSLog(@&quot;包含&quot;);</div><div class="line"></div><div class="line">// 方法二</div><div class="line">NSRange range = [str rangeOfString:otherStr];</div><div class="line">if (range.location != NSNotFound) NSLog(@&quot;包含&quot;);</div></pre></td></tr></table></figure>
<p>25、UICollectionView自动滚动到某行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 重写viewDidLayoutSubviews方法</div><div class="line">-(void)viewDidLayoutSubviews &#123;</div><div class="line">[super viewDidLayoutSubviews];</div><div class="line">[self.collectionView scrollToItemAtIndexPath:indexPath atScrollPosition:UICollectionViewScrollPositionCenteredVertically animated:NO];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>26、修改系统UIAlertController</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// 但是据说这种方法会被App Store拒绝(慎用！)</div><div class="line">UIAlertController *alertVC = [UIAlertController alertControllerWithTitle:@&quot;&quot; message:@&quot;&quot; preferredStyle:UIAlertControllerStyleActionSheet];</div><div class="line">NSMutableAttributedString *hogan = [[NSMutableAttributedString alloc] initWithString:@&quot;我是一个大文本&quot;];</div><div class="line">[hogan addAttribute:NSFontAttributeName</div><div class="line">value:[UIFont systemFontOfSize:30]</div><div class="line">range:NSMakeRange(4, 1)];</div><div class="line">[hogan addAttribute:NSForegroundColorAttributeName</div><div class="line">value:[UIColor redColor]</div><div class="line">range:NSMakeRange(4, 1)];</div><div class="line">[alertVC setValue:hogan forKey:@&quot;attributedTitle&quot;];</div><div class="line"></div><div class="line">UIAlertAction *button = [UIAlertAction actionWithTitle:@&quot;Label text&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction *action)&#123; &#125;];</div><div class="line">UIImage *accessoryImage = [UIImage imageNamed:@&quot;1&quot;];</div><div class="line">[button setValue:accessoryImage forKey:@&quot;image&quot;];</div><div class="line">[alertVC addAction:button];</div><div class="line">[self presentViewController:alertVC animated:YES completion:nil];</div></pre></td></tr></table></figure>
<p>27、判断某一行的cell是否已经显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CGRect cellRect = [tableView rectForRowAtIndexPath:indexPath];</div><div class="line">BOOL completelyVisible = CGRectContainsRect(tableView.bounds, cellRect);</div></pre></td></tr></table></figure>
<p>28、让导航控制器pop回指定的控制器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">NSMutableArray *allViewControllers = [NSMutableArray arrayWithArray:[self.navigationController viewControllers]];</div><div class="line">for (UIViewController *aViewController in allViewControllers) &#123;</div><div class="line">if ([aViewController isKindOfClass:[RequiredViewController class]]) &#123;</div><div class="line">[self.navigationController popToViewController:aViewController animated:NO];</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>29、动画修改label上的文字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// 方法一</div><div class="line">CATransition *animation = [CATransition animation];</div><div class="line">animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];</div><div class="line">animation.type = kCATransitionFade;</div><div class="line">animation.duration = 0.75;</div><div class="line">[self.label.layer addAnimation:animation forKey:@&quot;kCATransitionFade&quot;];</div><div class="line">self.label.text = @&quot;New&quot;;</div><div class="line"></div><div class="line">// 方法二</div><div class="line">[UIView transitionWithView:self.label</div><div class="line">duration:0.25f</div><div class="line">options:UIViewAnimationOptionTransitionCrossDissolve</div><div class="line">animations:^&#123;</div><div class="line">self.label.text = @&quot;Well done!&quot;;</div><div class="line">&#125; completion:nil];</div><div class="line"></div><div class="line">// 方法三</div><div class="line">[UIView animateWithDuration:1.0</div><div class="line">animations:^&#123;</div><div class="line">self.label.alpha = 0.0f;</div><div class="line">self.label.text = @&quot;newText&quot;;</div><div class="line">self.label.alpha = 1.0f;</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<p>30、判断字典中是否包含某个key值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">if ([dic objectForKey:@&quot;yourKey&quot;]) &#123;</div><div class="line">NSLog(@&quot;有这个值&quot;);</div><div class="line">&#125; else &#123;</div><div class="line">NSLog(@&quot;没有这个值&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>31、获取屏幕方向</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">UIInterfaceOrientation orientation = [UIApplication sharedApplication].statusBarOrientation;</div><div class="line"></div><div class="line">if(orientation == 0) //Default orientation</div><div class="line">//默认</div><div class="line">else if(orientation == UIInterfaceOrientationPortrait)</div><div class="line">//竖屏</div><div class="line">else if(orientation == UIInterfaceOrientationLandscapeLeft)</div><div class="line">// 左横屏</div><div class="line">else if(orientation == UIInterfaceOrientationLandscapeRight)</div><div class="line">//右横屏</div></pre></td></tr></table></figure>
<p>32、设置UIImage的透明度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">// 方法一、添加UIImage分类</div><div class="line">- (UIImage *)imageByApplyingAlpha:(CGFloat) alpha &#123;</div><div class="line">UIGraphicsBeginImageContextWithOptions(self.size, NO, 0.0f);</div><div class="line"></div><div class="line">CGContextRef ctx = UIGraphicsGetCurrentContext();</div><div class="line">CGRect area = CGRectMake(0, 0, self.size.width, self.size.height);</div><div class="line"></div><div class="line">CGContextScaleCTM(ctx, 1, -1);</div><div class="line">CGContextTranslateCTM(ctx, 0, -area.size.height);</div><div class="line"></div><div class="line">CGContextSetBlendMode(ctx, kCGBlendModeMultiply);</div><div class="line"></div><div class="line">CGContextSetAlpha(ctx, alpha);</div><div class="line"></div><div class="line">CGContextDrawImage(ctx, area, self.CGImage);</div><div class="line"></div><div class="line">UIImage *newImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line"></div><div class="line">UIGraphicsEndImageContext();</div><div class="line"></div><div class="line">return newImage;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 方法二、如果没有奇葩需求，干脆用UIImageView设置透明度</div><div class="line">UIImageView *imageView = [[UIImageView alloc] initWithImage:[UIImage imageWithName:@&quot;yourImage&quot;]];</div><div class="line">imageView.alpha = 0.5;</div></pre></td></tr></table></figure>
<p>33、Attempt to mutate immutable object with insertString:atIndex:</p>
<p>这个错是因为你拿字符串调用insertString:atIndex:方法的时候，调用对象不是NSMutableString，应该先转成这个类型再调用</p>
<p>34、UIWebView添加单击手势不响应</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(webViewClick)];</div><div class="line">tap.delegate = self;</div><div class="line">[_webView addGestureRecognizer:tap];</div><div class="line"></div><div class="line">// 因为webView本身有一个单击手势，所以再添加会造成手势冲突，从而不响应。需要绑定手势代理，并实现下边的代理方法</div><div class="line">- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer:(UIGestureRecognizer *)otherGestureRecognizer&#123;</div><div class="line">return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>35、获取手机RAM容量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// 需要导入#import</div><div class="line">mach_port_t host_port;</div><div class="line">mach_msg_type_number_t host_size;</div><div class="line">vm_size_t pagesize;</div><div class="line"></div><div class="line">host_port = mach_host_self();</div><div class="line">host_size = sizeof(vm_statistics_data_t) / sizeof(integer_t);</div><div class="line">host_page_size(host_port, &amp;pagesize);</div><div class="line"></div><div class="line">vm_statistics_data_t vm_stat;</div><div class="line"></div><div class="line">if (host_statistics(host_port, HOST_VM_INFO, (host_info_t)&amp;vm_stat, &amp;host_size) != KERN_SUCCESS) &#123;</div><div class="line">NSLog(@&quot;Failed to fetch vm statistics&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/* Stats in bytes */</div><div class="line">natural_t mem_used = (vm_stat.active_count +</div><div class="line">vm_stat.inactive_count +</div><div class="line">vm_stat.wire_count) * pagesize;</div><div class="line">natural_t mem_free = vm_stat.free_count * pagesize;</div><div class="line">natural_t mem_total = mem_used + mem_free;</div><div class="line">NSLog(@&quot;已用: %u 可用: %u 总共: %u&quot;, mem_used, mem_free, mem_total);</div></pre></td></tr></table></figure>
<p>36、地图上两个点之间的实际距离</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 需要导入#import</div><div class="line">CLLocation *locA = [[CLLocation alloc] initWithLatitude:34 longitude:113];</div><div class="line">CLLocation *locB = [[CLLocation alloc] initWithLatitude:31.05 longitude:121.76];</div><div class="line">// CLLocationDistance求出的单位为米</div><div class="line">CLLocationDistance distance = [locA distanceFromLocation:locB];</div></pre></td></tr></table></figure>
<p>37、在应用中打开设置的某个界面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">// 打开设置-&gt;通用</div><div class="line">[[UIApplication sharedApplication] openURL:[NSURL URLWithString:@&quot;prefs:root=General&quot;]];</div><div class="line"></div><div class="line">// 以下是设置其他界面</div><div class="line">prefs:root=General&amp;path=About</div><div class="line">prefs:root=General&amp;path=ACCESSIBILITY</div><div class="line">prefs:root=AIRPLANE_MODE</div><div class="line">prefs:root=General&amp;path=AUTOLOCK</div><div class="line">prefs:root=General&amp;path=USAGE/CELLULAR_USAGE</div><div class="line">prefs:root=Brightness</div><div class="line">prefs:root=Bluetooth</div><div class="line">prefs:root=General&amp;path=DATE_AND_TIME</div><div class="line">prefs:root=FACETIME</div><div class="line">prefs:root=General</div><div class="line">prefs:root=General&amp;path=Keyboard</div><div class="line">prefs:root=CASTLE</div><div class="line">prefs:root=CASTLE&amp;path=STORAGE_AND_BACKUP</div><div class="line">prefs:root=General&amp;path=INTERNATIONAL</div><div class="line">prefs:root=LOCATION_SERVICES</div><div class="line">prefs:root=ACCOUNT_SETTINGS</div><div class="line">prefs:root=MUSIC</div><div class="line">prefs:root=MUSIC&amp;path=EQ</div><div class="line">prefs:root=MUSIC&amp;path=VolumeLimit</div><div class="line">prefs:root=General&amp;path=Network</div><div class="line">prefs:root=NIKE_PLUS_IPOD</div><div class="line">prefs:root=NOTES</div><div class="line">prefs:root=NOTIFICATIONS_ID</div><div class="line">prefs:root=Phone</div><div class="line">prefs:root=Photos</div><div class="line">prefs:root=General&amp;path=ManagedConfigurationList</div><div class="line">prefs:root=General&amp;path=Reset</div><div class="line">prefs:root=Sounds&amp;path=Ringtone</div><div class="line">prefs:root=Safari</div><div class="line">prefs:root=General&amp;path=Assistant</div><div class="line">prefs:root=Sounds</div><div class="line">prefs:root=General&amp;path=SOFTWARE_UPDATE_LINK</div><div class="line">prefs:root=STORE</div><div class="line">prefs:root=TWITTER</div><div class="line">prefs:root=FACEBOOK</div><div class="line">prefs:root=General&amp;path=USAGE prefs:root=VIDEO</div><div class="line">prefs:root=General&amp;path=Network/VPN</div><div class="line">prefs:root=Wallpaper</div><div class="line">prefs:root=WIFI</div><div class="line">prefs:root=INTERNET_TETHERING</div><div class="line">prefs:root=Phone&amp;path=Blocked</div><div class="line">prefs:root=DO_NOT_DISTURB</div></pre></td></tr></table></figure>
<p>38、在UITextView中显示html文本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">UITextView *textView = [[UITextView alloc] initWithFrame:CGRectMake(20, 30, 100, 199)];</div><div class="line">textView.backgroundColor = [UIColor redColor];</div><div class="line">[self.view addSubview:textView];</div><div class="line">NSString *htmlString = @&quot;</div><div class="line">![](http://blogs.babble.com/famecrawler/files/2010/11/mickey_mouse-1097.jpg)&quot;;</div><div class="line">NSAttributedString *attributedString = [[NSAttributedString alloc] initWithData: [htmlString dataUsingEncoding:NSUnicodeStringEncoding] options: @&#123; NSDocumentTypeDocumentAttribute: NSHTMLTextDocumentType &#125; documentAttributes: nil error: nil];</div><div class="line">textView.attributedText = attributedString;</div></pre></td></tr></table></figure>
<p>39、监听scrollView是否滚动到了顶部／底部</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">-(void)scrollViewDidScroll: (UIScrollView*)scrollView</div><div class="line">&#123;</div><div class="line">float scrollViewHeight = scrollView.frame.size.height;</div><div class="line">float scrollContentSizeHeight = scrollView.contentSize.height;</div><div class="line">float scrollOffset = scrollView.contentOffset.y;</div><div class="line"></div><div class="line">if (scrollOffset == 0)</div><div class="line">&#123;</div><div class="line">// 滚动到了顶部</div><div class="line">&#125;</div><div class="line">else if (scrollOffset + scrollViewHeight == scrollContentSizeHeight)</div><div class="line">&#123;</div><div class="line">// 滚动到了底部</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>40、UISlider增量／减量为固定值(假如为5)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (void)setupSlider</div><div class="line">&#123;</div><div class="line">UISlider *slider = [[UISlider alloc] init];</div><div class="line">[self.view addSubview:slider];</div><div class="line">[slider addTarget:self action:@selector(sliderAction:) forControlEvents:UIControlEventValueChanged];</div><div class="line">slider.maximumValue = 100;</div><div class="line">slider.minimumValue = 0;</div><div class="line">slider.frame = CGRectMake(200, 20, 100, 30);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)sliderAction:(UISlider *)slider</div><div class="line">&#123;</div><div class="line">[slider setValue:((int)((slider.value + 2.5) / 5) * 5) animated:NO];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>41、选中textField或者textView所有文本(我这里以textView为例)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[self.textView setSelectedTextRange:[self.textView textRangeFromPosition:self.textView.beginningOfDocument toPosition:self.textView.endOfDocument]]</div></pre></td></tr></table></figure>
<p>42、从导航控制器中删除某个控制器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// 方法一、知道这个控制器所处的导航控制器下标</div><div class="line">NSMutableArray *navigationArray = [[NSMutableArray alloc] initWithArray: self.navigationController.viewControllers];</div><div class="line">[navigationArray removeObjectAtIndex: 2];</div><div class="line">self.navigationController.viewControllers = navigationArray;</div><div class="line"></div><div class="line">// 方法二、知道具体是哪个控制器</div><div class="line">NSArray* tempVCA = [self.navigationController viewControllers];</div><div class="line"></div><div class="line">for(UIViewController *tempVC in tempVCA)</div><div class="line">&#123;</div><div class="line">if([tempVC isKindOfClass:[urViewControllerClass class]])</div><div class="line">&#123;</div><div class="line">[tempVC removeFromParentViewController];</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>43、隐藏UITextView/UITextField光标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">textField.tintColor = [UIColor clearColor];</div><div class="line">44、当UITextView/UITextField中没有文字时，禁用回车键</div><div class="line">textField.enablesReturnKeyAutomatically = YES;</div></pre></td></tr></table></figure>
<p>45、字符串encode编码(编码url字符串不成功的问题)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">// 我们一般用这个方法处理stringByAddingPercentEscapesUsingEncoding但是这个方法好想不会处理／和&amp;这种特殊符号，这种情况就需要用下边这个方法处理</div><div class="line">@implementation NSString (NSString_Extended)</div><div class="line">- (NSString *)urlencode &#123;</div><div class="line">NSMutableString *output = [NSMutableString string];</div><div class="line">const unsigned char *source = (const unsigned char *)[self UTF8String];</div><div class="line">int sourceLen = strlen((const char *)source);</div><div class="line">for (int i = 0; i &lt; sourceLen; ++i) &#123;</div><div class="line">const unsigned char thisChar = source[i];</div><div class="line">if (thisChar == &apos; &apos;)&#123;</div><div class="line">[output appendString:@&quot;+&quot;];</div><div class="line">&#125; else if (thisChar == &apos;.&apos; || thisChar == &apos;-&apos; || thisChar == &apos;_&apos; || thisChar == &apos;~&apos; ||</div><div class="line">(thisChar &gt;= &apos;a&apos; &amp;&amp; thisChar = &apos;A&apos; &amp;&amp; thisChar = &apos;0&apos; &amp;&amp; thisChar &lt;= &apos;9&apos;)) &#123;</div><div class="line">[output appendFormat:@&quot;%c&quot;, thisChar];</div><div class="line">&#125; else &#123;</div><div class="line">[output appendFormat:@&quot;%%X&quot;, thisChar];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">return output;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>46、计算UILabel上某段文字的frame</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@implementation UILabel (TextRect)</div><div class="line"></div><div class="line">- (CGRect)boundingRectForCharacterRange:(NSRange)range</div><div class="line">&#123;</div><div class="line">NSTextStorage *textStorage = [[NSTextStorage alloc] initWithAttributedString:[self attributedText]];</div><div class="line">NSLayoutManager *layoutManager = [[NSLayoutManager alloc] init];</div><div class="line">[textStorage addLayoutManager:layoutManager];</div><div class="line">NSTextContainer *textContainer = [[NSTextContainer alloc] initWithSize:[self bounds].size];</div><div class="line">textContainer.lineFragmentPadding = 0;</div><div class="line">[layoutManager addTextContainer:textContainer];</div><div class="line">NSRange glyphRange;</div><div class="line">[layoutManager characterRangeForGlyphRange:range actualGlyphRange:&amp;glyphRange];</div><div class="line">return [layoutManager boundingRectForGlyphRange:glyphRange inTextContainer:textContainer];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>47、获取随机UUID</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">NSString *result;</div><div class="line">if([[[UIDevice currentDevice] systemVersion] floatValue] &gt; 6.0)</div><div class="line">&#123;</div><div class="line">result = [[NSUUID UUID] UUIDString];</div><div class="line">&#125;</div><div class="line">else</div><div class="line">&#123;</div><div class="line">CFUUIDRef uuidRef = CFUUIDCreate(NULL);</div><div class="line">CFStringRef uuid = CFUUIDCreateString(NULL, uuidRef);</div><div class="line">CFRelease(uuidRef);</div><div class="line">result = (__bridge_transfer NSString *)uuid;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>48、仿苹果抖动动画</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#define RADIANS(degrees) (((degrees) * M_PI) / 180.0)</div><div class="line"></div><div class="line">- (void)startAnimate &#123;</div><div class="line">view.transform = CGAffineTransformRotate(CGAffineTransformIdentity, RADIANS(-5));</div><div class="line">[UIView animateWithDuration:0.25 delay:0.0 options:(UIViewAnimationOptionAllowUserInteraction | UIViewAnimationOptionRepeat | UIViewAnimationOptionAutoreverse) animations:^ &#123;</div><div class="line">view.transform = CGAffineTransformRotate(CGAffineTransformIdentity, RADIANS(5));</div><div class="line">&#125; completion:nil];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)stopAnimate &#123;</div><div class="line">[UIView animateWithDuration:0.25 delay:0.0 options:(UIViewAnimationOptionAllowUserInteraction | UIViewAnimationOptionBeginFromCurrentState | UIViewAnimationOptionCurveLinear) animations:^ &#123;</div><div class="line">view.transform = CGAffineTransformIdentity;</div><div class="line">&#125; completion:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>49、修改UISearBar内部背景颜色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">UITextField *textField = [_searchBar valueForKey:@&quot;_searchField&quot;];</div><div class="line">textField.backgroundColor = [UIColor redColor];</div></pre></td></tr></table></figure>
<p>50、UITextView滚动到顶部</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// 方法一</div><div class="line">[self.textView scrollRangeToVisible:NSMakeRange(0, 0)];</div><div class="line">// 方法二</div><div class="line">[self.textView setContentOffset:CGPointZero animated:YES];</div></pre></td></tr></table></figure>
<p>51、通知监听APP生命周期</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">UIApplicationDidEnterBackgroundNotification 应用程序进入后台</div><div class="line">UIApplicationWillEnterForegroundNotification 应用程序将要进入前台</div><div class="line">UIApplicationDidFinishLaunchingNotification 应用程序完成启动</div><div class="line">UIApplicationDidFinishLaunchingNotification 应用程序由挂起变的活跃</div><div class="line">UIApplicationWillResignActiveNotification 应用程序挂起(有电话进来或者锁屏)</div><div class="line">UIApplicationDidReceiveMemoryWarningNotification 应用程序收到内存警告</div><div class="line">UIApplicationDidReceiveMemoryWarningNotification 应用程序终止(后台杀死、手机关机等)</div><div class="line">UIApplicationSignificantTimeChangeNotification 当有重大时间改变(凌晨0点，设备时间被修改，时区改变等)</div><div class="line">UIApplicationWillChangeStatusBarOrientationNotification 设备方向将要改变</div><div class="line">UIApplicationDidChangeStatusBarOrientationNotification 设备方向改变</div><div class="line">UIApplicationWillChangeStatusBarFrameNotification 设备状态栏frame将要改变</div><div class="line">UIApplicationDidChangeStatusBarFrameNotification 设备状态栏frame改变</div><div class="line">UIApplicationBackgroundRefreshStatusDidChangeNotification 应用程序在后台下载内容的状态发生变化</div><div class="line">UIApplicationProtectedDataWillBecomeUnavailable 本地受保护的文件被锁定,无法访问</div><div class="line">UIApplicationProtectedDataWillBecomeUnavailable 本地受保护的文件可用了</div></pre></td></tr></table></figure>
<p>52、触摸事件类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">UIControlEventTouchCancel 取消控件当前触发的事件</div><div class="line">UIControlEventTouchDown 点按下去的事件</div><div class="line">UIControlEventTouchDownRepeat 重复的触动事件</div><div class="line">UIControlEventTouchDragEnter 手指被拖动到控件的边界的事件</div><div class="line">UIControlEventTouchDragExit 一个手指从控件内拖到外界的事件</div><div class="line">UIControlEventTouchDragInside 手指在控件的边界内拖动的事件</div><div class="line">UIControlEventTouchDragOutside 手指在控件边界之外被拖动的事件</div><div class="line">UIControlEventTouchUpInside 手指处于控制范围内的触摸事件</div><div class="line">UIControlEventTouchUpOutside 手指超出控制范围的控制中的触摸事件</div></pre></td></tr></table></figure>
<p>53、UITextField文字周围增加边距</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">// 子类化UITextField，增加insert属性</div><div class="line">@interface WZBTextField : UITextField</div><div class="line">@property (nonatomic, assign) UIEdgeInsets insets;</div><div class="line">@end</div><div class="line"></div><div class="line">// 在.m文件重写下列方法</div><div class="line">- (CGRect)textRectForBounds:(CGRect)bounds &#123;</div><div class="line">CGRect paddedRect = UIEdgeInsetsInsetRect(bounds, self.insets);</div><div class="line">if (self.rightViewMode == UITextFieldViewModeAlways || self.rightViewMode == UITextFieldViewModeUnlessEditing) &#123;</div><div class="line">return [self adjustRectWithWidthRightView:paddedRect];</div><div class="line">&#125;</div><div class="line">return paddedRect;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGRect)placeholderRectForBounds:(CGRect)bounds &#123;</div><div class="line">CGRect paddedRect = UIEdgeInsetsInsetRect(bounds, self.insets);</div><div class="line"></div><div class="line">if (self.rightViewMode == UITextFieldViewModeAlways || self.rightViewMode == UITextFieldViewModeUnlessEditing) &#123;</div><div class="line">return [self adjustRectWithWidthRightView:paddedRect];</div><div class="line">&#125;</div><div class="line">return paddedRect;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGRect)editingRectForBounds:(CGRect)bounds &#123;</div><div class="line">CGRect paddedRect = UIEdgeInsetsInsetRect(bounds, self.insets);</div><div class="line">if (self.rightViewMode == UITextFieldViewModeAlways || self.rightViewMode == UITextFieldViewModeWhileEditing) &#123;</div><div class="line">return [self adjustRectWithWidthRightView:paddedRect];</div><div class="line">&#125;</div><div class="line">return paddedRect;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (CGRect)adjustRectWithWidthRightView:(CGRect)bounds &#123;</div><div class="line">CGRect paddedRect = bounds;</div><div class="line">paddedRect.size.width -= CGRectGetWidth(self.rightView.frame);</div><div class="line"></div><div class="line">return paddedRect;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>54、监听UISlider拖动状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">// 添加事件</div><div class="line">[slider addTarget:self action:@selector(sliderValurChanged:forEvent:) forControlEvents:UIControlEventValueChanged];</div><div class="line"></div><div class="line">// 实现方法</div><div class="line">- (void)sliderValurChanged:(UISlider*)slider forEvent:(UIEvent*)event &#123;</div><div class="line">UITouch *touchEvent = [[event allTouches] anyObject];</div><div class="line">switch (touchEvent.phase) &#123;</div><div class="line">case UITouchPhaseBegan:</div><div class="line">NSLog(@&quot;开始拖动&quot;);</div><div class="line">break;</div><div class="line">case UITouchPhaseMoved:</div><div class="line">NSLog(@&quot;正在拖动&quot;);</div><div class="line">break;</div><div class="line">case UITouchPhaseEnded:</div><div class="line">NSLog(@&quot;结束拖动&quot;);</div><div class="line">break;</div><div class="line">default:</div><div class="line">break;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>55、设置UITextField光标位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// textField需要设置的textField，index要设置的光标位置</div><div class="line">- (void)cursorLocation:(UITextField *)textField index:(NSInteger)index</div><div class="line">&#123;</div><div class="line">NSRange range = NSMakeRange(index, 0);</div><div class="line">UITextPosition *start = [textField positionFromPosition:[textField beginningOfDocument] offset:range.location];</div><div class="line">UITextPosition *end = [textField positionFromPosition:start offset:range.length];</div><div class="line">[textField setSelectedTextRange:[textField textRangeFromPosition:start toPosition:end]];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>56、去除webView底部黑色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[webView setBackgroundColor:[UIColor clearColor]];</div><div class="line">[webView setOpaque:NO];</div><div class="line"></div><div class="line">for (UIView *v1 in [webView subviews])</div><div class="line">&#123;</div><div class="line">if ([v1 isKindOfClass:[UIScrollView class]])</div><div class="line">&#123;</div><div class="line">for (UIView *v2 in v1.subviews)</div><div class="line">&#123;</div><div class="line">if ([v2 isKindOfClass:[UIImageView class]])</div><div class="line">&#123;</div><div class="line">v2.hidden = YES;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>57、获取collectionViewCell在屏幕中的frame</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">UICollectionViewLayoutAttributes *attributes = [collectionView layoutAttributesForItemAtIndexPath:indexPath];</div><div class="line">CGRect cellRect = attributes.frame;</div><div class="line">CGRect cellFrameInSuperview = [collectionView convertRect:cellRect toView:[cv superview]];</div></pre></td></tr></table></figure>
<p>58、比较两个UIImage是否相等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (BOOL)image:(UIImage *)image1 isEqualTo:(UIImage *)image2</div><div class="line">&#123;</div><div class="line">NSData *data1 = UIImagePNGRepresentation(image1);</div><div class="line">NSData *data2 = UIImagePNGRepresentation(image2);</div><div class="line"></div><div class="line">return [data1 isEqual:data2];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>59、解决当UIScrollView上有UIButton的时候，触摸到button滑动不了的问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// 子类化UIScrollView，并重写以下方法</div><div class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</div><div class="line">if (self = [super initWithFrame:frame]) &#123;</div><div class="line">self.delaysContentTouches = NO;</div><div class="line">&#125;</div><div class="line"></div><div class="line">return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)touchesShouldCancelInContentView:(UIView *)view &#123;</div><div class="line">if ([view isKindOfClass:UIButton.class]) &#123;</div><div class="line">return YES;</div><div class="line">&#125;</div><div class="line"></div><div class="line">return [super touchesShouldCancelInContentView:view];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>60、UITextView中的文字添加阴影效果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (void)setTextLayer:(UITextView *)textView color:(UIColor *)color</div><div class="line">&#123;</div><div class="line">CALayer *textLayer = ((CALayer *)[textView.layer.sublayers objectAtIndex:0]);</div><div class="line">textLayer.shadowColor = color.CGColor;</div><div class="line">textLayer.shadowOffset = CGSizeMake(0.0f, 1.0f);</div><div class="line">textLayer.shadowOpacity = 1.0f;</div><div class="line">textLayer.shadowRadius = 1.0f;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>61、MD5加密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">+ (NSString *)md5:(NSString *)str</div><div class="line">&#123;</div><div class="line">const char *concat_str = [str UTF8String];</div><div class="line">unsigned char result[CC_MD5_DIGEST_LENGTH];</div><div class="line">CC_MD5(concat_str, (unsigned int)strlen(concat_str), result);</div><div class="line">NSMutableString *hash = [NSMutableString string];</div><div class="line">for (int i =0; i&lt;16; i++)&#123;</div><div class="line">[hash appendFormat:@&quot;X&quot;, result[i]];</div><div class="line">&#125;</div><div class="line">return [hash uppercaseString];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>62、base64加密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line">@interface NSData (Base64)</div><div class="line">/**</div><div class="line">*  @brief  字符串base64后转data</div><div class="line">*/</div><div class="line">+ (NSData *)dataWithBase64EncodedString:(NSString *)string</div><div class="line">&#123;</div><div class="line">if (![string length]) return nil;</div><div class="line">NSData *decoded = nil;</div><div class="line">#if __MAC_OS_X_VERSION_MIN_REQUIRED &lt; __MAC_10_9 || __IPHONE_OS_VERSION_MIN_REQUIRED &lt; __IPHONE_7_0</div><div class="line">if (![NSData instancesRespondToSelector:@selector(initWithBase64EncodedString:options:)])</div><div class="line">&#123;</div><div class="line">#pragma clang diagnostic push</div><div class="line">#pragma clang diagnostic ignored &quot;-Wdeprecated-declarations&quot;</div><div class="line">decoded = [[self alloc] initWithBase64Encoding:[string stringByReplacingOccurrencesOfString:@&quot;[^A-Za-z0-9+/=]&quot; withString:@&quot;&quot; options:NSRegularExpressionSearch range:NSMakeRange(0, [string length])]];</div><div class="line">#pragma clang diagnostic pop</div><div class="line">&#125;</div><div class="line">else</div><div class="line">#endif</div><div class="line">&#123;</div><div class="line">decoded = [[self alloc] initWithBase64EncodedString:string options:NSDataBase64DecodingIgnoreUnknownCharacters];</div><div class="line">&#125;</div><div class="line">return [decoded length]? decoded: nil;</div><div class="line">&#125;</div><div class="line">/**</div><div class="line">*  @brief  NSData转string</div><div class="line">*  @param wrapWidth 换行长度  76  64</div><div class="line">*/</div><div class="line">- (NSString *)base64EncodedStringWithWrapWidth:(NSUInteger)wrapWidth</div><div class="line">&#123;</div><div class="line">if (![self length]) return nil;</div><div class="line">NSString *encoded = nil;</div><div class="line">#if __MAC_OS_X_VERSION_MIN_REQUIRED &lt; __MAC_10_9 || __IPHONE_OS_VERSION_MIN_REQUIRED &lt; __IPHONE_7_0</div><div class="line">if (![NSData instancesRespondToSelector:@selector(base64EncodedStringWithOptions:)])</div><div class="line">&#123;</div><div class="line">#pragma clang diagnostic push</div><div class="line">#pragma clang diagnostic ignored &quot;-Wdeprecated-declarations&quot;</div><div class="line">encoded = [self base64Encoding];</div><div class="line">#pragma clang diagnostic pop</div><div class="line"></div><div class="line">&#125;</div><div class="line">else</div><div class="line">#endif</div><div class="line">&#123;</div><div class="line">switch (wrapWidth)</div><div class="line">&#123;</div><div class="line">case 64:</div><div class="line">&#123;</div><div class="line">return [self base64EncodedStringWithOptions:NSDataBase64Encoding64CharacterLineLength];</div><div class="line">&#125;</div><div class="line">case 76:</div><div class="line">&#123;</div><div class="line">return [self base64EncodedStringWithOptions:NSDataBase64Encoding76CharacterLineLength];</div><div class="line">&#125;</div><div class="line">default:</div><div class="line">&#123;</div><div class="line">encoded = [self base64EncodedStringWithOptions:(NSDataBase64EncodingOptions)0];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">if (!wrapWidth || wrapWidth &gt;= [encoded length])</div><div class="line">&#123;</div><div class="line">return encoded;</div><div class="line">&#125;</div><div class="line">wrapWidth = (wrapWidth / 4) * 4;</div><div class="line">NSMutableString *result = [NSMutableString string];</div><div class="line">for (NSUInteger i = 0; i &lt; [encoded length]; i+= wrapWidth)</div><div class="line">&#123;</div><div class="line">if (i + wrapWidth &gt;= [encoded length])</div><div class="line">&#123;</div><div class="line">[result appendString:[encoded substringFromIndex:i]];</div><div class="line">break;</div><div class="line">&#125;</div><div class="line">[result appendString:[encoded substringWithRange:NSMakeRange(i, wrapWidth)]];</div><div class="line">[result appendString:@&quot;\r\n&quot;];</div><div class="line">&#125;</div><div class="line">return result;</div><div class="line">&#125;</div><div class="line">/**</div><div class="line">*  @brief  NSData转string 换行长度默认64</div><div class="line">*/</div><div class="line">- (NSString *)base64EncodedString</div><div class="line">&#123;</div><div class="line">return [self base64EncodedStringWithWrapWidth:0];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>63、AES加密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">#import</div><div class="line">@interface NSData (AES)</div><div class="line">/**</div><div class="line">*  利用AES加密数据</div><div class="line">*/</div><div class="line">- (NSData*)encryptedWithAESUsingKey:(NSString*)key andIV:(NSData*)iv &#123;</div><div class="line"></div><div class="line">NSData *keyData = [key dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line"></div><div class="line">size_t dataMoved;</div><div class="line">NSMutableData *encryptedData = [NSMutableData dataWithLength:self.length + kCCBlockSizeAES128];</div><div class="line"></div><div class="line">CCCryptorStatus status = CCCrypt(kCCEncrypt,kCCAlgorithmAES128,kCCOptionPKCS7Padding,keyData.bytes,keyData.length,iv.bytes,self.bytes,self.length,encryptedData.mutableBytes, encryptedData.length,&amp;dataMoved);</div><div class="line"></div><div class="line">if (status == kCCSuccess) &#123;</div><div class="line">encryptedData.length = dataMoved;</div><div class="line">return encryptedData;</div><div class="line">&#125;</div><div class="line"></div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line">*  @brief  利用AES解密据</div><div class="line">*/</div><div class="line">- (NSData*)decryptedWithAESUsingKey:(NSString*)key andIV:(NSData*)iv &#123;</div><div class="line"></div><div class="line">NSData *keyData = [key dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line"></div><div class="line">size_t dataMoved;</div><div class="line">NSMutableData *decryptedData = [NSMutableData dataWithLength:self.length + kCCBlockSizeAES128];</div><div class="line"></div><div class="line">CCCryptorStatus result = CCCrypt(kCCDecrypt,kCCAlgorithmAES128,kCCOptionPKCS7Padding,keyData.bytes,keyData.length,iv.bytes,self.bytes,self.length,decryptedData.mutableBytes, decryptedData.length,&amp;dataMoved);</div><div class="line"></div><div class="line">if (result == kCCSuccess) &#123;</div><div class="line">decryptedData.length = dataMoved;</div><div class="line">return decryptedData;</div><div class="line">&#125;</div><div class="line"></div><div class="line">return nil;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>64、3DES加密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">#import</div><div class="line">@interface NSData (3DES)</div><div class="line">/**</div><div class="line">*  利用3DES加密数据</div><div class="line">*/</div><div class="line">- (NSData*)encryptedWith3DESUsingKey:(NSString*)key andIV:(NSData*)iv &#123;</div><div class="line"></div><div class="line">NSData *keyData = [key dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line"></div><div class="line">size_t dataMoved;</div><div class="line">NSMutableData *encryptedData = [NSMutableData dataWithLength:self.length + kCCBlockSize3DES];</div><div class="line"></div><div class="line">CCCryptorStatus result = CCCrypt(kCCEncrypt,kCCAlgorithm3DES,kCCOptionPKCS7Padding,keyData.bytes,keyData.length,iv.bytes,self.bytes,self.length,encryptedData.mutableBytes,encryptedData.length,&amp;dataMoved);</div><div class="line"></div><div class="line">if (result == kCCSuccess) &#123;</div><div class="line">encryptedData.length = dataMoved;</div><div class="line">return encryptedData;</div><div class="line">&#125;</div><div class="line"></div><div class="line">return nil;</div><div class="line"></div><div class="line">&#125;</div><div class="line">/**</div><div class="line">*  @brief   利用3DES解密数据</div><div class="line">*/</div><div class="line">- (NSData*)decryptedWith3DESUsingKey:(NSString*)key andIV:(NSData*)iv &#123;</div><div class="line"></div><div class="line">NSData *keyData = [key dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line"></div><div class="line">size_t dataMoved;</div><div class="line">NSMutableData *decryptedData = [NSMutableData dataWithLength:self.length + kCCBlockSize3DES];</div><div class="line"></div><div class="line">CCCryptorStatus result = CCCrypt(kCCDecrypt,kCCAlgorithm3DES,kCCOptionPKCS7Padding,keyData.bytes,keyData.length,iv.bytes,self.bytes,self.length,decryptedData.mutableBytes,decryptedData.length,&amp;dataMoved);</div><div class="line"></div><div class="line">if (result == kCCSuccess) &#123;</div><div class="line">decryptedData.length = dataMoved;</div><div class="line">return decryptedData;</div><div class="line">&#125;</div><div class="line"></div><div class="line">return nil;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>65、单个页面多个网络请求的情况，需要监听所有网络请求结束后刷新UI</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">dispatch_group_t group = dispatch_group_create();</div><div class="line">dispatch_queue_t serialQueue = dispatch_queue_create(&quot;com.wzb.test.www&quot;, DISPATCH_QUEUE_SERIAL);</div><div class="line">dispatch_group_enter(group);</div><div class="line">dispatch_group_async(group, serialQueue, ^&#123;</div><div class="line">// 网络请求一</div><div class="line">[WebClick getDataSuccess:^(ResponseModel *model) &#123;</div><div class="line">dispatch_group_leave(group);</div><div class="line">&#125; failure:^(NSString *err) &#123;</div><div class="line">dispatch_group_leave(group);</div><div class="line">&#125;];</div><div class="line">&#125;);</div><div class="line">dispatch_group_enter(group);</div><div class="line">dispatch_group_async(group, serialQueue, ^&#123;</div><div class="line">// 网络请求二</div><div class="line">[WebClick getDataSuccess:getBigTypeRM onSuccess:^(ResponseModel *model) &#123;</div><div class="line">dispatch_group_leave(group);</div><div class="line">&#125;                                  failure:^(NSString *errorString) &#123;</div><div class="line">dispatch_group_leave(group);</div><div class="line">&#125;];</div><div class="line">&#125;);</div><div class="line">dispatch_group_enter(group);</div><div class="line">dispatch_group_async(group, serialQueue, ^&#123;</div><div class="line">// 网络请求三</div><div class="line">[WebClick getDataSuccess:^&#123;</div><div class="line">dispatch_group_leave(group);</div><div class="line">&#125; failure:^(NSString *errorString) &#123;</div><div class="line">dispatch_group_leave(group);</div><div class="line">&#125;];</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// 所有网络请求结束后会来到这个方法</div><div class="line">dispatch_group_notify(group, serialQueue, ^&#123;</div><div class="line">dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</div><div class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">// 刷新UI</div><div class="line">&#125;);</div><div class="line">&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>66、解决openUrl延时问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">// 方法一</div><div class="line">dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line"></div><div class="line">UIApplication *application = [UIApplication sharedApplication];</div><div class="line">if ([application respondsToSelector:@selector(openURL:options:completionHandler:)]) &#123;</div><div class="line">[application openURL:URL options:@&#123;&#125;</div><div class="line">completionHandler:nil];</div><div class="line">&#125; else &#123;</div><div class="line">[application openURL:URL];</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">// 方法二</div><div class="line">[self performSelector:@selector(redirectToURL:) withObject:url afterDelay:0.1];</div><div class="line"></div><div class="line">- (void) redirectToURL</div><div class="line">&#123;</div><div class="line">UIApplication *application = [UIApplication sharedApplication];</div><div class="line">if ([application respondsToSelector:@selector(openURL:options:completionHandler:)]) &#123;</div><div class="line">[application openURL:URL options:@&#123;&#125;</div><div class="line">completionHandler:nil];</div><div class="line">&#125; else &#123;</div><div class="line">[application openURL:URL];</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>67、页面跳转实现翻转动画</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// modal方式</div><div class="line">TestViewController *vc = [[TestViewController alloc] init];</div><div class="line">vc.view.backgroundColor = [UIColor redColor];</div><div class="line">vc.modalTransitionStyle = UIModalTransitionStyleCoverVertical;</div><div class="line">[self presentViewController:vc animated:YES completion:nil];</div><div class="line"></div><div class="line">// push方式</div><div class="line">TestViewController *vc = [[TestViewController alloc] init];</div><div class="line">vc.view.backgroundColor = [UIColor redColor];</div><div class="line">[UIView beginAnimations:@&quot;View Flip&quot; context:nil];</div><div class="line">[UIView setAnimationDuration:0.80];</div><div class="line">[UIView setAnimationCurve:UIViewAnimationCurveEaseInOut];</div><div class="line">[UIView setAnimationTransition:UIViewAnimationTransitionFlipFromRight forView:self.navigationController.view cache:NO];</div><div class="line">[self.navigationController pushViewController:vc animated:YES];</div><div class="line">[UIView commitAnimations];</div></pre></td></tr></table></figure>
<p>68、tableView实现无限滚动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView</div><div class="line">&#123;</div><div class="line">CGFloat actualPosition = scrollView.contentOffset.y;</div><div class="line">CGFloat contentHeight = scrollView.contentSize.height - scrollView.frame.size.height;</div><div class="line">if (actualPosition &gt;= contentHeight) &#123;</div><div class="line">[self.dataArr addObjectsFromArray:self.dataArr];</div><div class="line">[self.tableView reloadData];</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>69、代码方式调整屏幕亮度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// brightness属性值在0-1之间，0代表最小亮度，1代表最大亮度</div><div class="line">[[UIScreen mainScreen] setBrightness:0.5];</div></pre></td></tr></table></figure>
<p>70、获取当前应用CUP用量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">float cpu_usage()</div><div class="line">&#123;</div><div class="line">kern_return_t kr;</div><div class="line">task_info_data_t tinfo;</div><div class="line">mach_msg_type_number_t task_info_count;</div><div class="line"></div><div class="line">task_info_count = TASK_INFO_MAX;</div><div class="line">kr = task_info(mach_task_self(), TASK_BASIC_INFO, (task_info_t)tinfo, &amp;task_info_count);</div><div class="line">if (kr != KERN_SUCCESS) &#123;</div><div class="line">return -1;</div><div class="line">&#125;</div><div class="line"></div><div class="line">task_basic_info_t      basic_info;</div><div class="line">thread_array_t         thread_list;</div><div class="line">mach_msg_type_number_t thread_count;</div><div class="line"></div><div class="line">thread_info_data_t     thinfo;</div><div class="line">mach_msg_type_number_t thread_info_count;</div><div class="line"></div><div class="line">thread_basic_info_t basic_info_th;</div><div class="line">uint32_t stat_thread = 0; // Mach threads</div><div class="line"></div><div class="line">basic_info = (task_basic_info_t)tinfo;</div><div class="line"></div><div class="line">// get threads in the task</div><div class="line">kr = task_threads(mach_task_self(), &amp;thread_list, &amp;thread_count);</div><div class="line">if (kr != KERN_SUCCESS) &#123;</div><div class="line">return -1;</div><div class="line">&#125;</div><div class="line">if (thread_count &gt; 0)</div><div class="line">stat_thread += thread_count;</div><div class="line"></div><div class="line">long tot_sec = 0;</div><div class="line">long tot_usec = 0;</div><div class="line">float tot_cpu = 0;</div><div class="line">int j;</div><div class="line"></div><div class="line">for (j = 0; j &lt; (int)thread_count; j++)</div><div class="line">&#123;</div><div class="line">thread_info_count = THREAD_INFO_MAX;</div><div class="line">kr = thread_info(thread_list[j], THREAD_BASIC_INFO,</div><div class="line">(thread_info_t)thinfo, &amp;thread_info_count);</div><div class="line">if (kr != KERN_SUCCESS) &#123;</div><div class="line">return -1;</div><div class="line">&#125;</div><div class="line"></div><div class="line">basic_info_th = (thread_basic_info_t)thinfo;</div><div class="line"></div><div class="line">if (!(basic_info_th-&gt;flags &amp; TH_FLAGS_IDLE)) &#123;</div><div class="line">tot_sec = tot_sec + basic_info_th-&gt;user_time.seconds + basic_info_th-&gt;system_time.seconds;</div><div class="line">tot_usec = tot_usec + basic_info_th-&gt;user_time.microseconds + basic_info_th-&gt;system_time.microseconds;</div><div class="line">tot_cpu = tot_cpu + basic_info_th-&gt;cpu_usage / (float)TH_USAGE_SCALE * 100.0;</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125; // for each thread</div><div class="line"></div><div class="line">kr = vm_deallocate(mach_task_self(), (vm_offset_t)thread_list, thread_count * sizeof(thread_t));</div><div class="line">assert(kr == KERN_SUCCESS);</div><div class="line"></div><div class="line">return tot_cpu;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>71、float数据取整四舍五入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CGFloat f = 4.65;</div><div class="line">NSLog(@&quot;%d&quot;, (int)f);    // 打印结果4</div><div class="line"></div><div class="line">CGFloat f = 4.65;</div><div class="line">NSLog(@&quot;%d&quot;, (int)round(f));    // 打印结果5</div></pre></td></tr></table></figure>
<p>72、删除UISearchBar系统默认边框</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// 方法一</div><div class="line">searchBar.searchBarStyle = UISearchBarStyleMinimal;</div><div class="line"></div><div class="line">// 方法二</div><div class="line">[searchBar setBackgroundImage:[[UIImage alloc]init]];</div><div class="line"></div><div class="line">// 方法三</div><div class="line">searchBar.barTintColor = [UIColor whiteColor];</div></pre></td></tr></table></figure>
<p>73、为UICollectionViewCell设置圆角和阴影</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">cell.contentView.layer.cornerRadius = 2.0f;</div><div class="line">cell.contentView.layer.borderWidth = 1.0f;</div><div class="line">cell.contentView.layer.borderColor = [UIColor clearColor].CGColor;</div><div class="line">cell.contentView.layer.masksToBounds = YES;</div><div class="line"></div><div class="line">cell.layer.shadowColor = [UIColor lightGrayColor].CGColor;</div><div class="line">cell.layer.shadowOffset = CGSizeMake(0, 2.0f);</div><div class="line">cell.layer.shadowRadius = 2.0f;</div><div class="line">cell.layer.shadowOpacity = 1.0f;</div><div class="line">cell.layer.masksToBounds = NO;</div><div class="line">cell.layer.shadowPath = [UIBezierPath bezierPathWithRoundedRect:cell.bounds cornerRadius:cell.contentView.layer.cornerRadius].CGPath;</div></pre></td></tr></table></figure>
<p>74、让正在滑动的scrollView停止滚动(不是禁止，而是暂时停止滚动)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[scrollView setContentOffset:scrollView.contentOffset animated:NO];</div></pre></td></tr></table></figure>
<p>75、使用xib设置UIView的边框、圆角<br>圆角和边框看下图即可设置<br><img src="http://ofutv2nt8.bkt.clouddn.com/xib%E8%AE%BE%E7%BD%AE%E5%9C%86%E8%A7%92%E8%BE%B9%E6%A1%86.png" alt="xib设置圆角边框.png"></p>
<p>但是增加layer.borderColor的keyPath设置边框颜色并不能起作用，后来查了资料，这里应该用layer.borderUIColor，但是这里设置的颜色不起作用，无论设置什么颜色显示出来的都是黑色的。后来又去查了下，有种解决方案是给CALayer添加一个分类，提供一个 - (void)setBorderUIColor:(UIColor *)color;方法就可以解决了，实现如下：</p>
<p><img src="http://ofutv2nt8.bkt.clouddn.com/xib%E8%AE%BE%E7%BD%AE%E8%BE%B9%E6%A1%86%E9%A2%9C%E8%89%B2.png" alt="xib设置边框颜色.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#import &quot;CALayer+BorderColor.h&quot;</div><div class="line"></div><div class="line">@implementation CALayer (BorderColor)</div><div class="line"></div><div class="line">- (void)setBorderUIColor:(UIColor *)color</div><div class="line">&#123;</div><div class="line">self.borderColor = color.CGColor;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>76、根据经纬度获取城市等信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">// 创建经纬度</div><div class="line">    CLLocation *location = [[CLLocation alloc] initWithLatitude:latitude longitude:longitude];</div><div class="line">    //创建一个译码器</div><div class="line">    CLGeocoder *cLGeocoder = [[CLGeocoder alloc] init];</div><div class="line">    [cLGeocoder reverseGeocodeLocation:userLocation completionHandler:^(NSArray *placemarks, NSError *error) &#123;</div><div class="line">        CLPlacemark *place = [placemarks objectAtIndex:0];</div><div class="line">        // 位置名</div><div class="line">    　　NSLog(@&quot;name,%@&quot;,place.name);</div><div class="line">    　　// 街道</div><div class="line">    　　NSLog(@&quot;thoroughfare,%@&quot;,place.thoroughfare);</div><div class="line">    　　// 子街道</div><div class="line">    　　NSLog(@&quot;subThoroughfare,%@&quot;,place.subThoroughfare);</div><div class="line">    　　// 市</div><div class="line">    　　NSLog(@&quot;locality,%@&quot;,place.locality);</div><div class="line">    　　// 区</div><div class="line">    　　NSLog(@&quot;subLocality,%@&quot;,place.subLocality); </div><div class="line">    　　// 国家</div><div class="line">    　　NSLog(@&quot;country,%@&quot;,place.country);</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">/*  CLPlacemark中属性含义</div><div class="line">name                    地名</div><div class="line"></div><div class="line">thoroughfare            街道</div><div class="line"></div><div class="line">subThoroughfare        街道相关信息，例如门牌等</div><div class="line">locality                城市</div><div class="line"></div><div class="line">subLocality            城市相关信息，例如标志性建筑</div><div class="line"></div><div class="line">administrativeArea      直辖市</div><div class="line"></div><div class="line">subAdministrativeArea  其他行政区域信息（自治区等）</div><div class="line"></div><div class="line">postalCode              邮编</div><div class="line"></div><div class="line">ISOcountryCode          国家编码</div><div class="line"></div><div class="line">country                国家</div><div class="line"></div><div class="line">inlandWater            水源，湖泊</div><div class="line"></div><div class="line">ocean                  海洋</div><div class="line"></div><div class="line">areasOfInterest        关联的或利益相关的地标</div><div class="line">*/</div></pre></td></tr></table></figure>
<p>77、如何防止添加多个NSNotification观察者？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// 解决方案就是添加观察者之前先移除下这个观察者</div><div class="line">[[NSNotificationCenter defaultCenter] removeObserver:observer name:name object:object];</div><div class="line">        [[NSNotificationCenter defaultCenter] addObserver:observer selector:selector name:name object:object];</div></pre></td></tr></table></figure>
<p>78、将一个xib添加到另外一个xib上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// 假设你的自定义view名字为CustomView，你需要在CustomView.m中重写 `- (instancetype)initWithCoder:(NSCoder *)aDecoder` 方法，代码如下：</div><div class="line">- (instancetype)initWithCoder:(NSCoder *)aDecoder &#123;</div><div class="line">    if ((self = [super initWithCoder:aDecoder])) &#123;</div><div class="line">        [self addSubview:[[[NSBundle mainBundle] loadNibNamed:@&quot;CustomView&quot; owner:self options:nil] objectAtIndex:0]];</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>将一个xib添加到另外一个xib上.png<br>79、处理字符串，使其首字母大写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">    NSString *str = @&quot;abcdefghijklmn&quot;;</div><div class="line">    NSString *resultStr;</div><div class="line">    if (str &amp;&amp; str.length &gt; 0) &#123;</div><div class="line">        resultStr = [str stringByReplacingCharactersInRange:NSMakeRange(0,1) withString:[[str substringToIndex:1] capitalizedString]];</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;%@&quot;, resultStr);</div><div class="line">80、判断一个UIAlertView/UIAlertController是否显示</div><div class="line">// UIAlertView自带属性</div><div class="line">if (alert.visible)</div><div class="line">&#123;</div><div class="line">      NSLog(@&quot;显示了&quot;);</div><div class="line">&#125; else &#123;</div><div class="line">      NSLog(@&quot;未显示&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// UIAlertController没有visible属性，需要自己判断，添加一个全局变量 BOOL visible</div><div class="line">UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@&quot;Title&quot; message:@&quot;message&quot; preferredStyle:UIAlertControllerStyleAlert];</div><div class="line">    UIAlertAction *alertAction = [UIAlertAction actionWithTitle:@&quot;ActionTitle&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</div><div class="line">        self.visible = NO;</div><div class="line">    &#125;];</div><div class="line">    UIAlertAction *calcelAction = [UIAlertAction actionWithTitle:@&quot;calcelTitle&quot; style:UIAlertActionStyleCancel handler:^(UIAlertAction * _Nonnull action) &#123;</div><div class="line">        self.visible = NO;</div><div class="line">    &#125;];</div><div class="line">    [alertController addAction:alertAction];</div><div class="line">    [alertController addAction:calcelAction];</div><div class="line">    [self presentViewController:alertController animated:YES completion:^&#123;</div><div class="line">        self.visible = YES;</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<p>81、获取字符串中的数字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (NSString *)getNumberFromStr:(NSString *)str</div><div class="line">&#123;</div><div class="line">    NSCharacterSet *nonDigitCharacterSet = [[NSCharacterSet decimalDigitCharacterSet] invertedSet];</div><div class="line">    return [[str componentsSeparatedByCharactersInSet:nonDigitCharacterSet] componentsJoinedByString:@&quot;&quot;];</div><div class="line">&#125;</div><div class="line">6</div><div class="line">    NSLog(@&quot;%@&quot;, [self getNumberFromStr:@&quot;a0b0c1d2e3f4fda8fa8fad9fsad23&quot;]); // 00123488923</div></pre></td></tr></table></figure>
<p>82、为UIView的某个方向添加边框</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">// 添加UIView分类</div><div class="line"></div><div class="line">// UIView+WZB.h</div><div class="line">#import</div><div class="line"></div><div class="line"></div><div class="line">/**</div><div class="line"> 边框方向</div><div class="line"></div><div class="line"> - WZBBorderDirectionTop: 顶部</div><div class="line"> - WZBBorderDirectionLeft: 左边</div><div class="line"> - WZBBorderDirectionBottom: 底部</div><div class="line"> - WZBBorderDirectionRight: 右边</div><div class="line"> */</div><div class="line">typedef NS_ENUM(NSInteger, WZBBorderDirectionType) &#123;</div><div class="line">    WZBBorderDirectionTop = 0,</div><div class="line">    WZBBorderDirectionLeft,</div><div class="line">    WZBBorderDirectionBottom,</div><div class="line">    WZBBorderDirectionRight</div><div class="line">&#125;;</div><div class="line"></div><div class="line">@interface UIView (WZB)</div><div class="line"></div><div class="line"></div><div class="line">/**</div><div class="line"> 为UIView的某个方向添加边框</div><div class="line"></div><div class="line"> @param direction 边框方向</div><div class="line"> @param color 边框颜色</div><div class="line"> @param width 边框宽度</div><div class="line"> */</div><div class="line">- (void)wzb_addBorder:(WZBBorderDirectionType)direction color:(UIColor *)color width:(CGFloat)width;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">// UIView+WZB.m</div><div class="line">#import &quot;UIView+WZB.h&quot;</div><div class="line"></div><div class="line">@implementation UIView (WZB)</div><div class="line"></div><div class="line">- (void)wzb_addBorder:(WZBBorderDirectionType)direction color:(UIColor *)color width:(CGFloat)width</div><div class="line">&#123;</div><div class="line">    CALayer *border = [CALayer layer];</div><div class="line">    border.backgroundColor = color.CGColor;</div><div class="line">    switch (direction) &#123;</div><div class="line">        case WZBBorderDirectionTop:</div><div class="line">        &#123;</div><div class="line">            border.frame = CGRectMake(0.0f, 0.0f, self.bounds.size.width, width);</div><div class="line">        &#125;</div><div class="line">            break;</div><div class="line">        case WZBBorderDirectionLeft:</div><div class="line">        &#123;</div><div class="line">            border.frame = CGRectMake(0.0f, 0.0f, width, self.bounds.size.height);</div><div class="line">        &#125;</div><div class="line">            break;</div><div class="line">        case WZBBorderDirectionBottom:</div><div class="line">        &#123;</div><div class="line">            border.frame = CGRectMake(0.0f, self.bounds.size.height - width, self.bounds.size.width, width);</div><div class="line">        &#125;</div><div class="line">            break;</div><div class="line">        case WZBBorderDirectionRight:</div><div class="line">        &#123;</div><div class="line">            border.frame = CGRectMake(self.bounds.size.width - width, 0, width, self.bounds.size.height);</div><div class="line">        &#125;</div><div class="line">            break;</div><div class="line">        default:</div><div class="line">            break;</div><div class="line">    &#125;</div><div class="line">    [self.layer addSublayer:border];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>83、通过属性设置UISwitch、UIProgressView等控件的宽高</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mySwitch.transform = CGAffineTransformMakeScale(5.0f, 5.0f);</div><div class="line"></div><div class="line">progressView.transform = CGAffineTransformMakeScale(5.0f, 5.0f);</div></pre></td></tr></table></figure>
<p>84、自动搜索功能，用户连续输入的时候不搜索，用户停止输入的时候自动搜索(我这里设置的是0.5s，可根据需求更改)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// 输入框文字改变的时候调用</div><div class="line">-(void)searchBar:(UISearchBar *)searchBar textDidChange:(NSString *)searchText&#123;</div><div class="line">    // 先取消调用搜索方法</div><div class="line">    [NSObject cancelPreviousPerformRequestsWithTarget:self selector:@selector(searchNewResult) object:nil];</div><div class="line">    // 0.5秒后调用搜索方法</div><div class="line">    [self performSelector:@selector(searchNewResult) withObject:nil afterDelay:0.5];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>85、修改UISearchBar的占位文字颜色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 方法一（推荐使用）</div><div class="line">UITextField *searchField = [searchBar valueForKey:@&quot;_searchField&quot;];</div><div class="line">[searchField setValue:[UIColor blueColor] forKeyPath:@&quot;_placeholderLabel.textColor&quot;];</div><div class="line"></div><div class="line">// 方法二（已过期）</div><div class="line">[[UILabel appearanceWhenContainedIn:[UISearchBar class], nil] setTextColor:[UIColor redColor]];</div><div class="line"></div><div class="line">// 方法三（已过期）</div><div class="line">NSDictionary *placeholderAttributes = @&#123;NSForegroundColorAttributeName : [UIColor redColor], NSFontAttributeName : [UIFont fontWithName:@&quot;HelveticaNeue&quot; size:15],&#125;;</div><div class="line">NSAttributedString *attributedPlaceholder = [[NSAttributedString alloc] initWithString:searchBar.placeholder attributes:placeholderAttributes];</div><div class="line">[[UITextField appearanceWhenContainedIn:[UISearchBar class], nil] setAttributedPlaceholder:attributedPlaceholder];</div></pre></td></tr></table></figure>
<p>86、某个界面多个事件同时响应引起的问题(比如，两个button同时按push到新界面，两个都会响应，可能导致push重叠)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// UIView有个属性叫做exclusiveTouch，设置为YES后，其响应事件会和其他view互斥(有其他view事件响应的时候点击它不起作用)</div><div class="line">view.exclusiveTouch = YES;</div><div class="line"></div><div class="line">// 一个一个设置太麻烦了，可以全局设置</div><div class="line">[[UIView appearance] setExclusiveTouch:YES];</div><div class="line"></div><div class="line">// 或者只设置button</div><div class="line">[[UIButton appearance] setExclusiveTouch:YES];</div></pre></td></tr></table></figure>
<p>87、修改tabBar的frame</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// 子类化UITabBarViewController，我这里以修改tabBar高度为例，重写viewWillLayoutSubviews方法</div><div class="line">#import &quot;WZBTabBarViewController.h&quot;</div><div class="line"></div><div class="line">@interface WZBTabBarViewController ()</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation WZBTabBarViewController</div><div class="line">- (void)viewWillLayoutSubviews &#123;</div><div class="line"></div><div class="line">    CGRect tabFrame = self.tabBar.frame;</div><div class="line">    tabFrame.size.height = 100;</div><div class="line">    tabFrame.origin.y = self.view.frame.size.height - 100;</div><div class="line">    self.tabBar.frame = tabFrame;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>88、修改键盘背景颜色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">// 设置某个键盘颜色</div><div class="line">    textField.keyboardAppearance = UIKeyboardAppearanceAlert;</div><div class="line"></div><div class="line">// 设置工程中所有键盘颜色</div><div class="line">[[UITextField appearance] setKeyboardAppearance:UIKeyboardAppearanceAlert];</div><div class="line">89、修改image颜色</div><div class="line">UIImage *image = [UIImage imageNamed:@&quot;test&quot;];</div><div class="line">    imageView.image = [image imageWithRenderingMode:UIImageRenderingModeAlwaysTemplate];</div><div class="line">    CGRect rect = CGRectMake(0, 0, image.size.width, image.size.height);</div><div class="line">    UIGraphicsBeginImageContext(rect.size);</div><div class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line">    CGContextClipToMask(context, rect, image.CGImage);</div><div class="line">    CGContextSetFillColorWithColor(context, [[UIColor redColor] CGColor]);</div><div class="line">    CGContextFillRect(context, rect);</div><div class="line">    UIImage *img = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line"></div><div class="line">    UIImage *flippedImage = [UIImage imageWithCGImage:img.CGImage scale:1.0 orientation: UIImageOrientationDownMirrored];</div><div class="line">    imageView.image = flippedImage;</div></pre></td></tr></table></figure>
<p>90、动画执行removeFromSuperview</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[UIView animateWithDuration:0.2</div><div class="line">                 animations:^&#123;</div><div class="line">                     view.alpha = 0.0f;</div><div class="line">                 &#125; completion:^(BOOL finished)&#123;</div><div class="line">                     [view removeFromSuperview];</div><div class="line">                 &#125;];</div></pre></td></tr></table></figure>
<p>91、设置UIButton高亮背景颜色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[UIView animateWithDuration:0.2</div><div class="line">                 animations:^&#123;</div><div class="line">                     view.alpha = 0.0f;</div><div class="line">                 &#125; completion:^(BOOL finished)&#123;</div><div class="line">                     [view removeFromSuperview];</div><div class="line">                 &#125;];</div></pre></td></tr></table></figure>
<p>92、设置UIButton高亮时的背景颜色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">// 方法一、子类化UIButton，重写setHighlighted:方法，代码如下</div><div class="line">#import &quot;WZBButton.h&quot;</div><div class="line"></div><div class="line">@implementation WZBButton</div><div class="line"></div><div class="line">- (void)setHighlighted:(BOOL)highlighted &#123;</div><div class="line">    [super setHighlighted:highlighted];</div><div class="line"></div><div class="line">    UIColor *normalColor = [UIColor greenColor];</div><div class="line">    UIColor *highlightedColor = [UIColor redColor];</div><div class="line">    self.backgroundColor = highlighted ? highlightedColor : normalColor;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">// 方法二、利用setBackgroundImage:forState:方法</div><div class="line">[button setBackgroundImage:[self imageWithColor:[UIColor blueColor]] forState:UIControlStateHighlighted];</div><div class="line"></div><div class="line">- (UIImage *)imageWithColor:(UIColor *)color &#123;</div><div class="line">    CGRect rect = CGRectMake(0.0f, 0.0f, 1.0f, 1.0f);</div><div class="line">    UIGraphicsBeginImageContext(rect.size);</div><div class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line"></div><div class="line">    CGContextSetFillColorWithColor(context, [color CGColor]);</div><div class="line">    CGContextFillRect(context, rect);</div><div class="line"></div><div class="line">    UIImage *image = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line"></div><div class="line">    return image;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>93、关于图片拉伸<br>推荐看这个博客，讲的很详细：<a href="http://blog.csdn.net/q199109106q/article/details/8615661" target="_blank" rel="external">http://blog.csdn.net/q199109106q/article/details/8615661</a></p>
<p>94、利用runtime获取一个类所有属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">- (NSArray *)allPropertyNames:(Class)aClass</div><div class="line">&#123;</div><div class="line">    unsigned count;</div><div class="line">    objc_property_t *properties = class_copyPropertyList(aClass, &amp;count);</div><div class="line"></div><div class="line">    NSMutableArray *rv = [NSMutableArray array];</div><div class="line"></div><div class="line">    unsigned i;</div><div class="line">    for (i = 0; i &lt; count; i++)</div><div class="line">    &#123;</div><div class="line">        objc_property_t property = properties[i];</div><div class="line">        NSString *name = [NSString stringWithUTF8String:property_getName(property)];</div><div class="line">        [rv addObject:name];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    free(properties);</div><div class="line"></div><div class="line">    return rv;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>95、设置textView的某段文字变成其他颜色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (void)setupTextView:(UITextView *)textView text:(NSString *)text color:(UIColor *)color &#123;</div><div class="line">    NSMutableAttributedString *string = [[NSMutableAttributedString alloc]initWithString:textView.text];</div><div class="line">    [string addAttribute:NSForegroundColorAttributeName value:color range:[textView.text rangeOfString:text]];</div><div class="line">    [textView setAttributedText:string];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>96、让push跳转动画像modal跳转动画那样效果(从下往上推上来)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">- (void)push</div><div class="line">&#123;</div><div class="line">TestViewController *vc = [[TestViewController alloc] init];</div><div class="line">    vc.view.backgroundColor = [UIColor redColor];</div><div class="line">    CATransition* transition = [CATransition animation];</div><div class="line">    transition.duration = 0.4f;</div><div class="line">    transition.type = kCATransitionMoveIn;</div><div class="line">    transition.subtype = kCATransitionFromTop;</div><div class="line">    [self.navigationController.view.layer addAnimation:transition forKey:kCATransition];</div><div class="line">    [self.navigationController pushViewController:vc animated:NO];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)pop</div><div class="line">&#123;</div><div class="line">CATransition* transition = [CATransition animation];</div><div class="line">    transition.duration = 0.4f;</div><div class="line">    transition.type = kCATransitionReveal;</div><div class="line">    transition.subtype = kCATransitionFromBottom;</div><div class="line">    [self.navigationController.view.layer addAnimation:transition forKey:kCATransition];</div><div class="line">    [self.navigationController popViewControllerAnimated:NO];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>97、上传图片太大，压缩图片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">-(UIImage *)resizeImage:(UIImage *)image</div><div class="line">&#123;</div><div class="line">    float actualHeight = image.size.height;</div><div class="line">    float actualWidth = image.size.width;</div><div class="line">    float maxHeight = 300.0;</div><div class="line">    float maxWidth = 400.0;</div><div class="line">    float imgRatio = actualWidth/actualHeight;</div><div class="line">    float maxRatio = maxWidth/maxHeight;</div><div class="line">    float compressionQuality = 0.5;//50 percent compression</div><div class="line"></div><div class="line">    if (actualHeight &gt; maxHeight || actualWidth &gt; maxWidth)</div><div class="line">    &#123;</div><div class="line">        if(imgRatio &lt; maxRatio)</div><div class="line">        &#123;</div><div class="line">            //adjust width according to maxHeight</div><div class="line">            imgRatio = maxHeight / actualHeight;</div><div class="line">            actualWidth = imgRatio * actualWidth;</div><div class="line">            actualHeight = maxHeight;</div><div class="line">        &#125;</div><div class="line">        else if(imgRatio &gt; maxRatio)</div><div class="line">        &#123;</div><div class="line">            //adjust height according to maxWidth</div><div class="line">            imgRatio = maxWidth / actualWidth;</div><div class="line">            actualHeight = imgRatio * actualHeight;</div><div class="line">            actualWidth = maxWidth;</div><div class="line">        &#125;</div><div class="line">        else</div><div class="line">        &#123;</div><div class="line">            actualHeight = maxHeight;</div><div class="line">            actualWidth = maxWidth;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    CGRect rect = CGRectMake(0.0, 0.0, actualWidth, actualHeight);</div><div class="line">    UIGraphicsBeginImageContext(rect.size);</div><div class="line">    [image drawInRect:rect];</div><div class="line">    UIImage *img = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    NSData *imageData = UIImageJPEGRepresentation(img, compressionQuality);</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line"></div><div class="line">    return [UIImage imageWithData:imageData];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/01/iOS改变字体大小功能的实现/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/01/iOS改变字体大小功能的实现/" itemprop="url">
                  iOS改变字体大小功能的实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-01T21:52:10+08:00">
                2017-03-01
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>所有label继承于一个基类, 由基类监听字体改变的通知, 从而改变所有Label的字体, 同时存储字体改变.</p>
<p>demo地址: <a href="https://github.com/AnGuoli/AYChangeFontDemo" target="_blank" rel="external">https://github.com/AnGuoli/AYChangeFontDemo</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/18/iOS时间戳时间互相转化/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/18/iOS时间戳时间互相转化/" itemprop="url">
                  iOS时间戳时间互相转化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-18T23:05:39+08:00">
                2017-02-18
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="时间戳转时间"><a href="#时间戳转时间" class="headerlink" title="时间戳转时间"></a>时间戳转时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (void)click1 &#123;</div><div class="line">NSString *dataStr = @&quot;1470376282&quot;;</div><div class="line">NSString *format = @&quot;yyyy-MM-dd HH:mm:ss SSS&quot;;</div><div class="line">NSDateFormatter *dateFormat = [[NSDateFormatter alloc] init];</div><div class="line">//[formatter setDateStyle:NSDateFormatterFullStyle];// 修改下面提到的北京时间的日期格式</div><div class="line">//[formatter setTimeStyle:NSDateFormatterFullStyle];// 修改下面提到的北京时间的时间格式</div><div class="line">// 此行代码与上面两行作用一样，故上面两行代码失效</div><div class="line">[dateFormat setDateFormat:format];</div><div class="line">//    NSTimeInterval timeInterval = [dataStr doubleValue];</div><div class="line">NSDate *date = [NSDate dateWithTimeIntervalSince1970:[dataStr intValue]];</div><div class="line">NSString *dateBeijing = [dateFormat stringFromDate:date];</div><div class="line">NSLog(@&quot;%@这个时间是格林尼治时间&quot;,date);</div><div class="line">NSLog(@&quot;%@这个时间是北京时间&quot;, dateBeijing);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="上传时使用当前的系统时间作为文件名-date-转-时间"><a href="#上传时使用当前的系统时间作为文件名-date-转-时间" class="headerlink" title="上传时使用当前的系统时间作为文件名 (date 转 时间)"></a>上传时使用当前的系统时间作为文件名 (date 转 时间)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (void)click2 &#123;</div><div class="line">// 可以在上传时使用当前的系统事件作为文件名</div><div class="line">NSDateFormatter *formatter = [[NSDateFormatter alloc] init];</div><div class="line">// 设置时间格式</div><div class="line">formatter.dateFormat = @&quot;yyyyMMddHHmmssSSS&quot;;</div><div class="line">NSString *str = [formatter stringFromDate:[NSDate date]];</div><div class="line">NSString *fileName = [NSString stringWithFormat:@&quot;%@.png&quot;, str];</div><div class="line">NSLog(@&quot;fileName: %@&quot;, fileName);</div><div class="line">// 根据系统时间拼接文件保存路径</div><div class="line">//    NSString *outputPath = [NSHomeDirectory() stringByAppendingFormat:@&quot;/tmp/output-%@.mp4&quot;, [formatter stringFromDate:[NSDate date]]];</div><div class="line">//    NSLog(@&quot;video outputPath = %@&quot;,outputPath);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="将yyyy-MM-dd-HH-mm-ss格式时间转换成时间戳"><a href="#将yyyy-MM-dd-HH-mm-ss格式时间转换成时间戳" class="headerlink" title="将yyyy-MM-dd HH:mm:ss格式时间转换成时间戳"></a>将yyyy-MM-dd HH:mm:ss格式时间转换成时间戳</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (void)click3 &#123;</div><div class="line">NSString *timeStr = @&quot;2016-10-10 10:44:11&quot;;</div><div class="line"></div><div class="line">NSDateFormatter *format=[[NSDateFormatter alloc] init];</div><div class="line">[format setDateFormat:@&quot;yyyy-MM-dd HH:mm:ss&quot;];</div><div class="line">NSDate *endDate = [format dateFromString:timeStr];</div><div class="line"></div><div class="line">NSTimeInterval timeInterval = [endDate timeIntervalSince1970];</div><div class="line">NSLog(@&quot;%.f&quot;, timeInterval);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="根据20170130算7天后的日期"><a href="#根据20170130算7天后的日期" class="headerlink" title="根据20170130算7天后的日期"></a>根据20170130算7天后的日期</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">- (void)click4 &#123;</div><div class="line">//     根据20170130算7天后的日期</div><div class="line">NSDateFormatter *format=[[NSDateFormatter alloc] init];</div><div class="line">[format setDateFormat:@&quot;yyyyMMdd&quot;];</div><div class="line">NSDate *fromdate=[format dateFromString:@&quot;20170130&quot;];</div><div class="line"></div><div class="line">NSInteger dis = 7; //前后的天数</div><div class="line">NSTimeInterval oneDay = 24*60*60*1;  //1天的长度</div><div class="line"></div><div class="line">NSDate *theDate = [NSDate dateWithTimeInterval:oneDay*dis sinceDate:fromdate];</div><div class="line"></div><div class="line">NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];</div><div class="line">[dateFormatter setDateFormat:@&quot;yyyy-MM-dd&quot;];</div><div class="line">NSString *afterDateStr = [dateFormatter stringFromDate:theDate];</div><div class="line">NSLog(@&quot;%@&quot;,afterDateStr);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="输出发布时间"><a href="#输出发布时间" class="headerlink" title="输出发布时间"></a>输出发布时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">- (void)click5 &#123;</div><div class="line">// 1.获得年月日时分</div><div class="line">NSCalendar *calendar = [self currentCalendar];</div><div class="line">NSUInteger unitFlags = NSCalendarUnitYear| NSCalendarUnitMonth | NSCalendarUnitDay |NSCalendarUnitHour |NSCalendarUnitMinute;</div><div class="line">// 当前日期</div><div class="line">NSDateComponents *cmp1 = [calendar components:unitFlags fromDate:[NSDate date]];</div><div class="line"></div><div class="line">NSString *dataStr = @&quot;1470376282&quot;;</div><div class="line">NSDate *publishDate = [NSDate dateWithTimeIntervalSince1970:[dataStr intValue]];</div><div class="line">// 发布日期</div><div class="line">NSDateComponents *cmp2 = [calendar components:unitFlags fromDate:publishDate];</div><div class="line"></div><div class="line">// 2.格式化日期</div><div class="line">NSDateFormatter *formatter = [[NSDateFormatter alloc] init];</div><div class="line">BOOL isToday = NO;</div><div class="line">if ([cmp1 day] == [cmp2 day]) &#123; // 今天</div><div class="line">formatter.dateFormat = @&quot; HH:mm&quot;;</div><div class="line">isToday = YES;</div><div class="line">&#125; else if ([cmp1 year] == [cmp2 year]) &#123; // 今年</div><div class="line">formatter.dateFormat = @&quot;MM-dd HH:mm&quot;;</div><div class="line">&#125; else &#123;</div><div class="line">formatter.dateFormat = @&quot;yyyy-MM-dd HH:mm&quot;;</div><div class="line">&#125;</div><div class="line">NSString *time = [formatter stringFromDate:publishDate];</div><div class="line">NSLog(@&quot;发布时间: %@&quot;, time);</div><div class="line">&#125;</div><div class="line"></div><div class="line">## 日历获取在9.x之后的系统使用currentCalendar会出异常。在8.0之后使用系统新API。</div><div class="line">- (NSCalendar *)currentCalendar &#123;</div><div class="line">if ([NSCalendar respondsToSelector:@selector(calendarWithIdentifier:)]) &#123;</div><div class="line">return [NSCalendar calendarWithIdentifier:NSCalendarIdentifierGregorian];</div><div class="line">&#125;</div><div class="line">return [NSCalendar currentCalendar];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="算当前时间7天后的时间"><a href="#算当前时间7天后的时间" class="headerlink" title="算当前时间7天后的时间"></a>算当前时间7天后的时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">- (void)click6 &#123;</div><div class="line">NSInteger dis = 7; //前后的天数</div><div class="line">NSDate*nowDate = [NSDate date];</div><div class="line">NSDate* theDate;</div><div class="line">NSTimeInterval  oneDay = 24*60*60*1;  //1天的长度</div><div class="line">//之后的天数</div><div class="line">theDate = [nowDate initWithTimeIntervalSinceNow: +oneDay*dis];</div><div class="line">//之前的天数</div><div class="line">//    theDate = [nowDate initWithTimeIntervalSinceNow: -oneDay*dis];</div><div class="line">//实例化一个NSDateFormatter对象</div><div class="line">NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];</div><div class="line">//设定时间格式,这里可以设置成自己需要的格式</div><div class="line">[dateFormatter setDateFormat:@&quot;yyyy-MM-dd HH:mm:ss&quot;];</div><div class="line">NSString * endDateStr = [dateFormatter stringFromDate:theDate];</div><div class="line">NSLog(@&quot;当前时间7天后的时间: %@&quot;,endDateStr);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="计算发帖时间-比如几分钟前-几小时前"><a href="#计算发帖时间-比如几分钟前-几小时前" class="headerlink" title="计算发帖时间, 比如几分钟前, 几小时前"></a>计算发帖时间, 比如几分钟前, 几小时前</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">- (void)click7 &#123;</div><div class="line">// 计算发帖时间, 比如几分钟前, 几小时前</div><div class="line">NSString *endDt = @&quot;20170217155409&quot;;</div><div class="line">NSDateFormatter *format= [[NSDateFormatter alloc] init];</div><div class="line">[format setDateFormat:@&quot;yyyyMMddHHmmss&quot;];</div><div class="line">NSDate *endDate= [format dateFromString:endDt];</div><div class="line">NSTimeInterval endTime = [endDate timeIntervalSince1970];</div><div class="line">// 当前系统时间</div><div class="line">NSDate *nDate = [NSDate date];</div><div class="line">NSTimeInterval nTime = [nDate timeIntervalSince1970];</div><div class="line"></div><div class="line">//     时间差</div><div class="line">NSTimeInterval time = nTime - endTime;</div><div class="line">////    两个时间间隔也可以这么计算 [大 小] -&gt; 正</div><div class="line">//    NSTimeInterval time = [nDate timeIntervalSinceDate:endDate];</div><div class="line"></div><div class="line">if (time &lt; 0) &#123;</div><div class="line">NSLog(@&quot;夭寿啊,在未来发的帖&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (time &lt; 60) &#123;</div><div class="line">NSLog(@&quot;刚刚&quot;);</div><div class="line">&#125;</div><div class="line">NSInteger minutes = time / 60;</div><div class="line">if (minutes &lt; 60) &#123;</div><div class="line">NSLog(@&quot;%ld分钟前&quot;, minutes);</div><div class="line">&#125;</div><div class="line">// 秒转小时</div><div class="line">NSInteger hours = time / 3600;</div><div class="line">if (hours &lt; 24) &#123;</div><div class="line">NSLog(@&quot;%ld小时前&quot;,hours);</div><div class="line">&#125;</div><div class="line">// 秒转天数</div><div class="line">NSInteger days = time / 3600 / 24;</div><div class="line">if (days &lt; 30) &#123;</div><div class="line">NSLog(@&quot;%ld天前&quot;,days);</div><div class="line">&#125;</div><div class="line">// 秒转月</div><div class="line">NSInteger months = time / 3600 / 24 / 30;</div><div class="line">if (months &lt; 12) &#123;</div><div class="line">NSLog(@&quot;%ld月前&quot;,months);</div><div class="line"></div><div class="line">&#125;</div><div class="line">// 秒转年</div><div class="line">NSInteger years = time / 3600 / 24 / 30 / 12;</div><div class="line">NSLog(@&quot;%ld年前&quot;,years);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="判断竞价状态"><a href="#判断竞价状态" class="headerlink" title="判断竞价状态"></a>判断竞价状态</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">- (void)click8 &#123;</div><div class="line">// 根据获取到的时间字符串 endDt 和当前时间对比, 若 currentTime 大于 endDt 就显示竞价场次结束, 反之显示距离竞价结束的时间</div><div class="line">NSString *endDt = @&quot;20170223145409&quot;;</div><div class="line">NSDateFormatter *format= [[NSDateFormatter alloc] init];</div><div class="line">[format setDateFormat:@&quot;yyyyMMddHHmmss&quot;];</div><div class="line">NSDate *endDate= [format dateFromString:endDt];</div><div class="line">NSTimeInterval endTime = [endDate timeIntervalSince1970];</div><div class="line"></div><div class="line">NSString *timeStr = [self updateTimeForTimeInterval:endTime];</div><div class="line">NSLog(@&quot;%@&quot;, timeStr);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">// 几天前 几分钟前..</div><div class="line">- (NSString *)updateTimeForTimeInterval:(NSInteger)timeInterval &#123;</div><div class="line"></div><div class="line">// 获取当前时时间戳</div><div class="line">NSTimeInterval currentTime = [[NSDate date] timeIntervalSince1970];</div><div class="line">// 获取场次结束时间</div><div class="line">NSTimeInterval endTime = timeInterval;</div><div class="line">// 时间差</div><div class="line">NSTimeInterval time = endTime - currentTime;</div><div class="line"></div><div class="line">if (time &lt; 0) &#123;</div><div class="line">return @&quot;该场次已结束&quot;;</div><div class="line">&#125;</div><div class="line">// 秒转秒</div><div class="line">NSInteger seconds = time;</div><div class="line">if (seconds &lt; 60) &#123;</div><div class="line">return [NSString stringWithFormat:@&quot;%ld秒后结束&quot;, seconds];</div><div class="line">&#125;</div><div class="line">// 秒转分钟</div><div class="line">NSInteger minutes = time / 60;</div><div class="line">if (minutes &lt; 60) &#123;</div><div class="line">seconds = seconds - minutes*60;</div><div class="line">return [NSString stringWithFormat:@&quot;%ld分%ld秒后结束&quot;, minutes, seconds];</div><div class="line">&#125;</div><div class="line">// 秒转小时</div><div class="line">NSInteger hours = time / 3600;</div><div class="line">if (hours &lt; 24) &#123;</div><div class="line">minutes = (seconds - hours*3600) / 60;</div><div class="line">seconds = seconds  - hours *3600 - minutes*60;</div><div class="line"></div><div class="line">return [NSString stringWithFormat:@&quot;%ld小时%ld分%ld秒后结束&quot;, hours, minutes, seconds];</div><div class="line">&#125;</div><div class="line">// 秒转天数</div><div class="line">NSInteger days = time / 3600 / 24;</div><div class="line">//    if (days &lt; 30) &#123;</div><div class="line">hours = (seconds - days*3600*24) / 3600;</div><div class="line">minutes = (seconds - days*3600*24 - hours*3600) / 60;</div><div class="line">seconds = seconds  - days*3600*24 - hours *3600 - minutes*60;</div><div class="line"></div><div class="line">return [NSString stringWithFormat:@&quot;%ld天%ld小时%ld分%ld秒后结束&quot;, days, hours, minutes, seconds];</div><div class="line">//    &#125;</div><div class="line">//    // 秒转月</div><div class="line">//    NSInteger months = time / 3600 / 24 / 30;</div><div class="line">//    if (months &lt; 12) &#123;</div><div class="line">//        return [NSString stringWithFormat:@&quot;%ld月前&quot;,months];</div><div class="line">//    &#125;</div><div class="line">//    // 秒转年</div><div class="line">//    NSInteger years = time / 3600 / 24 / 30 / 12;</div><div class="line">//    return [NSString stringWithFormat:@&quot;%ld年前&quot;,years];</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/17/iOS常用代码块-注释规范/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/17/iOS常用代码块-注释规范/" itemprop="url">
                  iOS常用代码块&注释规范
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-17T22:08:52+08:00">
                2017-02-17
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/1742252-d89e87408ce3547e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS常用代码块&amp;注释规范"></p>
<blockquote>
<p>简洁快捷的代码块能极大地提高开发效率</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1742252-29b9db9cfcd29022.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Xcode自带的GDC代码块"></p>
<h2 id="属性注释-快捷键-xx"><a href="#属性注释-快捷键-xx" class="headerlink" title="属性注释 快捷键:xx"></a>属性注释 快捷键:xx</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/** &lt;#属性注释#&gt; */</div></pre></td></tr></table></figure>
<h2 id="多行注释-快捷键-zz"><a href="#多行注释-快捷键-zz" class="headerlink" title="多行注释 快捷键:zz"></a>多行注释 快捷键:zz</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/** &lt;#简要描述#&gt;</div><div class="line">* &lt;#详细描述#&gt;</div><div class="line">*/</div></pre></td></tr></table></figure>
<h2 id="pragma-mark-——-快捷键-mark"><a href="#pragma-mark-——-快捷键-mark" class="headerlink" title="#pragma mark ——- 快捷键:mark-"></a>#pragma mark ——- 快捷键:mark-</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#pragma mark ——— &lt;#mark#&gt;</div></pre></td></tr></table></figure>
<h2 id="pragma-mark-—-快捷键-mark"><a href="#pragma-mark-—-快捷键-mark" class="headerlink" title="#pragma mark — 快捷键:mark"></a>#pragma mark — 快捷键:mark</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#pragma mark — &lt;#mark#&gt;</div></pre></td></tr></table></figure>
<h2 id="weak属性创建-快捷键-weak"><a href="#weak属性创建-快捷键-weak" class="headerlink" title="weak属性创建 快捷键:weak"></a>weak属性创建 快捷键:weak</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/** &lt;#weak属性注释#&gt; */</div><div class="line">@property (nonatomic, weak) &lt;#Class#&gt; *&lt;#name#&gt;;</div></pre></td></tr></table></figure>
<h2 id="copy属性创建-快捷键-copy"><a href="#copy属性创建-快捷键-copy" class="headerlink" title="copy属性创建 快捷键:copy"></a>copy属性创建 快捷键:copy</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/** &lt;#copy属性注释#&gt; */</div><div class="line">@property (nonatomic, copy) NSString *&lt;#name#&gt;;</div></pre></td></tr></table></figure>
<h2 id="assign属性创建-快捷键-assign"><a href="#assign属性创建-快捷键-assign" class="headerlink" title="assign属性创建 快捷键: assign"></a>assign属性创建 快捷键: assign</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/** &lt;#assign属性注释#&gt; */</div><div class="line">@property (nonatomic, assign) &lt;#Class#&gt; &lt;#name#&gt;;</div></pre></td></tr></table></figure>
<h2 id="UIAlertViewController创建"><a href="#UIAlertViewController创建" class="headerlink" title="UIAlertViewController创建"></a>UIAlertViewController创建</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// UIAlertViewController(弹框视图)</div><div class="line">UIAlertController *&lt;#alert#&gt; = [UIAlertController alertControllerWithTitle:&lt;#title#&gt; message:&lt;#message#&gt; preferredStyle:&lt;#UIAlertControllerStyle#&gt;];</div><div class="line">UIAlertAction *&lt;#action#&gt; = [UIAlertAction actionWithTitle:&lt;#@&quot;确定&quot;#&gt; style:&lt;#UIAlertActionStyle#&gt; handler:&lt;#^(UIAlertAction * _Nonnull action)handler#&gt;];</div><div class="line">[alert addAction:&lt;#action#&gt;];</div><div class="line">[self presentViewController:&lt;#alert#&gt; animated:&lt;#(BOOL)#&gt; completion:&lt;#^(void)completion#&gt;];</div></pre></td></tr></table></figure>
<h2 id="懒加载"><a href="#懒加载" class="headerlink" title="懒加载"></a>懒加载</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#pragma mark - 懒加载</div><div class="line">- (&lt;#type#&gt; *)&lt;#name#&gt; &#123;</div><div class="line">if (!_&lt;#name#&gt;) &#123;</div><div class="line">_&lt;#name#&gt; = &lt;#statements#&gt;;</div><div class="line">&#125;</div><div class="line">return _&lt;#name#&gt;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="一个页面多个请求"><a href="#一个页面多个请求" class="headerlink" title="一个页面多个请求"></a>一个页面多个请求</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">dispatch_group_t group = dispatch_group_create();</div><div class="line">dispatch_group_enter(group);</div><div class="line"></div><div class="line">[^&#123;</div><div class="line">dispatch_group_leave(group);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">dispatch_group_enter(group);</div><div class="line"></div><div class="line">[^&#123;</div><div class="line">dispatch_group_leave(group);</div><div class="line">&#125;];</div><div class="line">dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/17/postName/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/17/postName/" itemprop="url">
                  书签
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-17T19:18:52+08:00">
                2016-11-17
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/17/My-New-Post/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/17/My-New-Post/" itemprop="url">
                  Runtime应用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-17T19:15:17+08:00">
                2016-11-17
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Runtime原理探究参考另一篇文章 <a href="https://juejin.im/post/5a37562451882506e50cbc9a" target="_blank" rel="external">Runtime原理探究</a>, 本文主要整理Runtime在实际开发中的应用.</p>
<h2 id="一-交换方法（method-swizzing）"><a href="#一-交换方法（method-swizzing）" class="headerlink" title="一. 交换方法（method swizzing）"></a>一. 交换方法（method swizzing）</h2><p>涉及到的方法<br><code>load</code> <code>class_getInstanceMethod</code> <code>class_getClassMethod</code> <code>method_exchangeImplementations</code> <code>method_getImplementation</code> <code>class_addMethod</code> <code>class_replaceMethod</code></p>
<p><a href="http://www.jianshu.com/p/e071206103a4" target="_blank" rel="external">让你快速上手Runtime 袁峥</a></p>
<ul>
<li><code>开发使用场景</code>:系统自带的方法功能不够，给系统自带的方法扩展一些功能，并且保持原有的功能。</li>
<li><code>方式一</code>:继承系统的类，重写方法.</li>
<li><code>方式二</code>:使用Runtime,交换方法.<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">[super viewDidLoad];</div><div class="line">// Do any additional setup after loading the view, typically from a nib.</div><div class="line">// 需求：给imageNamed方法提供功能，每次加载图片就判断下图片是否加载成功。</div><div class="line">// 步骤一：先搞个分类，定义一个能加载图片并且能打印的方法+ (instancetype)imageWithName:(NSString *)name;</div><div class="line">// 步骤二：交换imageNamed和imageWithName的实现，就能调用imageWithName，间接调用imageWithName的实现。</div><div class="line">UIImage *image = [UIImage imageNamed:@&quot;123&quot;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation UIImage (Image)</div><div class="line">// 加载分类到内存的时候调用</div><div class="line">+ (void)load</div><div class="line">&#123;</div><div class="line">// 交换方法</div><div class="line"></div><div class="line">// 获取imageWithName方法地址</div><div class="line">Method imageWithName = class_getClassMethod(self, @selector(imageWithName:));</div><div class="line"></div><div class="line">// 获取imageWithName方法地址</div><div class="line">Method imageName = class_getClassMethod(self, @selector(imageNamed:));</div><div class="line"></div><div class="line">// 交换方法地址，相当于交换实现方式</div><div class="line">method_exchangeImplementations(imageWithName, imageName);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 不能在分类中重写系统方法imageNamed，因为会把系统的功能给覆盖掉，而且分类中不能调用super.</div><div class="line">// 既能加载图片又能打印</div><div class="line">+ (instancetype)imageWithName:(NSString *)name</div><div class="line">&#123;</div><div class="line">// 这里调用imageWithName，相当于调用imageName</div><div class="line">UIImage *image = [self imageWithName:name];</div><div class="line"></div><div class="line">if (image == nil) &#123;</div><div class="line">NSLog(@&quot;加载空的图片&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">return image;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
</li>
</ul>
<p><a href="http://www.jianshu.com/p/3e050ec3b759" target="_blank" rel="external">Objective-C中的Runtime LeeJay</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">+ (void)load</div><div class="line">&#123;</div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line"></div><div class="line">SEL originalSelector = @selector(willMoveToSuperview:);</div><div class="line">SEL swizzledSelector = @selector(myWillMoveToSuperview:);</div><div class="line"></div><div class="line">Method originalMethod = class_getInstanceMethod(self, originalSelector);</div><div class="line">Method swizzledMethod = class_getInstanceMethod(self, swizzledSelector);</div><div class="line"></div><div class="line">BOOL didAddMethod = class_addMethod(self,</div><div class="line">originalSelector,</div><div class="line">method_getImplementation(swizzledMethod),</div><div class="line">method_getTypeEncoding(swizzledMethod));</div><div class="line"></div><div class="line">if (didAddMethod) &#123;</div><div class="line">class_replaceMethod(self,</div><div class="line">swizzledSelector,</div><div class="line">method_getImplementation(originalMethod),</div><div class="line">method_getTypeEncoding(originalMethod));</div><div class="line">&#125; else &#123;</div><div class="line">method_exchangeImplementations(originalMethod, swizzledMethod);</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)myWillMoveToSuperview:(UIView *)newSuperview</div><div class="line">&#123;</div><div class="line">NSLog(@&quot;WillMoveToSuperview: %@&quot;, self);</div><div class="line">[self myWillMoveToSuperview:newSuperview];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li><p>1.如果我现在想检查一下项目中有没有内存循环，怎么办？是不是要重写<code>dealloc</code>函数，看下<code>dealloc</code>有没有执行，项目小的时候，一个一个<code>controlle</code>r的写，还不麻烦，如果项目大，要是一个一个的写，估计你会疯掉的。这时候方法交换就派上用场了，你就可以尝试用自己的方法交换系统的<code>dealloc</code>方法，几句代码就搞定了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">#import &quot;UIViewController+Dealloc.h&quot;</div><div class="line">#import &lt;objc/runtime.h&gt;</div><div class="line"></div><div class="line">@implementation UIViewController (Dealloc)</div><div class="line"></div><div class="line">+ (void)load</div><div class="line">&#123;</div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">Method method1 = class_getInstanceMethod(self, NSSelectorFromString(@&quot;dealloc&quot;));</div><div class="line">Method method2 = class_getInstanceMethod(self, @selector(my_dealloc));</div><div class="line">method_exchangeImplementations(method1, method2);</div><div class="line">&#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)my_dealloc</div><div class="line">&#123;</div><div class="line">NSLog(@&quot;%@销毁了&quot;, self);</div><div class="line">[self my_dealloc];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
</li>
<li><p>2.数组越界，向数组中添加一个nil对象等等，都会造成闪退，我们可以用自己的方法交换数组相对应的方法。下面是一个交换数组addObject:方法的栗子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">#import &quot;NSMutableArray+Category.h&quot;</div><div class="line">#import &lt;objc/runtime.h&gt;</div><div class="line"></div><div class="line">@implementation NSMutableArray (Category)</div><div class="line"></div><div class="line">+ (void)load</div><div class="line">&#123;</div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line"></div><div class="line">SEL originalSelector = @selector(addObject:);</div><div class="line">SEL swizzledSelector = @selector(lj_AddObject:);</div><div class="line"></div><div class="line">// NSMutableArray是类簇，真正的类名是__NSArrayM</div><div class="line">Method originalMethod = class_getInstanceMethod(objc_getClass(&quot;__NSArrayM&quot;), originalSelector);</div><div class="line">Method swizzledMethod = class_getInstanceMethod(objc_getClass(&quot;__NSArrayM&quot;), swizzledSelector);</div><div class="line"></div><div class="line">BOOL didAddMethod = class_addMethod(self,</div><div class="line">originalSelector,</div><div class="line">method_getImplementation(swizzledMethod),</div><div class="line">method_getTypeEncoding(swizzledMethod));</div><div class="line"></div><div class="line">if (didAddMethod)</div><div class="line">&#123;</div><div class="line">class_replaceMethod(self,</div><div class="line">swizzledSelector,</div><div class="line">method_getImplementation(originalMethod),</div><div class="line">method_getTypeEncoding(originalMethod));</div><div class="line">&#125;</div><div class="line">else</div><div class="line">&#123;</div><div class="line">method_exchangeImplementations(originalMethod, swizzledMethod);</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)lj_AddObject:(id)object</div><div class="line">&#123;</div><div class="line">if (object != nil)</div><div class="line">&#123;</div><div class="line">[self lj_AddObject:object];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>PS：我不太建议大家平时开发的时候使用这类数组安全操作的做法，不利于代码的调试，如果真的加入了nil对象，你可能就不会那么容易找出问题在哪，还是在项目发布的时候使用比较合适。</p>
</blockquote>
<p><a href="http://www.jianshu.com/p/f6dad8e1b848" target="_blank" rel="external">Runtime Method Swizzling开发实例汇总（持续更新中） 卖报的小画家Sure</a></p>
<h3 id="Method-Swizzling通用方法封装"><a href="#Method-Swizzling通用方法封装" class="headerlink" title="Method Swizzling通用方法封装"></a>Method Swizzling通用方法封装</h3><p>在列举之前，我们可以将Method Swizzling功能封装为类方法，作为NSObject的类别，这样我们后续调用也会方便些。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line">#import &lt;objc/runtime.h&gt;</div><div class="line">@interface NSObject (Swizzling)</div><div class="line"></div><div class="line">+ (void)methodSwizzlingWithOriginalSelector:(SEL)originalSelector</div><div class="line">bySwizzledSelector:(SEL)swizzledSelector;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">#import &quot;NSObject+Swizzling.h&quot;</div><div class="line">@implementation NSObject (Swizzling)</div><div class="line"></div><div class="line">+ (void)methodSwizzlingWithOriginalSelector:(SEL)originalSelector bySwizzledSelector:(SEL)swizzledSelector&#123;</div><div class="line">Class class = [self class];</div><div class="line">//原有方法</div><div class="line">Method originalMethod = class_getInstanceMethod(class, originalSelector);</div><div class="line">//替换原有方法的新方法</div><div class="line">Method swizzledMethod = class_getInstanceMethod(class, swizzledSelector);</div><div class="line">//先尝试給源SEL添加IMP，这里是为了避免源SEL没有实现IMP的情况</div><div class="line">BOOL didAddMethod = class_addMethod(class,originalSelector,</div><div class="line">method_getImplementation(swizzledMethod),</div><div class="line">method_getTypeEncoding(swizzledMethod));</div><div class="line">if (didAddMethod) &#123;//添加成功：说明源SEL没有实现IMP，将源SEL的IMP替换到交换SEL的IMP</div><div class="line">class_replaceMethod(class,swizzledSelector,</div><div class="line">method_getImplementation(originalMethod),</div><div class="line">method_getTypeEncoding(originalMethod));</div><div class="line">&#125; else &#123;//添加失败：说明源SEL已经有IMP，直接将两个SEL的IMP交换即可</div><div class="line">method_exchangeImplementations(originalMethod, swizzledMethod);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<ul>
<li><strong>为什么要添加didAddMethod判断？</strong><br>先尝试添加原SEL其实是为了做一层保护，因为如果这个类没有实现originalSelector，但其父类实现了，那class_getInstanceMethod会返回父类的方法。这样method_exchangeImplementations替换的是父类的那个方法，这当然不是我们想要的。所以我们先尝试添加 orginalSelector，如果已经存在，再用 method_exchangeImplementations 把原方法的实现跟新的方法实现给交换掉。<br>如果理解还不够透彻，我们可以进入runtime.h中查看class_addMethod源码解释：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">* Adds a new method to a class with a given name and implementation.</div><div class="line">*</div><div class="line">* @param cls The class to which to add a method.</div><div class="line">* @param name A selector that specifies the name of the method being added.</div><div class="line">* @param imp A function which is the implementation of the new method. The function must take at least two arguments—self and _cmd.</div><div class="line">* @param types An array of characters that describe the types of the arguments to the method.</div><div class="line">*</div><div class="line">* @return YES if the method was added successfully, otherwise NO</div><div class="line">*  (for example, the class already contains a method implementation with that name).</div><div class="line">*</div><div class="line">* @note class_addMethod will add an override of a superclass&apos;s implementation,</div><div class="line">*  but will not replace an existing implementation in this class.</div><div class="line">*  To change an existing implementation, use method_setImplementation.</div><div class="line">*/</div></pre></td></tr></table></figure>
</li>
</ul>
<p>大概的意思就是我们可以通过class_addMethod为一个类添加方法（包括方法名称（SEL）和方法的实现（IMP）），返回值为BOOL类型，表示方法是否成功添加。 <strong>需要注意的地方是class_addMethod会添加一个覆盖父类的实现，但不会取代原有类的实现。</strong> 也就是说如果class_addMethod返回YES，说明子类中没有方法originalSelector，通过class_addMethod为其添加了方法originalSelector，并使其实现（IMP）为我们想要替换的实现。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class_addMethod(class,originalSelector,</div><div class="line">method_getImplementation(swizzledMethod),</div><div class="line">method_getTypeEncoding(swizzledMethod));</div></pre></td></tr></table></figure></p>
<p>同时再将原有的实现（IMP）替换到swizzledMethod方法上，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class_replaceMethod(class,swizzledSelector,</div><div class="line">method_getImplementation(originalMethod),</div><div class="line">method_getTypeEncoding(originalMethod));</div></pre></td></tr></table></figure></p>
<p>从而实现了方法的交换，并且未影响父类方法的实现。反之如果class_addMethod返回NO，说明子类中本身就具有方法originalSelector的实现，直接调用交换即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">method_exchangeImplementations(originalMethod, swizzledMethod);</div></pre></td></tr></table></figure></p>
<h3 id="实例一：替换ViewController生命周期方法"><a href="#实例一：替换ViewController生命周期方法" class="headerlink" title="实例一：替换ViewController生命周期方法"></a>实例一：替换ViewController生命周期方法</h3><p>示当前请求情况或进度。这种界面都会存在这样一个问题，在请求较慢时，用户手动退出界面，这时候需要去除加载栏。<br>当然可以依次在每个界面的viewWillDisappear方法中添加去除方法，但如果类似的界面过多，一味的复制粘贴也不是方法。这时候就能体现Method Swizzling的作用了，我们可以替换系统的viewWillDisappear方法，使得每当执行该方法时即自动去除加载栏。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#import &quot;UIViewController+Swizzling.h&quot;</div><div class="line">#import &quot;NSObject+Swizzling.h&quot;</div><div class="line">@implementation UIViewController (Swizzling)</div><div class="line"></div><div class="line">+ (void)load &#123;</div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">[self methodSwizzlingWithOriginalSelector:@selector(viewWillDisappear:) bySwizzledSelector:@selector(sure_viewWillDisappear:)];</div><div class="line">&#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)sure_viewWillDisappear:(BOOL)animated &#123;</div><div class="line">[self sure_viewWillDisappear:animated];</div><div class="line">[SVProgressHUD dismiss];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>代码如上，这样就不用考虑界面是否移除加载栏的问题了。补充一点，通常我们也会在生命周期方法中设置默认界面背景颜色，因若背景颜色默认为透明对App的性能也有一定影响，这大家可以在UIKit性能优化那篇文章中查阅。但类似该类操作也可以书写在通用类中，所以具体使用还要靠自己定夺。</p>
<h3 id="实例二：解决获取索引、添加、删除元素越界崩溃问题"><a href="#实例二：解决获取索引、添加、删除元素越界崩溃问题" class="headerlink" title="实例二：解决获取索引、添加、删除元素越界崩溃问题"></a>实例二：解决获取索引、添加、删除元素越界崩溃问题</h3><p>对于NSArray、NSDictionary、NSMutableArray、NSMutableDictionary不免会进行索引访问、添加、删除元素的操作，越界问题也是很常见，这时我们可以通过Method Swizzling解决这些问题，越界给予提示防止崩溃。</p>
<p>这里以NSMutableArray为例说明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">#import &quot;NSMutableArray+Swizzling.h&quot;</div><div class="line">#import &quot;NSObject+Swizzling.h&quot;</div><div class="line">@implementation NSMutableArray (Swizzling)</div><div class="line"></div><div class="line">+ (void)load &#123;</div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">[objc_getClass(&quot;__NSArrayM&quot;) methodSwizzlingWithOriginalSelector:@selector(removeObject:) bySwizzledSelector:@selector(safeRemoveObject:) ];</div><div class="line">[objc_getClass(&quot;__NSArrayM&quot;) methodSwizzlingWithOriginalSelector:@selector(addObject:) bySwizzledSelector:@selector(safeAddObject:)];</div><div class="line">[objc_getClass(&quot;__NSArrayM&quot;) methodSwizzlingWithOriginalSelector:@selector(removeObjectAtIndex:) bySwizzledSelector:@selector(safeRemoveObjectAtIndex:)];</div><div class="line">[objc_getClass(&quot;__NSArrayM&quot;) methodSwizzlingWithOriginalSelector:@selector(insertObject:atIndex:) bySwizzledSelector:@selector(safeInsertObject:atIndex:)];</div><div class="line">[objc_getClass(&quot;__NSArrayM&quot;) methodSwizzlingWithOriginalSelector:@selector(objectAtIndex:) bySwizzledSelector:@selector(safeObjectAtIndex:)];</div><div class="line">&#125;);</div><div class="line">&#125;</div><div class="line">- (void)safeAddObject:(id)obj &#123;</div><div class="line">if (obj == nil) &#123;</div><div class="line">NSLog(@&quot;%s can add nil object into NSMutableArray&quot;, __FUNCTION__);</div><div class="line">&#125; else &#123;</div><div class="line">[self safeAddObject:obj];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">- (void)safeRemoveObject:(id)obj &#123;</div><div class="line">if (obj == nil) &#123;</div><div class="line">NSLog(@&quot;%s call -removeObject:, but argument obj is nil&quot;, __FUNCTION__);</div><div class="line">return;</div><div class="line">&#125;</div><div class="line">[self safeRemoveObject:obj];</div><div class="line">&#125;</div><div class="line">- (void)safeInsertObject:(id)anObject atIndex:(NSUInteger)index &#123;</div><div class="line">if (anObject == nil) &#123;</div><div class="line">NSLog(@&quot;%s can&apos;t insert nil into NSMutableArray&quot;, __FUNCTION__);</div><div class="line">&#125; else if (index &gt; self.count) &#123;</div><div class="line">NSLog(@&quot;%s index is invalid&quot;, __FUNCTION__);</div><div class="line">&#125; else &#123;</div><div class="line">[self safeInsertObject:anObject atIndex:index];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">- (id)safeObjectAtIndex:(NSUInteger)index &#123;</div><div class="line">if (self.count == 0) &#123;</div><div class="line">NSLog(@&quot;%s can&apos;t get any object from an empty array&quot;, __FUNCTION__);</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line">if (index &gt; self.count) &#123;</div><div class="line">NSLog(@&quot;%s index out of bounds in array&quot;, __FUNCTION__);</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line">return [self safeObjectAtIndex:index];</div><div class="line">&#125;</div><div class="line">- (void)safeRemoveObjectAtIndex:(NSUInteger)index &#123;</div><div class="line">if (self.count &lt;= 0) &#123;</div><div class="line">NSLog(@&quot;%s can&apos;t get any object from an empty array&quot;, __FUNCTION__);</div><div class="line">return;</div><div class="line">&#125;</div><div class="line">if (index &gt;= self.count) &#123;</div><div class="line">NSLog(@&quot;%s index out of bound&quot;, __FUNCTION__);</div><div class="line">return;</div><div class="line">&#125;</div><div class="line">[self safeRemoveObjectAtIndex:index];</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>对应大家可以举一反三，相应的实现添加、删除等，以及NSArray、NSDictionary等操作，因代码篇幅较大，这里就不一一书写了。<br>这里没有使用self来调用，而是使用objc_getClass(“__NSArrayM”)来调用的。因为NSMutableArray的真实类只能通过后者来获取，而不能通过[self class]来获取，而method swizzling只对真实的类起作用。这里就涉及到一个小知识点：类簇。补充以上对象对应类簇表。<br><img src="https://user-gold-cdn.xitu.io/2017/12/19/1606df33cd55583b?w=642&amp;h=197&amp;f=png&amp;s=7368" alt="类簇表"></p>
<h3 id="实例三：防止按钮重复暴力点击"><a href="#实例三：防止按钮重复暴力点击" class="headerlink" title="实例三：防止按钮重复暴力点击"></a>实例三：防止按钮重复暴力点击</h3><p>程序中大量按钮没有做连续响应的校验，连续点击出现了很多不必要的问题，例如发表帖子操作，用户手快点击多次，就会导致同一帖子发布多次。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line">//默认时间间隔</div><div class="line">#define defaultInterval 1</div><div class="line">@interface UIButton (Swizzling)</div><div class="line">//点击间隔</div><div class="line">@property (nonatomic, assign) NSTimeInterval timeInterval;</div><div class="line">//用于设置单个按钮不需要被hook</div><div class="line">@property (nonatomic, assign) BOOL isIgnore;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">#import &quot;UIButton+Swizzling.h&quot;</div><div class="line">#import &quot;NSObject+Swizzling.h&quot;</div><div class="line"></div><div class="line">@implementation UIButton (Swizzling)</div><div class="line"></div><div class="line">+ (void)load &#123;</div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">[self methodSwizzlingWithOriginalSelector:@selector(sendAction:to:forEvent:) bySwizzledSelector:@selector(sure_SendAction:to:forEvent:)];</div><div class="line">&#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSTimeInterval)timeInterval&#123;</div><div class="line">return [objc_getAssociatedObject(self, _cmd) doubleValue];</div><div class="line">&#125;</div><div class="line">- (void)setTimeInterval:(NSTimeInterval)timeInterval&#123;</div><div class="line">objc_setAssociatedObject(self, @selector(timeInterval), @(timeInterval), OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line"></div><div class="line">&#125;</div><div class="line">//当按钮点击事件sendAction 时将会执行sure_SendAction</div><div class="line">- (void)sure_SendAction:(SEL)action to:(id)target forEvent:(UIEvent *)event&#123;</div><div class="line">if (self.isIgnore) &#123;</div><div class="line">//不需要被hook</div><div class="line">[self sure_SendAction:action to:target forEvent:event];</div><div class="line">return;</div><div class="line">&#125;</div><div class="line">if ([NSStringFromClass(self.class) isEqualToString:@&quot;UIButton&quot;]) &#123;</div><div class="line">self.timeInterval =self.timeInterval == 0 ?defaultInterval:self.timeInterval;</div><div class="line">if (self.isIgnoreEvent)&#123;</div><div class="line">return;</div><div class="line">&#125;else if (self.timeInterval &gt; 0)&#123;</div><div class="line">[self performSelector:@selector(resetState) withObject:nil afterDelay:self.timeInterval];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">//此处 methodA和methodB方法IMP互换了，实际上执行 sendAction；所以不会死循环</div><div class="line">self.isIgnoreEvent = YES;</div><div class="line">[self sure_SendAction:action to:target forEvent:event];</div><div class="line">&#125;</div><div class="line">//runtime 动态绑定 属性</div><div class="line">- (void)setIsIgnoreEvent:(BOOL)isIgnoreEvent&#123;</div><div class="line">// 注意BOOL类型 需要用OBJC_ASSOCIATION_RETAIN_NONATOMIC 不要用错，否则set方法会赋值出错</div><div class="line">objc_setAssociatedObject(self, @selector(isIgnoreEvent), @(isIgnoreEvent), OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line">- (BOOL)isIgnoreEvent&#123;</div><div class="line">//_cmd == @select(isIgnore); 和set方法里一致</div><div class="line">return [objc_getAssociatedObject(self, _cmd) boolValue];</div><div class="line">&#125;</div><div class="line">- (void)setIsIgnore:(BOOL)isIgnore&#123;</div><div class="line">// 注意BOOL类型 需要用OBJC_ASSOCIATION_RETAIN_NONATOMIC 不要用错，否则set方法会赋值出错</div><div class="line">objc_setAssociatedObject(self, @selector(isIgnore), @(isIgnore), OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line">- (BOOL)isIgnore&#123;</div><div class="line">//_cmd == @select(isIgnore); 和set方法里一致</div><div class="line">return [objc_getAssociatedObject(self, _cmd) boolValue];</div><div class="line">&#125;</div><div class="line">- (void)resetState&#123;</div><div class="line">[self setIsIgnoreEvent:NO];</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h3 id="实例四：全局更换控件初始效果"><a href="#实例四：全局更换控件初始效果" class="headerlink" title="实例四：全局更换控件初始效果"></a>实例四：全局更换控件初始效果</h3><p>以UILabel为例，在项目比较成熟的基础上，应用中需要引入新的字体，需要更换所有Label的默认字体，但是同时，对于一些特殊设置了字体的label又不需要更换。乍看起来，这个问题确实十分棘手，首先项目比较大，一个一个设置所有使用到的label的font工作量是巨大的，并且在许多动态展示的界面中，可能会漏掉一些label，产生bug。其次，项目中的label来源并不唯一，有用代码创建的，有xib和storyBoard中的，这也将浪费很大的精力。这时Method Swizzling可以解决此问题，避免繁琐的操作。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">#import &quot;UILabel+Swizzling.h&quot;</div><div class="line">#import &quot;NSObject+Swizzling.h&quot;</div><div class="line">@implementation UILabel (Swizzling)</div><div class="line"></div><div class="line">+ (void)load &#123;</div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">[self methodSwizzlingWithOriginalSelector:@selector(init) bySwizzledSelector:@selector(sure_Init)];</div><div class="line">[self methodSwizzlingWithOriginalSelector:@selector(initWithFrame:) bySwizzledSelector:@selector(sure_InitWithFrame:)];</div><div class="line">[self methodSwizzlingWithOriginalSelector:@selector(awakeFromNib) bySwizzledSelector:@selector(sure_AwakeFromNib)];</div><div class="line">&#125;);</div><div class="line">&#125;</div><div class="line">- (instancetype)sure_Init&#123;</div><div class="line">id __self = [self sure_Init];</div><div class="line">UIFont * font = [UIFont fontWithName:@&quot;Zapfino&quot; size:self.font.pointSize];</div><div class="line">if (font) &#123;</div><div class="line">self.font=font;</div><div class="line">&#125;</div><div class="line">return __self;</div><div class="line">&#125;</div><div class="line">- (instancetype)sure_InitWithFrame:(CGRect)rect&#123;</div><div class="line">id __self = [self sure_InitWithFrame:rect];</div><div class="line">UIFont * font = [UIFont fontWithName:@&quot;Zapfino&quot; size:self.font.pointSize];</div><div class="line">if (font) &#123;</div><div class="line">self.font=font;</div><div class="line">&#125;</div><div class="line">return __self;</div><div class="line">&#125;</div><div class="line">- (void)sure_AwakeFromNib&#123;</div><div class="line">[self sure_AwakeFromNib];</div><div class="line">UIFont * font = [UIFont fontWithName:@&quot;Zapfino&quot; size:self.font.pointSize];</div><div class="line">if (font) &#123;</div><div class="line">self.font=font;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>这一实例个人认为使用率可能不高，对于产品的设计这些点都是已经确定好的，更改的几率很低。况且我们也可以使用appearance来进行统一设置。</p>
<h3 id="实例六：App异常加载占位图通用类封装（更新于：2016-12-01）"><a href="#实例六：App异常加载占位图通用类封装（更新于：2016-12-01）" class="headerlink" title="实例六：App异常加载占位图通用类封装（更新于：2016/12/01）"></a>实例六：App异常加载占位图通用类封装（更新于：2016/12/01）</h3><p>详情可见文章:<a href="https://www.jianshu.com/p/7fda2d9e9d48" target="_blank" rel="external">《零行代码为App添加异常加载占位图》</a></p>
<p>在该功能模块中，使用Runtime Method Swizzling进行替换tableView、collectionView的reloadData方法，使得每当执行刷新操作时，自动检测当前组数与行数，从而实现零代码判断占位图是否显示的功能，同样也适用于网络异常等情况，详细设置可前往阅读。</p>
<h3 id="实例七：全局修改导航栏后退（返回）按钮（更新于：2016-12-05）"><a href="#实例七：全局修改导航栏后退（返回）按钮（更新于：2016-12-05）" class="headerlink" title="实例七：全局修改导航栏后退（返回）按钮（更新于：2016/12/05）"></a>实例七：全局修改导航栏后退（返回）按钮（更新于：2016/12/05）</h3><p>在真实项目开发中，会全局统一某控件样式，以导航栏后退（返回）按钮为例，通常项目中会固定为返回字样，或者以图片进行显示等。</p>
<p>iOS默认的返回按钮样式如下，默认为蓝色左箭头，文字为上一界面标题文字。<br><img src="https://user-gold-cdn.xitu.io/2017/12/19/1606df6e8204c1cc?w=700&amp;h=174&amp;f=png&amp;s=13444" alt="image.png"><br>这里我们仍可以通过Runtime Method Swizzling来实现该需求，在使用Method Swizzling进行更改之前，必须考虑注意事项，即尽可能的不影响原有操作，比如对于系统默认的返回按钮，与其对应的是有界面边缘右滑返回功能的，因此我们进行统一更改后不可使其功能废弃。</p>
<p>闲话少说，我们创建基于UINavigationItem的类别，在其load方法中替换方法backBarButtonItem<br>代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">#import &quot;UINavigationItem+Swizzling.h&quot;</div><div class="line">#import &quot;NSObject+Swizzling.h&quot;</div><div class="line">static char *kCustomBackButtonKey;</div><div class="line">@implementation UINavigationItem (Swizzling)</div><div class="line">+ (void)load &#123;</div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">[self methodSwizzlingWithOriginalSelector:@selector(backBarButtonItem)</div><div class="line">bySwizzledSelector:@selector(sure_backBarButtonItem)];</div><div class="line"></div><div class="line">&#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (UIBarButtonItem*)sure_backBarButtonItem &#123;</div><div class="line">UIBarButtonItem *backItem = [self sure_backBarButtonItem];</div><div class="line">if (backItem) &#123;</div><div class="line">return backItem;</div><div class="line">&#125;</div><div class="line">backItem = objc_getAssociatedObject(self, &amp;kCustomBackButtonKey);</div><div class="line">if (!backItem) &#123;</div><div class="line">backItem = [[UIBarButtonItem alloc] initWithTitle:@&quot;&quot; style:UIBarButtonItemStylePlain target:nil action:NULL];</div><div class="line">objc_setAssociatedObject(self, &amp;kCustomBackButtonKey, backItem, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line">return backItem;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>这里进行将返回按钮的文字清空操作，其他需求样式大家也可随意替换，现在再次运行程序，就会发现所有的返回按钮均只剩左箭头，并右滑手势依然有效。如图所示<br><img src="https://user-gold-cdn.xitu.io/2017/12/19/1606df6e92299322?w=700&amp;h=192&amp;f=png&amp;s=13302" alt="image.png"></p>
<p><a href="http://blog.csdn.net/deft_mkjing/article/details/53789125" target="_blank" rel="external">Runtime基本知识点以及应用场景 deft_mkjing</a></p>
<p>交换方法实现的需求场景：自己创建了一个功能性的方法，在项目中多次被引用，当项目的需求发生改变时，要使用另一种功能代替这个功能，要求是不改变旧的项目(也就是不改变原来方法的实现)。<br>可以在类的分类中，再写一个新的方法(是符合新的需求的),然后交换两个方法的实现。这样，在不改变项目的代码，而只是增加了新的代码 的情况下，就完成了项目的改进。<br>交换两个方法的实现一般写在类的load方法里面，因为load方法会在程序运行前加载一次，而initialize方法会在类或者子类在 第一次使用的时候调用，当有分类的时候会调用多次<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">// Load的时候如果下面的方法是-方法，那么是无效的，类方法对实例方法无法操作</div><div class="line">+ (void)load</div><div class="line">&#123;</div><div class="line">Method eatM = class_getClassMethod(self, sel_registerName(&quot;eat:&quot;));</div><div class="line"></div><div class="line">Method sleepM = class_getClassMethod(self, @selector(sleep:));</div><div class="line"></div><div class="line">method_exchangeImplementations(eatM, sleepM);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 如果要在自己的方法里面调用另个一个方法，直接调用自己的方法名就好了</div><div class="line">+ (void)eat:(NSString *)food</div><div class="line">&#123;</div><div class="line"></div><div class="line">NSLog(@&quot;%@大口吃%@&quot;,NSStringFromClass([self class]),food);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 如果这样调用直接死循环了</div><div class="line">+ (void)sleep:(NSString *)name</div><div class="line">&#123;</div><div class="line">//    [self eat:@&quot;屎&quot;]; 死循环</div><div class="line"></div><div class="line">NSLog(@&quot;%@睡了%@&quot;,NSStringFromClass([self class]),name);</div><div class="line"></div><div class="line">[self sleep:@&quot;屎&quot;];</div><div class="line">&#125;</div><div class="line">objc_msgSend(objc_getClass(&quot;Dog&quot;), sel_registerName(&quot;eat:&quot;),@&quot;aaa&quot;);</div><div class="line"></div><div class="line">// 打印如下</div><div class="line">// 2016-12-19 17:25:15.699 RuntimeKJ[12219:363270] Dog睡了aaa</div><div class="line">// 2016-12-19 17:25:15.700 RuntimeKJ[12219:363270] Dog大口吃屎</div><div class="line"></div><div class="line">// 先是调用eat的方法，但是由于方法的调换，先调用了sleep方法，在sleep方法里面继续调用sleep，实际上调用的是eat方法，这样就完成的方法调换</div></pre></td></tr></table></figure></p>
<h2 id="二-给分类添加属性"><a href="#二-给分类添加属性" class="headerlink" title="二. 给分类添加属性"></a>二. 给分类添加属性</h2><p>涉及到的方法:<br><code>objc_getAssociatedObject</code> <code>objc_setAssociatedObject</code></p>
<p><a href="http://www.jianshu.com/p/e071206103a4" target="_blank" rel="external">让你快速上手Runtime 袁峥</a><br>原理：给一个类声明属性，其实本质就是给这个类添加关联，并不是直接把这个值的内存空间添加到类存空间。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">[super viewDidLoad];</div><div class="line">// Do any additional setup after loading the view, typically from a nib.</div><div class="line"></div><div class="line">// 给系统NSObject类动态添加属性name</div><div class="line"></div><div class="line">NSObject *objc = [[NSObject alloc] init];</div><div class="line">objc.name = @&quot;YoonAngel&quot;;</div><div class="line">NSLog(@&quot;%@&quot;,objc.name);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line">// 定义关联的key</div><div class="line">static const char *key = &quot;name&quot;;</div><div class="line"></div><div class="line">@implementation NSObject (Property)</div><div class="line"></div><div class="line">- (NSString *)name</div><div class="line">&#123;</div><div class="line">// 根据关联的key，获取关联的值。</div><div class="line">return objc_getAssociatedObject(self, key);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setName:(NSString *)name</div><div class="line">&#123;</div><div class="line">// 第一个参数：给哪个对象添加关联</div><div class="line">// 第二个参数：关联的key，通过这个key获取</div><div class="line">// 第三个参数：关联的value</div><div class="line">// 第四个参数:关联的策略</div><div class="line">objc_setAssociatedObject(self, key, name, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p><a href="http://www.jianshu.com/p/d6a2656fc2cb" target="_blank" rel="external">iOS-Runtime-实践篇  Jerry4me</a></p>
<p>在分类只能对原类扩充方法, 并不能扩充属性, 你可以创建一个分类, 然后在分类中敲几个@property, 然后用第二节的方法打印下原类的property看看存不存在? 答案显然是不存在这个属性.</p>
<p>那么我们可以使用runtime中的一个叫关联对象的办法, 给分类添加一个property, 并且打印原类的property列表是真真切切存在的. 上代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">// Person+RunningMan.h</div><div class="line">@interface Person (RunningMan)</div><div class="line"></div><div class="line">/** 速度(km/h) */</div><div class="line">@property (nonatomic, assign) CGFloat speed;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">// Person+RunningMan.m</div><div class="line">#import &lt;objc/objc-runtime.h&gt;</div><div class="line"></div><div class="line">@implementation Person (RunningMan)</div><div class="line"></div><div class="line">- (CGFloat)speed</div><div class="line">&#123;</div><div class="line">id value = objc_getAssociatedObject(self, _cmd);</div><div class="line">return [value doubleValue];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setSpeed:(CGFloat)speed</div><div class="line">&#123;</div><div class="line">objc_setAssociatedObject(self, @selector(speed), @(speed), OBJC_ASSOCIATION_ASSIGN);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>好的, 我们看看加了这个分类之后再利用第二节的办法打印下瞧瞧~</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">2016-09-04 17:26:00.403 Runtime-实践篇[13795:1050331] ivarName:_name, ivarValue:Kobe</div><div class="line">2016-09-04 17:26:00.404 Runtime-实践篇[13795:1050331] ivarName:_age, ivarValue:18</div><div class="line">2016-09-04 17:26:00.405 Runtime-实践篇[13795:1050331] ivarName:_weight, ivarValue:110</div><div class="line">2016-09-04 17:26:00.405 Runtime-实践篇[13795:1050331] ivarName:_address, ivarValue:值为nil</div><div class="line">2016-09-04 17:26:00.405 Runtime-实践篇[13795:1050331] propertyName:speed, propertyValue:0</div><div class="line">2016-09-04 17:26:00.405 Runtime-实践篇[13795:1050331] propertyName:address, propertyValue:值为nil</div><div class="line">2016-09-04 17:26:00.405 Runtime-实践篇[13795:1050331] propertyName:weight, propertyValue:110</div><div class="line">2016-09-04 17:26:00.405 Runtime-实践篇[13795:1050331] methodName:speed, argumentsCount:0</div><div class="line">2016-09-04 17:26:00.406 Runtime-实践篇[13795:1050331] methodName:setWeight:, argumentsCount:1</div><div class="line">2016-09-04 17:26:00.406 Runtime-实践篇[13795:1050331] methodName:setSpeed:, argumentsCount:1</div><div class="line">2016-09-04 17:26:00.406 Runtime-实践篇[13795:1050331] methodName:weight, argumentsCount:0</div><div class="line">2016-09-04 17:26:00.446 Runtime-实践篇[13795:1050331] methodName:setAddress:, argumentsCount:1</div><div class="line">2016-09-04 17:26:00.447 Runtime-实践篇[13795:1050331] methodName:address, argumentsCount:0</div><div class="line">2016-09-04 17:26:00.447 Runtime-实践篇[13795:1050331] methodName:.cxx_destruct, argumentsCount:0</div></pre></td></tr></table></figure>
<p>看到了嘛? speed这个属性乖乖的在那儿呢.</p>
<p>其实关联对象这个技术就是用哈希表实现的, 将一个类映射到一张哈希表上, 然后根据key找到关联对象, 所以严格说, 关联对象跟本类没有任何联系, 它不是储存在类的内部的. 它的底层原理就不多介绍了, 不属于本文的范畴, 大家感兴趣的可以到以下两篇文章里面看看</p>
<p><a href="https://link.jianshu.com?t=http://nshipster.com/associated-objects/" target="_blank" rel="external">Associated Objects</a></p>
<p><a href="https://link.jianshu.com?t=http://blog.leichunfeng.com/blog/2015/06/26/objective-c-associated-objects-implementation-principle/" target="_blank" rel="external">Objective-C Associated Objects 的实现原理</a></p>
<p><a href="http://www.jianshu.com/p/3e050ec3b759" target="_blank" rel="external">Objective-C中的Runtime LeeJay</a><br>类别不可以添加属性，我们可以在类别中设置关联，举个栗子：<br>Person+Category.h 文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#import &quot;Person.h&quot;</div><div class="line">@interface Person (Category)</div><div class="line">@property (nonatomic, copy) NSString *name;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>Person+Category.m 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">#import &quot;Person+Category.h&quot;</div><div class="line">#import &lt;objc/runtime.h&gt;</div><div class="line"></div><div class="line">@implementation Person (Category)</div><div class="line"></div><div class="line">static char *key;</div><div class="line"></div><div class="line">- (void)setName:(NSString *)name</div><div class="line">&#123;</div><div class="line">objc_setAssociatedObject(self,</div><div class="line">key,</div><div class="line">name,</div><div class="line">OBJC_ASSOCIATION_COPY_NONATOMIC);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString *)name</div><div class="line">&#123;</div><div class="line">return objc_getAssociatedObject(self, key);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>当然你也可以这么写</p>
<p>Person+Category.m 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#import &quot;Person+Category.h&quot;</div><div class="line">#import &lt;objc/runtime.h&gt;</div><div class="line"></div><div class="line">@implementation Person (Category)</div><div class="line"></div><div class="line">- (void)setName:(NSString *)name</div><div class="line">&#123;</div><div class="line">objc_setAssociatedObject(self,</div><div class="line">@selector(name),</div><div class="line">name,</div><div class="line">OBJC_ASSOCIATION_COPY_NONATOMIC);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString *)name</div><div class="line">&#123;</div><div class="line">return objc_getAssociatedObject(self, _cmd);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<blockquote>
<p><code>objc_setAssociatedObject</code>和<code>objc_getAssociatedObject</code>传入的参数key：要求是唯一并且是常量，可以使用static char，然而一个更简单方便的方法就是：使用选择子。由于选择子是唯一并且是常量，你可以使用选择子作为关联的key。（PS：_cmd表示当前调用的方法，它就是一个方法选择器SEL，类似self表示当前对象）</p>
</blockquote>
<p><a href="http://www.jianshu.com/p/7bb5777e0271" target="_blank" rel="external">Objecive-C runtime实践－给Category添加属性</a><br>在开发中经常遇到需要添加hud的情形，每次添加的代码都在10行左右，遂新建一个ViewController的Category来添加hud。由于分类不能直接添加属性，就考虑到了runtime。<br>下面讲具体的实施步骤<br>新建工程－－新建文件，选择Objective-C File 如下图：<br><img src="https://user-gold-cdn.xitu.io/2017/12/19/1606e176be54419d?w=700&amp;h=268&amp;f=png&amp;s=17980" alt=""><br>导入MBProgressHUD, 现在项目结构如图：<br><img src="https://user-gold-cdn.xitu.io/2017/12/19/1606e17e4e5b16af?w=510&amp;h=808&amp;f=png&amp;s=146685" alt=""><br>在UIViewController+HUD.h中导入MBProgressHUD.h，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line">#import &quot;MBProgressHUD.h&quot;</div><div class="line">@interface UIViewController (HUD)</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>在UIViewController+HUD.m中导入runtime.h，并添加hud属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#import &quot;UIViewController+HUD.h&quot;</div><div class="line">#import &lt;objc/runtime.h&gt;</div><div class="line"></div><div class="line">@interface UIViewController(Private)</div><div class="line"></div><div class="line">@property (nonatomic, strong) MBProgressHUD *progressHud;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation UIViewController (HUD)</div><div class="line">const char *kHudKey = &quot;ProgressHUD_Key&quot;;</div><div class="line"></div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>接下来是关键的一步－设置hud的setter与getter方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (void)setProgressHud:(MBProgressHUD *)progressHud</div><div class="line">&#123;</div><div class="line">objc_setAssociatedObject(self, kHudKey, progressHud, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (MBProgressHUD *)progressHud</div><div class="line">&#123;</div><div class="line">MBProgressHUD *hud = objc_getAssociatedObject(self, kHudKey);</div><div class="line">if (!hud) &#123;</div><div class="line">UIView *view = self.navigationController.view;</div><div class="line">hud = [[MBProgressHUD alloc] initWithView:view];</div><div class="line">hud.removeFromSuperViewOnHide = YES;</div><div class="line">[view addSubview:hud];</div><div class="line">self.progressHud = hud;</div><div class="line">&#125;</div><div class="line">return hud;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在setter中设置连接， 在getter中初始化。<br>好了，接下来就可以正常使用属性了，现在，我们对hud进行扩展。<br>写两个基本的show、hide方法，其余的实现在其基础上变化即可：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">#pragma mark - Private</div><div class="line">- (void)showHudWithMessage:(NSString *)message model:(MBProgressHUDMode)mode</div><div class="line">&#123;</div><div class="line">if (self.progressHud.taskInProgress) &#123;</div><div class="line">return;</div><div class="line">&#125;</div><div class="line"></div><div class="line">self.progressHud.taskInProgress = YES;</div><div class="line">self.progressHud.mode = mode ?: MBProgressHUDModeIndeterminate;</div><div class="line">self.progressHud.labelText = message;</div><div class="line">self.progressHud.labelFont = [UIFont systemFontOfSize:15];</div><div class="line">[self.progressHud show:YES];</div><div class="line">[self.progressHud hide:YES afterDelay:15];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)hideHudWithMessage:(NSString *)message image:(UIImage *)image</div><div class="line">&#123;</div><div class="line">self.progressHud.customView = [[UIImageView alloc] initWithImage:image];</div><div class="line">self.progressHud.mode = MBProgressHUDModeCustomView;</div><div class="line">self.progressHud.labelText = message;</div><div class="line">self.progressHud.labelFont = [UIFont systemFontOfSize:15];</div><div class="line"></div><div class="line">[self.progressHud show:YES];</div><div class="line">[self performSelector:@selector(hideHud) withObject:nil afterDelay:0.7];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>再实现下面的方法大概就够用了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (void)showHud;</div><div class="line"></div><div class="line">- (void)showHudWithMessage:(NSString *)message;</div><div class="line"></div><div class="line">- (void)showDeterminateHudWithMessage:(NSString *)message;</div><div class="line"></div><div class="line">- (void)changeHudProgress:(double)precent;</div><div class="line"></div><div class="line">- (void)hideHud;</div><div class="line"></div><div class="line">- (void)hideHudWithSuccessMessage:(NSString *)message;</div><div class="line"></div><div class="line">- (void)hideHudWithErrorMessage:(NSString *)message;</div></pre></td></tr></table></figure></p>
<p>具体的实现直接看代码吧！<br><a href="https://github.com/Xigtun/RuntimeDemo" target="_blank" rel="external">https://github.com/Xigtun/RuntimeDemo</a></p>
<h3 id="防止按钮重复暴力点击"><a href="#防止按钮重复暴力点击" class="headerlink" title="防止按钮重复暴力点击"></a>防止按钮重复暴力点击</h3><p>同上</p>
<h3 id="按钮防止被重复点击的方法-iOS"><a href="#按钮防止被重复点击的方法-iOS" class="headerlink" title="按钮防止被重复点击的方法 (iOS)"></a>按钮防止被重复点击的方法 (iOS)</h3><p><a href="http://www.code4app.com/blog-865069-1478.html" target="_blank" rel="external">按钮防止被重复点击的方法 (iOS)</a></p>
<p>避免一个button被多次点击（共总结了3种）<br>第一种：每次在点击时先取消之前的操作<br>将这段代码放在你按钮点击的方法中，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (void)buttonClicked:(id)sender&#123;</div><div class="line">//点击按钮后先取消之前的操作，再进行需要进行的操作</div><div class="line">[[selfclass]cancelPreviousPerformRequestsWithTarget:selfselector:@selector(buttonClicked:)object:sender];</div><div class="line">[selfperformSelector:@selector(buttonClicked: )withObject:senderafterDelay:0.2f];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>第二种：点击后设为不可被点击的状态，几秒后恢复:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-(void)buttonClicked:(id)sender&#123;</div><div class="line">self.button.enabled =NO;</div><div class="line">[selfperformSelector:@selector(changeButtonStatus)withObject:nilafterDelay:1.0f];//防止重复点击</div><div class="line">&#125;</div><div class="line">-(void)changeButtonStatus&#123;</div><div class="line">self.button.enabled =YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>第三种：使用runtime，一劳永逸我这设的是0.5秒内不会被重复点击<br>1.导入objc / runtime.h（可以放在PCH文件里）</p>
<p>2.创建uicontrol或UIButton的的分类！</p>
<p>创建分类文件：</p>
<p>2.1 打开Xcode中，新建文件，选择OC文件</p>
<p>2.2 在第二个界面，File名为UIControl+UIControl_buttonCon，将文件类型File Type选为Category类，在类里选继承的类别，这里咱们选的Class是UIButton</p>
<p>注：若用Unbutton分类，则会对对Unbutton创建的按钮反应。</p>
<p>2.3 分类创建完毕对分类进行操作<br>.h文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#import</div><div class="line">#define defaultInterval.5//默认时间间隔</div><div class="line">@interfaceUIControl (UIControl_buttonCon)</div><div class="line">@property(nonatomic,assign)NSTimeIntervaltimeInterval;//用这个给重复点击加间隔</div><div class="line">@property(nonatomic,assign)BOOLisIgnoreEvent;//YES不允许点击NO允许点击</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>.m文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">#import&quot;UIControl+UIControl_buttonCon.h&quot;</div><div class="line">@implementationUIControl (UIControl_buttonCon)</div><div class="line">- (NSTimeInterval)timeInterval&#123;</div><div class="line">return[objc_getAssociatedObject(self,_cmd)doubleValue];</div><div class="line">&#125;</div><div class="line">- (void)setTimeInterval:(NSTimeInterval)timeInterval&#123;</div><div class="line">objc_setAssociatedObject(self,@selector(timeInterval),@(timeInterval),OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line">//runtime动态绑定属性</div><div class="line">- (void)setIsIgnoreEvent:(BOOL)isIgnoreEvent&#123;</div><div class="line">objc_setAssociatedObject(self,@selector(isIgnoreEvent),@(isIgnoreEvent),OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line">- (BOOL)isIgnoreEvent&#123;</div><div class="line">return[objc_getAssociatedObject(self,_cmd)boolValue];</div><div class="line">&#125;</div><div class="line">- (void)resetState&#123;</div><div class="line">[selfsetIsIgnoreEvent:NO];</div><div class="line">&#125;</div><div class="line">+ (void)load&#123;</div><div class="line">staticdispatch_once_tonceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">SELselA =@selector(sendAction:to:forEvent:);</div><div class="line">SELselB =@selector(mySendAction:to:forEvent:);</div><div class="line">MethodmethodA =class_getInstanceMethod(self, selA);</div><div class="line">MethodmethodB =class_getInstanceMethod(self, selB);</div><div class="line">//将methodB的实现添加到系统方法中也就是说将methodA方法指针添加成方法methodB的返回值表示是否添加成功</div><div class="line">BOOLisAdd =class_addMethod(self, selA,method_getImplementation(methodB),method_getTypeEncoding(methodB));</div><div class="line">//添加成功了说明本类中不存在methodB所以此时必须将方法b的实现指针换成方法A的，否则b方法将没有实现。</div><div class="line">if(isAdd) &#123;</div><div class="line">class_replaceMethod(self, selB,method_getImplementation(methodA),method_getTypeEncoding(methodA));</div><div class="line">&#125;else&#123;</div><div class="line">//添加失败了说明本类中有methodB的实现，此时只需要将methodA和methodB的IMP互换一下即可。</div><div class="line">method_exchangeImplementations(methodA, methodB);</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">&#125;</div><div class="line">- (void)mySendAction:(SEL)action to:(id)target forEvent:(UIEvent*)event&#123;</div><div class="line">if([NSStringFromClass(self.class)isEqualToString:@&quot;UIButton&quot;]) &#123;</div><div class="line">self.timeInterval=self.timeInterval==0?defaultInterval:self.timeInterval;</div><div class="line">if(self.isIgnoreEvent)&#123;</div><div class="line">return;</div><div class="line">&#125;elseif(self.timeInterval&gt;0)&#123;</div><div class="line">[selfperformSelector:@selector(resetState)withObject:nilafterDelay:self.timeInterval];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">//此处methodA和methodB方法IMP互换了，实际上执行sendAction；所以不会死循环</div><div class="line">self.isIgnoreEvent=YES;</div><div class="line">[selfmySendAction:actionto:targetforEvent:event];</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<h2 id="三-字典转模型"><a href="#三-字典转模型" class="headerlink" title="三. 字典转模型"></a>三. 字典转模型</h2><p>涉及到的方法:<br><code>class_copyIvarList</code> <code>ivar_getName</code> <code>ivar_getTypeEncoding</code></p>
<p><a href="http://www.jianshu.com/p/e071206103a4" target="_blank" rel="external">让你快速上手Runtime 袁峥</a></p>
<p>模型属性，通常需要跟字典中的key一一对应,提供一个分类，专门根据字典生成对应的属性字符串。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">@implementation NSObject (Log)</div><div class="line"></div><div class="line"></div><div class="line">// 自动打印属性字符串</div><div class="line">+ (void)resolveDict:(NSDictionary *)dict&#123;</div><div class="line"></div><div class="line">// 拼接属性字符串代码</div><div class="line">NSMutableString *strM = [NSMutableString string];</div><div class="line"></div><div class="line">// 1.遍历字典，把字典中的所有key取出来，生成对应的属性代码</div><div class="line">[dict enumerateKeysAndObjectsUsingBlock:^(id  _Nonnull key, id  _Nonnull obj, BOOL * _Nonnull stop) &#123;</div><div class="line"></div><div class="line">// 类型经常变，抽出来</div><div class="line">NSString *type;</div><div class="line"></div><div class="line">if ([obj isKindOfClass:NSClassFromString(@&quot;__NSCFString&quot;)]) &#123;</div><div class="line">type = @&quot;NSString&quot;;</div><div class="line">&#125;else if ([obj isKindOfClass:NSClassFromString(@&quot;__NSCFArray&quot;)])&#123;</div><div class="line">type = @&quot;NSArray&quot;;</div><div class="line">&#125;else if ([obj isKindOfClass:NSClassFromString(@&quot;__NSCFNumber&quot;)])&#123;</div><div class="line">type = @&quot;int&quot;;</div><div class="line">&#125;else if ([obj isKindOfClass:NSClassFromString(@&quot;__NSCFDictionary&quot;)])&#123;</div><div class="line">type = @&quot;NSDictionary&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">// 属性字符串</div><div class="line">NSString *str;</div><div class="line">if ([type containsString:@&quot;NS&quot;]) &#123;</div><div class="line">str = [NSString stringWithFormat:@&quot;@property (nonatomic, strong) %@ *%@;&quot;,type,key];</div><div class="line">&#125;else&#123;</div><div class="line">str = [NSString stringWithFormat:@&quot;@property (nonatomic, assign) %@ %@;&quot;,type,key];</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 每生成属性字符串，就自动换行。</div><div class="line">[strM appendFormat:@&quot;\n%@\n&quot;,str];</div><div class="line"></div><div class="line">&#125;];</div><div class="line"></div><div class="line">// 把拼接好的字符串打印出来，就好了。</div><div class="line">NSLog(@&quot;%@&quot;,strM);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<ul>
<li><p>字典转模型的方式一：KVC</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- @implementation Status</div><div class="line"></div><div class="line"></div><div class="line">+ (instancetype)statusWithDict:(NSDictionary *)dict</div><div class="line">&#123;</div><div class="line">Status *status = [[self alloc] init];</div><div class="line"></div><div class="line">[status setValuesForKeysWithDictionary:dict];</div><div class="line"></div><div class="line">return status;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
</li>
<li><p><code>KVC字典转模型弊端</code>：必须保证，模型中的属性和字典中的key一一对应。</p>
</li>
<li>如果不一致，就会调用<code>[&lt;Status 0x7fa74b545d60&gt; setValue:forUndefinedKey:]</code><br>报key找不到的错。</li>
<li>分析:模型中的属性和字典的key不一一对应，系统就会调用<code>setValue:forUndefinedKey:</code>报错。</li>
<li><p>解决:重写对象的<code>setValue:forUndefinedKey:</code>,把系统的方法覆盖，<br>就能继续使用KVC，字典转模型了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)setValue:(id)value forUndefinedKey:(NSString *)key</div><div class="line">&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>字典转模型的方式二：Runtime</p>
</li>
<li><p>思路：利用运行时，遍历模型中所有属性，根据模型的属性名，去字典中查找key，取出对应的值，给模型的属性赋值。</p>
</li>
<li>步骤：提供一个NSObject分类，专门字典转模型，以后所有模型都可以通过这个分类转。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div></pre></td><td class="code"><pre><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">[super viewDidLoad];</div><div class="line">// Do any additional setup after loading the view, typically from a nib.</div><div class="line"></div><div class="line">// 解析Plist文件</div><div class="line">NSString *filePath = [[NSBundle mainBundle] pathForResource:@&quot;status.plist&quot; ofType:nil];</div><div class="line"></div><div class="line">NSDictionary *statusDict = [NSDictionary dictionaryWithContentsOfFile:filePath];</div><div class="line"></div><div class="line">// 获取字典数组</div><div class="line">NSArray *dictArr = statusDict[@&quot;statuses&quot;];</div><div class="line"></div><div class="line">// 自动生成模型的属性字符串</div><div class="line">//    [NSObject resolveDict:dictArr[0][@&quot;user&quot;]];</div><div class="line"></div><div class="line"></div><div class="line">_statuses = [NSMutableArray array];</div><div class="line"></div><div class="line">// 遍历字典数组</div><div class="line">for (NSDictionary *dict in dictArr) &#123;</div><div class="line"></div><div class="line">Status *status = [Status modelWithDict:dict];</div><div class="line"></div><div class="line">[_statuses addObject:status];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">// 测试数据</div><div class="line">NSLog(@&quot;%@ %@&quot;,_statuses,[_statuses[0] user]);</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation NSObject (Model)</div><div class="line"></div><div class="line">+ (instancetype)modelWithDict:(NSDictionary *)dict</div><div class="line">&#123;</div><div class="line">// 思路：遍历模型中所有属性-》使用运行时</div><div class="line"></div><div class="line">// 0.创建对应的对象</div><div class="line">id objc = [[self alloc] init];</div><div class="line"></div><div class="line">// 1.利用runtime给对象中的成员属性赋值</div><div class="line"></div><div class="line">// class_copyIvarList:获取类中的所有成员属性</div><div class="line">// Ivar：成员属性的意思</div><div class="line">// 第一个参数：表示获取哪个类中的成员属性</div><div class="line">// 第二个参数：表示这个类有多少成员属性，传入一个Int变量地址，会自动给这个变量赋值</div><div class="line">// 返回值Ivar *：指的是一个ivar数组，会把所有成员属性放在一个数组中，通过返回的数组就能全部获取到。</div><div class="line">/* 类似下面这种写法</div><div class="line"></div><div class="line">Ivar ivar;</div><div class="line">Ivar ivar1;</div><div class="line">Ivar ivar2;</div><div class="line">// 定义一个ivar的数组a</div><div class="line">Ivar a[] = &#123;ivar,ivar1,ivar2&#125;;</div><div class="line"></div><div class="line">// 用一个Ivar *指针指向数组第一个元素</div><div class="line">Ivar *ivarList = a;</div><div class="line"></div><div class="line">// 根据指针访问数组第一个元素</div><div class="line">ivarList[0];</div><div class="line"></div><div class="line">*/</div><div class="line">unsigned int count;</div><div class="line"></div><div class="line">// 获取类中的所有成员属性</div><div class="line">Ivar *ivarList = class_copyIvarList(self, &amp;count);</div><div class="line"></div><div class="line">for (int i = 0; i &lt; count; i++) &#123;</div><div class="line">// 根据角标，从数组取出对应的成员属性</div><div class="line">Ivar ivar = ivarList[i];</div><div class="line"></div><div class="line">// 获取成员属性名</div><div class="line">NSString *name = [NSString stringWithUTF8String:ivar_getName(ivar)];</div><div class="line"></div><div class="line">// 处理成员属性名-&gt;字典中的key</div><div class="line">// 从第一个角标开始截取</div><div class="line">NSString *key = [name substringFromIndex:1];</div><div class="line"></div><div class="line">// 根据成员属性名去字典中查找对应的value</div><div class="line">id value = dict[key];</div><div class="line"></div><div class="line">// 二级转换:如果字典中还有字典，也需要把对应的字典转换成模型</div><div class="line">// 判断下value是否是字典</div><div class="line">if ([value isKindOfClass:[NSDictionary class]]) &#123;</div><div class="line">// 字典转模型</div><div class="line">// 获取模型的类对象，调用modelWithDict</div><div class="line">// 模型的类名已知，就是成员属性的类型</div><div class="line"></div><div class="line">// 获取成员属性类型</div><div class="line">NSString *type = [NSString stringWithUTF8String:ivar_getTypeEncoding(ivar)];</div><div class="line">// 生成的是这种@&quot;@\&quot;User\&quot;&quot; 类型 -》 @&quot;User&quot;  在OC字符串中 \&quot; -&gt; &quot;，\是转义的意思，不占用字符</div><div class="line">// 裁剪类型字符串</div><div class="line">NSRange range = [type rangeOfString:@&quot;\&quot;&quot;];</div><div class="line"></div><div class="line">type = [type substringFromIndex:range.location + range.length];</div><div class="line"></div><div class="line">range = [type rangeOfString:@&quot;\&quot;&quot;];</div><div class="line"></div><div class="line">// 裁剪到哪个角标，不包括当前角标</div><div class="line">type = [type substringToIndex:range.location];</div><div class="line"></div><div class="line"></div><div class="line">// 根据字符串类名生成类对象</div><div class="line">Class modelClass = NSClassFromString(type);</div><div class="line"></div><div class="line"></div><div class="line">if (modelClass) &#123; // 有对应的模型才需要转</div><div class="line"></div><div class="line">// 把字典转模型</div><div class="line">value  =  [modelClass modelWithDict:value];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">// 三级转换：NSArray中也是字典，把数组中的字典转换成模型.</div><div class="line">// 判断值是否是数组</div><div class="line">if ([value isKindOfClass:[NSArray class]]) &#123;</div><div class="line">// 判断对应类有没有实现字典数组转模型数组的协议</div><div class="line">if ([self respondsToSelector:@selector(arrayContainModelClass)]) &#123;</div><div class="line"></div><div class="line">// 转换成id类型，就能调用任何对象的方法</div><div class="line">id idSelf = self;</div><div class="line"></div><div class="line">// 获取数组中字典对应的模型</div><div class="line">NSString *type =  [idSelf arrayContainModelClass][key];</div><div class="line"></div><div class="line">// 生成模型</div><div class="line">Class classModel = NSClassFromString(type);</div><div class="line">NSMutableArray *arrM = [NSMutableArray array];</div><div class="line">// 遍历字典数组，生成模型数组</div><div class="line">for (NSDictionary *dict in value) &#123;</div><div class="line">// 字典转模型</div><div class="line">id model =  [classModel modelWithDict:dict];</div><div class="line">[arrM addObject:model];</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 把模型数组赋值给value</div><div class="line">value = arrM;</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">if (value) &#123; // 有值，才需要给模型的属性赋值</div><div class="line">// 利用KVC给模型中的属性赋值</div><div class="line">[objc setValue:value forKey:key];</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">return objc;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p><a href="http://www.jianshu.com/p/3e050ec3b759" target="_blank" rel="external">Objective-C中的Runtime LeeJay</a></p>
<p>字典转模型<br>利用Runtime，遍历模型中所有成员变量，根据模型的属性名，去字典中查找key，取出对应的value，给模型的属性赋值，实现的思路主要借鉴MJExtension。</p>
<p>NSObject+Property.h文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@protocol KeyValue &lt;NSObject&gt;</div><div class="line"></div><div class="line">@optional</div><div class="line">/**</div><div class="line">*  数组中需要转换的模型类</div><div class="line">*</div><div class="line">*  @return 字典中的key是数组属性名，value是数组中存放模型的Class（Class类型或者NSString类型）</div><div class="line">*/</div><div class="line">+ (NSDictionary *)objectClassInArray;</div><div class="line"></div><div class="line">/**</div><div class="line">*  将属性名换为其他key去字典中取值</div><div class="line">*</div><div class="line">*  @return 字典中的key是属性名，value是从字典中取值用的key</div><div class="line">*/</div><div class="line">+ (NSDictionary *)replacedKeyFromPropertyName;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@interface NSObject (Property) &lt;KeyValue&gt;</div><div class="line"></div><div class="line">+ (instancetype)objectWithDictionary:(NSDictionary *)dictionary;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>NSObject+Property.m文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line">#import &quot;NSObject+Property.h&quot;</div><div class="line">#import &lt;objc/runtime.h&gt;</div><div class="line"></div><div class="line">@implementation NSObject (Property)</div><div class="line"></div><div class="line">+ (instancetype)objectWithDictionary:(NSDictionary *)dictionary</div><div class="line">&#123;</div><div class="line">id obj = [[self alloc] init];</div><div class="line"></div><div class="line">// 获取所有的成员变量</div><div class="line">unsigned int count;</div><div class="line">Ivar *ivars = class_copyIvarList(self, &amp;count);</div><div class="line"></div><div class="line">for (unsigned int i = 0; i &lt; count; i++)</div><div class="line">&#123;</div><div class="line">Ivar ivar = ivars[i];</div><div class="line"></div><div class="line">// 取出的成员变量，去掉下划线</div><div class="line">NSString *ivarName = [NSString stringWithUTF8String:ivar_getName(ivar)];</div><div class="line">NSString *key = [ivarName substringFromIndex:1];</div><div class="line"></div><div class="line">id value = dictionary[key];</div><div class="line"></div><div class="line">// 当这个值为空时，判断一下是否执行了replacedKeyFromPropertyName协议，如果执行了替换原来的key查值</div><div class="line">if (!value)</div><div class="line">&#123;</div><div class="line">if ([self respondsToSelector:@selector(replacedKeyFromPropertyName)])</div><div class="line">&#123;</div><div class="line">NSString *replaceKey = [self replacedKeyFromPropertyName][key];</div><div class="line">value = dictionary[replaceKey];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 字典嵌套字典</div><div class="line">if ([value isKindOfClass:[NSDictionary class]])</div><div class="line">&#123;</div><div class="line">NSString *type = [NSString stringWithUTF8String:ivar_getTypeEncoding(ivar)];</div><div class="line">NSRange range = [type rangeOfString:@&quot;\&quot;&quot;];</div><div class="line">type = [type substringFromIndex:range.location + range.length];</div><div class="line">range = [type rangeOfString:@&quot;\&quot;&quot;];</div><div class="line">type = [type substringToIndex:range.location];</div><div class="line">Class modelClass = NSClassFromString(type);</div><div class="line"></div><div class="line">if (modelClass)</div><div class="line">&#123;</div><div class="line">value = [modelClass objectWithDictionary:value];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 字典嵌套数组</div><div class="line">if ([value isKindOfClass:[NSArray class]])</div><div class="line">&#123;</div><div class="line">if ([self respondsToSelector:@selector(objectClassInArray)])</div><div class="line">&#123;</div><div class="line">NSMutableArray *models = [NSMutableArray array];</div><div class="line"></div><div class="line">NSString *type = [self objectClassInArray][key];</div><div class="line">Class classModel = NSClassFromString(type);</div><div class="line">for (NSDictionary *dict in value)</div><div class="line">&#123;</div><div class="line">id model = [classModel objectWithDictionary:dict];</div><div class="line">[models addObject:model];</div><div class="line">&#125;</div><div class="line">value = models;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (value)</div><div class="line">&#123;</div><div class="line">[obj setValue:value forKey:key];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 释放ivars</div><div class="line">free(ivars);</div><div class="line"></div><div class="line">return obj;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://link.jianshu.com?t=http://nshipster.com/associated-objects/" target="_blank" rel="external">Associated Objects</a></p>
<p><a href="https://link.jianshu.com?t=http://yulingtianxia.com/blog/2014/11/05/objective-c-runtime/" target="_blank" rel="external">Objective-C Runtime</a></p>
<p><a href="https://link.jianshu.com?t=https://www.ianisme.com/ios/2019.html" target="_blank" rel="external">Objective-C Runtime 1小时入门教程</a></p>
<p><a href="https://link.jianshu.com?t=http://blog.csdn.net/yiyaaixuexi/article/details/9374411" target="_blank" rel="external">Objective-C的hook方案（一）: Method Swizzling</a></p>
<p>iOS开发进阶</p>
<p>Effective Objective-C 2.0<br>附上本文的所有demo下载链接，<a href="https://link.jianshu.com?t=https://github.com/leejayID/RuntimeDemo" target="_blank" rel="external">【GitHub】</a><br>作者：LeeJay<br>链接：<a href="http://www.jianshu.com/p/3e050ec3b759" target="_blank" rel="external">http://www.jianshu.com/p/3e050ec3b759</a></p>
<h3 id="根据字典自动生成属性代码"><a href="#根据字典自动生成属性代码" class="headerlink" title="根据字典自动生成属性代码"></a>根据字典自动生成属性代码</h3><p><a href="http://www.jianshu.com/p/2ad0ebfd5a63" target="_blank" rel="external">http://www.jianshu.com/p/2ad0ebfd5a63</a></p>
<p>日常开发中，我们拿到接口文档，会根据接口返回的数据来写模型。<br>在之前我都是根据返回的字典一个个key这样对照着来创建模型属性。后面遇到项目中有时候返回的数据里面要写成模型属性的key实在是太多，写起来花时间容易写错又没什么技术含量。<br>这时候就应该动用开发人员该有的程序思想了，干脆让它自动生成不就好了。废话不多说上代码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">- (void)createPropertyCode</div><div class="line">&#123;</div><div class="line">NSMutableString *codes = [NSMutableString string];</div><div class="line">// 遍历字典</div><div class="line">[self enumerateKeysAndObjectsUsingBlock:^(id  _Nonnull key, id  _Nonnull value, BOOL * _Nonnull stop) &#123;</div><div class="line">NSString *code;</div><div class="line">if ([value isKindOfClass:[NSString class]]) &#123;</div><div class="line">code = [NSString stringWithFormat:@&quot;@property (nonatomic, strong) NSString *%@;&quot;,key];</div><div class="line">&#125; else if ([value isKindOfClass:NSClassFromString(@&quot;__NSCFBoolean&quot;)]) &#123;</div><div class="line">code = [NSString stringWithFormat:@&quot;@property (nonatomic, assign) BOOL %@;&quot;,key];</div><div class="line">&#125; else if ([value isKindOfClass:[NSNumber class]]) &#123;</div><div class="line">code = [NSString stringWithFormat:@&quot;@property (nonatomic, assign) NSInteger %@;&quot;,key];</div><div class="line">&#125; else if ([value isKindOfClass:[NSArray class]]) &#123;</div><div class="line">code = [NSString stringWithFormat:@&quot;@property (nonatomic, strong) NSArray *%@;&quot;,key];</div><div class="line">&#125; else if ([value isKindOfClass:[NSDictionary class]]) &#123;</div><div class="line">code = [NSString stringWithFormat:@&quot;@property (nonatomic, strong) NSDictionary *%@;&quot;,key];</div><div class="line">&#125;</div><div class="line">// @property (nonatomic, strong) NSString *source;</div><div class="line">[codes appendFormat:@&quot;\n%@\n&quot;,code];</div><div class="line">&#125;];</div><div class="line">NSLog(@&quot;%@&quot;,codes);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个方法利用NSDictionary类里面的这个方法帮我们遍历字典里面所有的key和value，期间要做的事情写到block中，也就是帮我们自动生成属性代码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (void)enumerateKeysAndObjectsUsingBlock:(void (^ _Nonnull)(KeyType _Nonnull key, ObjectType _Nonnull obj, BOOL * _Nonnull stop))block</div></pre></td></tr></table></figure></p>
<p>至于怎么用，可以写成NSDictionary的一个分类。然后用字典对象直接调用就好。像这样[dict createPropertyCode]。就可以帮我们打印出属性代码，然后复制粘贴就好。在面对属性超多的模型时，是不是方便许多了。<br>当然你也可以根据需要做一些调整，这里也只是提供一个开发中的小技巧，让机器帮我们做事往往</p>
<p><a href="http://blog.csdn.net/deft_mkjing/article/details/53789125" target="_blank" rel="external">Runtime基本知识点以及应用场景</a></p>
<p>8.使用Runtime和KVC字典转模型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">+ (instancetype)configModelWithDict:(NSDictionary *)jsonDict replaceDict:(NSDictionary *)replaceDict</div><div class="line">&#123;</div><div class="line">id obj = [[self alloc] init];</div><div class="line">unsigned int count = 0;</div><div class="line">// 获取变量列表</div><div class="line">Ivar *ivarLists = class_copyIvarList(self, &amp;count);</div><div class="line">// 遍历逐个进行使用</div><div class="line">for (NSInteger i = 0; i &lt; count; i ++)</div><div class="line">&#123;</div><div class="line">// 获取变量对象</div><div class="line">Ivar ivar = ivarLists[i];</div><div class="line">const char *name = ivar_getName(ivar);</div><div class="line">const char *coding = ivar_getTypeEncoding(ivar); // 判断类型</div><div class="line">// 获取自己写的属性变量字符串 _name</div><div class="line">NSString *nameStr = [[NSString stringWithUTF8String:name] substringFromIndex:1];</div><div class="line">NSString *codingstr = [NSString stringWithUTF8String:coding];</div><div class="line">// 根据字符串在原生字典取值</div><div class="line">id value = jsonDict[nameStr];</div><div class="line">// 如果未取到值  说明字段已经修改了</div><div class="line">if (!value) &#123;</div><div class="line">if (replaceDict) &#123;</div><div class="line">// 然后把修改之前的原生字段拿出来进行取值</div><div class="line">NSString *originValue = replaceDict[nameStr];</div><div class="line">// 再赋值</div><div class="line">value = jsonDict[originValue];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">// 避免属性数量大于数据数量的时候，如果多出来的属性是对象类型的那正好是null,无影响，如果多出来的属性是普通类型的，那会把nil赋值过去，直接崩溃</div><div class="line">if ([codingstr isEqualToString:@&quot;f&quot;] || [codingstr isEqualToString:@&quot;d&quot;]) &#123;</div><div class="line">value = @(0.0);</div><div class="line">&#125;</div><div class="line">// kvc进行模型组装 这里的value类型和property里面给的属性效果是一致的，如果属性是BOOL，你强行给字符串，实际类型还是BOOL</div><div class="line">[obj setValue:value forKey:nameStr];</div><div class="line">&#125;</div><div class="line">return obj;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上面就是转换的核心代码,分析下主要功能参数<br>1.通过class_copyIvarList拿到属性列表的数组，ivar<em>getName这方法拿到属性C类型字符去掉</em>，转换成OC</p>
<p>2.这里会有个问题，如果自己建的model字段和Json返回的字段完全一致，那么就问题不大，但是由于可读性的关系，我们一般都会做一次映射，这就是replaceDict存在的意义，用例如下：<br>当你的属性名字是SubName，但是Json返回的字典key是sub_name,显然是不同的，需要映射，我们根据runtime拿到的key也是SubName，那么你根据字典取值，就会出现空值的问题，因此<br>replaceDict就用到了@{@”SubName”:@”sub_name”}，只要映射好传进去，我们里面就能进一步做判断了</p>
<p>3.直接看代码注释<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">*  1.首先属性小于数据源的时候是肯定没问题的</div><div class="line">*  2.当属性大于数据源的时候，属性是对象，打印出来就是nil，但是如果属性是基本数据类型，直接崩溃</div><div class="line">*  一定要这么判断是否是基本数据类型</div><div class="line">*  避免属性数量大于数据数量的时候，如果多出来的属性是对象类型的那正好是null,无影响，如果多出来的属性是普通类型的，那会把nil赋值过去，直接崩溃</div><div class="line">*  if ([codingstr isEqualToString:@&quot;f&quot;] || [codingstr isEqualToString:@&quot;d&quot;]) &#123;</div><div class="line">*  value = @(0.0);</div><div class="line">&#125;</div><div class="line">*/</div></pre></td></tr></table></figure></p>
<p>这里的F,D什么类型可以参考官方文档类型<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html" target="_blank" rel="external">type类型文档</a></p>
<p>理解了字段和原理，调用代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">// 1.URL</div><div class="line">NSString *githubAPI = @&quot;https://api.github.com/users/Tuccuay&quot;;</div><div class="line"></div><div class="line">// 2.创建请求对象</div><div class="line">// 对象内部已经包含了请求方法和请求头（GET）</div><div class="line">NSMutableURLRequest *request = [[NSMutableURLRequest alloc] initWithURL:[NSURL URLWithString:githubAPI]];</div><div class="line"></div><div class="line">// 3.创建session单例</div><div class="line">NSURLSession *session = [NSURLSession sharedSession];</div><div class="line"></div><div class="line">// 4.根据会话对象发送请求</div><div class="line">NSURLSessionDataTask *dataTask = [session dataTaskWithRequest:request completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) &#123;</div><div class="line"></div><div class="line">NSDictionary *jsonDict = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingAllowFragments error:nil];</div><div class="line">MKJModel *mkj = [MKJModel configModelWithDict:jsonDict replaceDict:@&#123;@&quot;mkjLogin&quot;:@&quot;login&quot;,</div><div class="line">@&quot;mkjID&quot;:@&quot;id&quot;,</div><div class="line">@&quot;mkjAvatar_url&quot;:@&quot;avatar_url&quot;,</div><div class="line">@&quot;mkjGravatar_id&quot;:@&quot;gravatar_id&quot;,</div><div class="line">@&quot;mkjUrl&quot;:@&quot;url&quot;,</div><div class="line">@&quot;mkjHtml_url&quot;:@&quot;html_url&quot;,</div><div class="line">@&quot;mkjFollowers_url&quot;:@&quot;followers_url&quot;,</div><div class="line">@&quot;mkjFollowing_url&quot;:@&quot;following_url&quot;,</div><div class="line">@&quot;mkjGists_url&quot;:@&quot;gists_url&quot;,</div><div class="line">@&quot;mkjStarred_url&quot;:@&quot;starred_url&quot;,</div><div class="line">&#125;];</div><div class="line">NSLog(@&quot;%@&quot;,mkj);</div><div class="line"></div><div class="line">&#125;];</div><div class="line"></div><div class="line">// 5.task resume</div><div class="line">[dataTask resume];</div></pre></td></tr></table></figure></p>
<h2 id="四-动态添加一个类"><a href="#四-动态添加一个类" class="headerlink" title="四. 动态添加一个类"></a>四. 动态添加一个类</h2><p>涉及方法 <code>objc_allocateClassPair</code>  <code>class_addIvar</code> <code>objc_registerClassPair</code> <code>class_getInstanceVariable</code> <code>objc_disposeClassPair</code> <code>class_addMethod</code>  <code>performSelector</code></p>
<p><a href="http://www.jianshu.com/p/d6a2656fc2cb" target="_blank" rel="external">iOS-Runtime-实践篇  Jerry4me</a></p>
<p>所有runtime代码都是基于C的函数, 所以要用到runtime的函数必须导入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#import &lt;objc/objc-runtime.h&gt; // 模拟器</div></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#import &lt;objc/runtime.h&gt; // 真机</div><div class="line">#import &lt;objc/message.h&gt; // 真机</div></pre></td></tr></table></figure></p>
<p>就像KVO一样, 系统是在程序运行的时候根据你要监听的类, 动态添加一个新类继承自该类, 然后重写原类的setter方法并在里面通知observer的.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">// 创建一个类(size_t extraBytes该参数通常指定为0, 该参数是分配给类和元类对象尾部的索引ivars的字节数。)</div><div class="line">Class clazz = objc_allocateClassPair([NSObject class], &quot;GoodPerson&quot;, 0);</div><div class="line"></div><div class="line">// 添加ivar</div><div class="line">// @encode(aType) : 返回该类型的内部表示字符串, 如@encode(int) -&gt; i</div><div class="line">class_addIvar(clazz, &quot;_name&quot;, sizeof(NSString *), log2(sizeof(NSString *)), @encode(NSString *));</div><div class="line"></div><div class="line">class_addIvar(clazz, &quot;_age&quot;, sizeof(NSUInteger), log2(sizeof(NSUInteger)), @encode(NSUInteger));</div><div class="line"></div><div class="line">// 注册该类</div><div class="line">objc_registerClassPair(clazz);</div><div class="line"></div><div class="line">// 创建实例对象</div><div class="line">id object = [[clazz alloc] init];</div><div class="line"></div><div class="line">// 设置ivar</div><div class="line">[object setValue:@&quot;Tracy&quot; forKey:@&quot;name&quot;];</div><div class="line"></div><div class="line">Ivar ageIvar = class_getInstanceVariable(clazz, &quot;_age&quot;);</div><div class="line">object_setIvar(object, ageIvar, @18);</div><div class="line"></div><div class="line">// 打印对象的类和内存地址</div><div class="line">NSLog(@&quot;%@&quot;, object);</div><div class="line"></div><div class="line">// 打印对象的属性值</div><div class="line">NSLog(@&quot;name = %@, age = %@&quot;, [object valueForKey:@&quot;name&quot;], object_getIvar(object, ageIvar));</div><div class="line"></div><div class="line">// 当类或者它的子类的实例还存在，则不能调用objc_disposeClassPair方法</div><div class="line">object = nil;</div><div class="line"></div><div class="line">// 销毁类</div><div class="line">objc_disposeClassPair(clazz);</div></pre></td></tr></table></figure></p>
<p>运行结果为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2016-09-04 17:04:08.328 Runtime-实践篇[13699:1043458] &lt;GoodPerson: 0x1002039b0&gt;</div><div class="line">2016-09-04 17:04:08.329 Runtime-实践篇[13699:1043458] name = Tracy, age = 18</div></pre></td></tr></table></figure>
<p>这样, 我们就在程序运行时动态添加了一个继承自NSObject的GoodPerson类, 并为该类添加了name和age成员变量. 这里我们需要注意的是, 添加成员变量的<code>class_addIvar</code>方法必须要在<code>objc_allocateClassPair</code>和<code>objc_registerClassPair</code>之间调用才行, 这里涉及到OC中类的成员变量的偏移量, 如果在类注册之后再addIvar的话会破坏原来类成员变量正确的偏移量, 这样的话会导致你访问的那个成员变量并不是你想访问的成员变量, 如图 :</p>
<p><img src="https://user-gold-cdn.xitu.io/2017/12/19/1606cd74e62a17d5?w=683&amp;h=229&amp;f=png&amp;s=13971" alt="在类中新增另一个实例变量前后的数据布局图"></p>
<p>大家可以试试把<code>class_addIvar</code>方法放在<code>objc_registerClassPair</code>方法之后执行, 看看会发生什么? (用KVC赋值和取值直接报错, 用getIvar的话取值为null)</p>
<p><a href="http://www.jianshu.com/p/3e050ec3b759" target="_blank" rel="external">Objective-C中的Runtime LeeJay</a></p>
<p>一、动态的创建一个类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// 创建一个名为People的类，它是NSObject的子类</div><div class="line">Class People = objc_allocateClassPair([NSObject class], &quot;People&quot;, 0);</div><div class="line"></div><div class="line">// 为该类添加一个eat的方法</div><div class="line">class_addMethod(People, NSSelectorFromString(@&quot;eat&quot;), (IMP) eatFun, &quot;v@:&quot;);</div><div class="line"></div><div class="line">// 注册该类</div><div class="line">objc_registerClassPair(People);</div><div class="line"></div><div class="line">// 创建一个People的实例对象p</div><div class="line">id p = [[People alloc] init];</div><div class="line"></div><div class="line">// 调用eat方法</div><div class="line">[p performSelector:@selector(eat)];</div></pre></td></tr></table></figure></p>
<h2 id="五-打印一个类的所有ivar-property-和-method"><a href="#五-打印一个类的所有ivar-property-和-method" class="headerlink" title="五. 打印一个类的所有ivar, property 和 method"></a>五. 打印一个类的所有ivar, property 和 method</h2><p><a href="http://www.jianshu.com/p/d6a2656fc2cb" target="_blank" rel="external">iOS-Runtime-实践篇</a></p>
<p>这个还是比较简单的, 应该直接看代码都能看懂<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">Person *p = [[Person alloc] init];</div><div class="line">[p setValue:@&quot;Kobe&quot; forKey:@&quot;name&quot;];</div><div class="line">[p setValue:@18 forKey:@&quot;age&quot;];</div><div class="line">//    p.address = @&quot;广州大学城&quot;;</div><div class="line">p.weight = 110.0f;</div><div class="line"></div><div class="line">// 1.打印所有ivars</div><div class="line">unsigned int ivarCount = 0;</div><div class="line">// 用一个字典装ivarName和value</div><div class="line">NSMutableDictionary *ivarDict = [NSMutableDictionary dictionary];</div><div class="line">Ivar *ivarList = class_copyIvarList([p class], &amp;ivarCount);</div><div class="line">for(int i = 0; i &lt; ivarCount; i++)&#123;</div><div class="line">NSString *ivarName = [NSString stringWithUTF8String:ivar_getName(ivarList[i])];</div><div class="line">id value = [p valueForKey:ivarName];</div><div class="line"></div><div class="line">if (value) &#123;</div><div class="line">ivarDict[ivarName] = value;</div><div class="line">&#125; else &#123;</div><div class="line">ivarDict[ivarName] = @&quot;值为nil&quot;;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">// 打印ivar</div><div class="line">for (NSString *ivarName in ivarDict.allKeys) &#123;</div><div class="line">NSLog(@&quot;ivarName:%@, ivarValue:%@&quot;,ivarName, ivarDict[ivarName]);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 2.打印所有properties</div><div class="line">unsigned int propertyCount = 0;</div><div class="line">// 用一个字典装propertyName和value</div><div class="line">NSMutableDictionary *propertyDict = [NSMutableDictionary dictionary];</div><div class="line">objc_property_t *propertyList = class_copyPropertyList([p class], &amp;propertyCount);</div><div class="line">for(int j = 0; j &lt; propertyCount; j++)&#123;</div><div class="line">NSString *propertyName = [NSString stringWithUTF8String:property_getName(propertyList[j])];</div><div class="line">id value = [p valueForKey:propertyName];</div><div class="line"></div><div class="line">if (value) &#123;</div><div class="line">propertyDict[propertyName] = value;</div><div class="line">&#125; else &#123;</div><div class="line">propertyDict[propertyName] = @&quot;值为nil&quot;;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">// 打印property</div><div class="line">for (NSString *propertyName in propertyDict.allKeys) &#123;</div><div class="line">NSLog(@&quot;propertyName:%@, propertyValue:%@&quot;,propertyName, propertyDict[propertyName]);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 3.打印所有methods</div><div class="line">unsigned int methodCount = 0;</div><div class="line">// 用一个字典装methodName和arguments</div><div class="line">NSMutableDictionary *methodDict = [NSMutableDictionary dictionary];</div><div class="line">Method *methodList = class_copyMethodList([p class], &amp;methodCount);</div><div class="line">for(int k = 0; k &lt; methodCount; k++)&#123;</div><div class="line">SEL methodSel = method_getName(methodList[k]);</div><div class="line">NSString *methodName = [NSString stringWithUTF8String:sel_getName(methodSel)];</div><div class="line"></div><div class="line">unsigned int argumentNums = method_getNumberOfArguments(methodList[k]);</div><div class="line"></div><div class="line">methodDict[methodName] = @(argumentNums - 2); // -2的原因是每个方法内部都有self 和 selector 两个参数</div><div class="line">&#125;</div><div class="line">// 打印method</div><div class="line">for (NSString *methodName in methodDict.allKeys) &#123;</div><div class="line">NSLog(@&quot;methodName:%@, argumentsCount:%@&quot;, methodName, methodDict[methodName]);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>打印结果为 :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">2016-09-04 17:06:49.070 Runtime-实践篇[13723:1044813] ivarName:_name, ivarValue:Kobe</div><div class="line">2016-09-04 17:06:49.071 Runtime-实践篇[13723:1044813] ivarName:_age, ivarValue:18</div><div class="line">2016-09-04 17:06:49.071 Runtime-实践篇[13723:1044813] ivarName:_weight, ivarValue:110</div><div class="line">2016-09-04 17:06:49.072 Runtime-实践篇[13723:1044813] ivarName:_address, ivarValue:值为nil</div><div class="line">2016-09-04 17:06:49.072 Runtime-实践篇[13723:1044813] propertyName:address, propertyValue:值为nil</div><div class="line">2016-09-04 17:06:49.072 Runtime-实践篇[13723:1044813] propertyName:weight, propertyValue:110</div><div class="line">2016-09-04 17:06:49.073 Runtime-实践篇[13723:1044813] methodName:setWeight:, argumentsCount:1</div><div class="line">2016-09-04 17:06:49.073 Runtime-实践篇[13723:1044813] methodName:weight, argumentsCount:0</div><div class="line">2016-09-04 17:06:49.074 Runtime-实践篇[13723:1044813] methodName:setAddress:, argumentsCount:1</div><div class="line">2016-09-04 17:06:49.074 Runtime-实践篇[13723:1044813] methodName:address, argumentsCount:0</div><div class="line">2016-09-04 17:06:49.074 Runtime-实践篇[13723:1044813] methodName:.cxx_destruct, argumentsCount:0</div></pre></td></tr></table></figure></p>
<p>前面2节主要是熟悉runtime的函数调用, 毕竟有许多函数前缀<code>objc</code>, <code>class</code>, <code>object</code>等等. 其实这里面也有规律 :</p>
<ul>
<li><code>objc_</code>: 高于类的操作, 例如添加类, 注册类, 销毁类还有许多高于一个类本身的操作一般都是objc开头</li>
<li><code>class</code> : 对类的内部进行修改的, 例如添加ivar, 添加property, 添加method等等</li>
<li><code>object</code> : 对某个对象进行修改, 例如设置ivar值, 获取ivar值, 设置property值, 获取property值, 调用某个method等等</li>
<li><code>ivar</code>, <code>property</code>, <code>method</code> : 这三个方法大家可以手动去敲敲看一看</li>
</ul>
<h2 id="六-动态添加方法"><a href="#六-动态添加方法" class="headerlink" title="六. 动态添加方法"></a>六. 动态添加方法</h2><p>涉及方法:<br><code>performSelector</code>  <code>resolveInstanceMethod</code> <code>class_addMethod</code></p>
<p><a href="http://www.jianshu.com/p/e071206103a4" target="_blank" rel="external">让你快速上手Runtime 袁峥</a></p>
<ul>
<li><code>开发使用场景</code>：如果一个类方法非常多，加载类到内存的时候也比较耗费资源，需要给每个方法生成映射表，可以使用动态给某个类，添加方法解决。</li>
<li><code>经典面试题</code>：有没有使用performSelector，其实主要想问你有没有动态添加过方法。</li>
<li><code>简单使用</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">[super viewDidLoad];</div><div class="line">// Do any additional setup after loading the view, typically from a nib.</div><div class="line"></div><div class="line">Person *p = [[Person alloc] init];</div><div class="line"></div><div class="line">// 默认person，没有实现eat方法，可以通过performSelector调用，但是会报错。</div><div class="line">// 动态添加方法就不会报错</div><div class="line">[p performSelector:@selector(eat)];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line">@implementation Person</div><div class="line">// void(*)()</div><div class="line">// 默认方法都有两个隐式参数，</div><div class="line">void eat(id self,SEL sel)</div><div class="line">&#123;</div><div class="line">NSLog(@&quot;%@ %@&quot;,self,NSStringFromSelector(sel));</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 当一个对象调用未实现的方法，会调用这个方法处理,并且会把对应的方法列表传过来.</div><div class="line">// 刚好可以用来判断，未实现的方法是不是我们想要动态添加的方法</div><div class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</div><div class="line">&#123;</div><div class="line"></div><div class="line">if (sel == @selector(eat)) &#123;</div><div class="line">// 动态添加eat方法</div><div class="line"></div><div class="line">// 第一个参数：给哪个类添加方法</div><div class="line">// 第二个参数：添加方法的方法编号</div><div class="line">// 第三个参数：添加方法的函数实现（函数地址）</div><div class="line">// 第四个参数：函数的类型，(返回值+参数类型) v:void @:对象-&gt;self :表示SEL-&gt;_cmd</div><div class="line">class_addMethod(self, @selector(eat), eat, &quot;v@:&quot;);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">return [super resolveInstanceMethod:sel];</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="动态添加方法实现"><a href="#动态添加方法实现" class="headerlink" title="动态添加方法实现"></a>动态添加方法实现</h3><p><a href="http://www.jianshu.com/p/d6a2656fc2cb" target="_blank" rel="external">iOS-Runtime-实践篇</a></p>
<p>好了, 绕来绕去又回到了runtime强大的消息转发身上了, 当一个方法没有实现的时候, OC会怎么做的呢? 还记得那四个步骤吗, 不记得也没关系, 我们看代码!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">Person类只有- (void)noIMPMethod方法的声明,</div><div class="line">没有他的实现, 一般来说程序运行, 调用noIMPMethod这个方法, 肯定要报错的,</div><div class="line">我们可以在这个方法里动态添加该方法的实现</div><div class="line">*/</div><div class="line"></div><div class="line">// 用来实现noIMPMethod方法实现的函数</div><div class="line">void otherFunction(id self, SEL cmd)</div><div class="line">&#123;</div><div class="line">NSLog(@&quot;动态处理了noIMPMethod方法的实现&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 第一步, 对象在收到无法解读的消息后, 首先调用其所属类的这个类方法</div><div class="line">// 返回YES则结束消息转发, 返回NO则进入下一步</div><div class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</div><div class="line">&#123;</div><div class="line">// 如果是noIMPMethod方法</div><div class="line">if([NSStringFromSelector(sel) isEqualToString:@&quot;noIMPMethod&quot;])&#123;</div><div class="line">// 动态添加方法实现</div><div class="line">class_addMethod([self class], sel, (IMP)otherFunction, &quot;v@:&quot;);</div><div class="line">return YES;</div><div class="line">&#125; else &#123;</div><div class="line">return [super resolveInstanceMethod:sel];</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>程序运行结果 :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2016-09-04 17:38:24.301 Runtime-实践篇[13856:1054351] 动态处理了noIMPMethod方法的实现</div><div class="line">代码应该也很明了, 当判断到无法解读的SEL后, 可以给该SEL动态添加方法的实现.</div></pre></td></tr></table></figure></p>
<p><em>ps : 消息转发的另外3个方法会在下文放上, 因为本例子用不上所以就不放上来了</em></p>
<p><a href="http://www.jianshu.com/p/3e050ec3b759" target="_blank" rel="external">Objective-C中的Runtime LeeJay</a></p>
<p>二、动态的给某个类添加方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</div><div class="line">&#123;</div><div class="line">if ([NSStringFromSelector(sel) isEqualToString:@&quot;doSomething&quot;])</div><div class="line">&#123;</div><div class="line">class_addMethod(self, sel, (IMP) doSomething, &quot;v@:@&quot;);</div><div class="line">&#125;</div><div class="line">return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>动态的给某个类添加方法，<code>class_addMethod</code>的参数：<br>self：给哪个类添加方法<br>sel：添加方法的方法编号（选择子）<br>IMP：添加方法的函数实现(函数地址)<br>types 函数的类型,(返回值+参数类型) v:void @:对象-&gt;self :表示SEL-&gt;_cmd</p>
</blockquote>
<p><a href="http://blog.csdn.net/deft_mkjing/article/details/53789125" target="_blank" rel="external">Runtime基本知识点以及应用场景</a></p>
<p>动态添加方法</p>
<p>通常做法都是在resolve方法内部指定sel的IMP，前提是该方法未实现会被拦截下来，就能实现动态创建的过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">void run (id self, SEL _cmd,NSNumber *meter,NSString *name)</div><div class="line">&#123;</div><div class="line">// implementation .....</div><div class="line">NSLog(@&quot;%@跑了%@&quot;,name,meter);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">//对实现(abc)的前两个参数的说明</div><div class="line">//每个方法的内部都默认包含两个参数，被称为隐式参数</div><div class="line">//id类型self(代表类或对象)和SEL类型的_cmd(方法编号)</div><div class="line">//class_addMethod函数参数的含义:</div><div class="line">//第一个参数Class cls, 类型</div><div class="line">//第二个参数SEL name, 被解析的方法</div><div class="line">//第三个参数 IMP imp, 指定的实现</div><div class="line">//第四个参数const char *types,方法的类型，具体参照类型的codeType那张图，但是要注意一点：Since the function must take at least two arguments—self and _cmd, the second and third characters must be “@:” (the first character is the return type).译为：因为函数必须至少有两个参数self和_cmd,第二个和第三个字符必须是“@:”。如果想要再增加参数，就可以从实现的第三个参数算起，看下面的例子就明白。</div><div class="line">// 当调用有未实现的实例方法的时候会进到这里来</div><div class="line">+ (BOOL) resolveInstanceMethod:(SEL)aSEL</div><div class="line">&#123;</div><div class="line">// 多参数就是&quot;run:&quot;无参数就是run</div><div class="line">if (aSEL == @selector(run:))</div><div class="line">&#123;</div><div class="line">class_addMethod([self class], aSEL, (IMP) run, &quot;v@:@:@&quot;);// 增加了2个对象类型参数 增加了@</div><div class="line">return YES;</div><div class="line">&#125;</div><div class="line">//    return [super resolveInstanceMethod:aSEL];</div><div class="line">return YES;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 当调用类方法未实现的时候+ (BOOL)resolveClassMethod:(SEL)sel 在这里拦截</div><div class="line">+ (BOOL)resolveClassMethod:(SEL)sel</div><div class="line">&#123;</div><div class="line">NSLog(@&quot;类方法未实现&quot;);</div><div class="line">return NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="七-消息转发"><a href="#七-消息转发" class="headerlink" title="七. 消息转发"></a>七. 消息转发</h2><p>动态消息转发<br>和上面一样我们创建的对象调用未实现的方法时，类和实例变量的内部是可以这样进行转发的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">#pragma mark - 对象方法</div><div class="line">// 没有实现firstMethod的方法</div><div class="line"></div><div class="line">// 1. 在没有找到方法时，会先调用此方法，和DynicmicInsatance的方法一样就可以动态添加方法3</div><div class="line">//    返回YES 表示响应的Selector的实现已经被找到并添加到子类中了</div><div class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</div><div class="line">&#123;</div><div class="line">//    if (sel == @selector(touch)) &#123;</div><div class="line">//        class_addMethod([self class], sel, (IMP)touch, &quot;v@:&quot;);</div><div class="line">//    &#125;</div><div class="line">return YES;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 2.第二步</div><div class="line">//   第一步里面返回之后没有添加新方法，该方法就会被调用，在这个方法中，我们可以指定一个可以返回一个响应方法的独享</div><div class="line">//   不能返回Self 死循环</div><div class="line">- (id)forwardingTargetForSelector:(SEL)aSelector</div><div class="line">&#123;</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 3.第三步</div><div class="line">//   如果上面返回了nil则该方法会被调用，给系统一个需要的编码</div><div class="line">//   如果这里放回的是nil，那是无法执行下一波的，下次无法得到处理</div><div class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</div><div class="line">&#123;</div><div class="line">return [NSMethodSignature signatureWithObjCTypes:&quot;v@:&quot;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 4.第四步</div><div class="line">// 调用转发消息方法</div><div class="line">- (void)second</div><div class="line">&#123;</div><div class="line">NSLog(@&quot;对象方法first方法未被调用，消息转发成了second方法&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 该方法不进行重写就直接进入第五步</div><div class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation</div><div class="line">&#123;</div><div class="line">[anInvocation setSelector:@selector(second)];</div><div class="line">[anInvocation invokeWithTarget:self];</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 5.第五步</div><div class="line">// 如果没有调用第四步的转发，那么会进入异常</div><div class="line">- (void)doesNotRecognizeSelector:(SEL)aSelector</div><div class="line">&#123;</div><div class="line"></div><div class="line">NSLog(@&quot;无法处理的消息:%@&quot;,NSStringFromSelector(aSelector));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>先在这里拦截resolveInstanceMethod</li>
<li>第一步未动态添加的话就调用forwardingTargetForSelector</li>
<li>第二步返回nil来到这里调用methodSignatureForSelector签名</li>
<li>重定向消息指针，实现消息转发</li>
<li>如果没有实现第四步就doesNotRecognizeSelector异常</li>
</ul>
<h2 id="八-更换方法调用者"><a href="#八-更换方法调用者" class="headerlink" title="八. 更换方法调用者"></a>八. 更换方法调用者</h2><p><a href="http://www.jianshu.com/p/d6a2656fc2cb" target="_blank" rel="external">iOS-Runtime-实践篇  Jerry4me</a></p>
<p>试想一下, 一个腿部残疾的人, 他想跑, runtime知道他自己跑不了, 于是就让他的狗替代他去跑了(person没有run方法的声明和实现, dog有run方法的声明和实现)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">// 第一步, 对象在收到无法解读的消息后, 首先调用其所属类的这个类方法</div><div class="line">// 返回YES则结束消息转发, 返回NO则进入下一步</div><div class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</div><div class="line">&#123;</div><div class="line">return NO;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 第二步, 动态方法解析失败, 则调用这个方法</div><div class="line">// 返回的对象将处理该selector, 返回nil则进入下一步</div><div class="line">- (id)forwardingTargetForSelector:(SEL)aSelector</div><div class="line">&#123;</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 第三步, 在这里返回方法的消息签名</div><div class="line">// 返回YES则进入下一步, 返回nil则结束消息转发</div><div class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</div><div class="line">&#123;</div><div class="line">if ([NSStringFromSelector(aSelector) isEqualToString:@&quot;run&quot;])&#123;</div><div class="line">return [NSMethodSignature signatureWithObjCTypes:&quot;v@:&quot;];</div><div class="line">&#125; else &#123;</div><div class="line">return [super methodSignatureForSelector:aSelector];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 第四步, 最后一次处理该消息的机会</div><div class="line">// 这里处理不了这个invocation就会结束消息转发</div><div class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation</div><div class="line">&#123;</div><div class="line">// 在这我们修改调用该方法的对象</div><div class="line">Dog *dog = [[Dog alloc] init];</div><div class="line">// 让dog去调用该方法</div><div class="line">[anInvocation invokeWithTarget:dog];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>那么我们通过<code>((void(*)(id, SEL))objc_msgSend)((id)p, @selector(run)); // 这里强转是为了不让编译器报参数过多的错误方法</code>调用person的run方法, 得到的输出为 :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2016-09-04 17:49:42.634 Runtime-实践篇[13939:1059419] 是狗在跑步</div></pre></td></tr></table></figure></p>
<p>同样, 其实可以在第二部就把这件事做了, 只需返回dog实例即可, 大家可以亲手操作试试</p>
<h2 id="九-更改特定方法的实现"><a href="#九-更改特定方法的实现" class="headerlink" title="九. 更改特定方法的实现"></a>九. 更改特定方法的实现</h2><p><a href="http://www.jianshu.com/p/d6a2656fc2cb" target="_blank" rel="external">iOS-Runtime-实践篇  Jerry4me</a></p>
<p>一条狗在吃着骨头, 然后他的主人一把把一个球扔得远远的, 碍于主人的淫威之下, 狗就不得不停下来跑去捡球了(<code>更改[dog eat]方法的实现为[dog run]</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">// 第一步, 对象在收到无法解读的消息后, 首先调用其所属类的这个类方法</div><div class="line">// 返回YES则结束消息转发, 返回NO则进入下一步</div><div class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</div><div class="line">&#123;</div><div class="line">return NO;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 第二步, 动态方法解析失败, 则调用这个方法</div><div class="line">// 返回的对象将处理该selector, 返回nil则进入下一步</div><div class="line">- (id)forwardingTargetForSelector:(SEL)aSelector</div><div class="line">&#123;</div><div class="line">return nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 第三步, 在这里返回方法的消息签名</div><div class="line">// 返回YES则进入下一步, 返回nil则结束消息转发</div><div class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</div><div class="line">&#123;</div><div class="line">if ([NSStringFromSelector(aSelector) isEqualToString:@&quot;eat&quot;])&#123;</div><div class="line">return [NSMethodSignature signatureWithObjCTypes:&quot;v@:&quot;];</div><div class="line">&#125; else &#123;</div><div class="line">return [super methodSignatureForSelector:aSelector];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 第四步, 最后一次处理该消息的机会</div><div class="line">// 这里处理不了这个invocation就会结束消息转发</div><div class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation</div><div class="line">&#123;</div><div class="line">// 在这我们修改选择子为run</div><div class="line">[anInvocation setSelector:@selector(run)];</div><div class="line">// 让dog去调用该方法</div><div class="line">[anInvocation invokeWithTarget:self];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>((void(*)(id, SEL))objc_msgSend)((id)dog, @selector(eat));</code>的输出结果为 :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2016-09-04 17:56:53.238 Runtime-实践篇[14037:1063170] 是狗在跑步</div></pre></td></tr></table></figure></p>
<p>demo在这里<br><a href="https://link.jianshu.com/?t=https://github.com/Jerry4me/Runtime-demo" target="_blank" rel="external">Github</a></p>
<ol>
<li>动态添加一个类</li>
<li>打印一个类的所有ivar, property 和 method</li>
<li>给分类增加属性</li>
<li>动态添加方法实现</li>
<li>更换方法调用者</li>
<li>更改特定方法的实现</li>
</ol>
<h2 id="十-归档"><a href="#十-归档" class="headerlink" title="十. 归档"></a>十. 归档</h2><p>涉及方法:<br><code>class_copyIvarList</code> <code>ignoredIvarNames</code> <code>objc_setAssociatedObject</code> <code>objc_getAssociatedObject</code></p>
<p><a href="http://www.jianshu.com/p/3e050ec3b759" target="_blank" rel="external">Objective-C中的Runtime LeeJay</a></p>
<p>五、归档<br>大家都知道在归档的时候，需要先将属性一个一个的归档，然后再将属性一个一个的解档，3-5个属性还好，假如100个怎么办，那不得写累死。有了Runtime，就不用担心这个了，下面就是如何利用Runtime实现自动归档和解档。<br>NSObject+Archive.h文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@interface NSObject (Archive)</div><div class="line"></div><div class="line">/**</div><div class="line">*  归档</div><div class="line">*/</div><div class="line">- (void)encode:(NSCoder *)aCoder;</div><div class="line"></div><div class="line">/**</div><div class="line">*  解档</div><div class="line">*/</div><div class="line">- (void)decode:(NSCoder *)aDecoder;</div><div class="line"></div><div class="line">/**</div><div class="line">*  这个数组中的成员变量名将会被忽略：不进行归档</div><div class="line">*/</div><div class="line">@property (nonatomic, strong) NSArray *ignoredIvarNames;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>NSObject+Archive.m文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">#import &quot;NSObject+Archive.h&quot;</div><div class="line">#import &lt;objc/runtime.h&gt;</div><div class="line"></div><div class="line">@implementation NSObject (Archive)</div><div class="line"></div><div class="line">- (void)encode:(NSCoder *)aCoder</div><div class="line">&#123;</div><div class="line">unsigned int outCount = 0;</div><div class="line">Ivar *ivars = class_copyIvarList([self class], &amp;outCount);</div><div class="line">for (unsigned int i = 0; i &lt; outCount; i++)</div><div class="line">&#123;</div><div class="line">Ivar ivar = ivars[i];</div><div class="line">NSString *key = [NSString stringWithUTF8String:ivar_getName(ivar)];</div><div class="line">if ([self.ignoredIvarNames containsObject:key])</div><div class="line">&#123;</div><div class="line">continue;</div><div class="line">&#125;</div><div class="line">id value = [self valueForKey:key];</div><div class="line">[aCoder encodeObject:value forKey:key];</div><div class="line">&#125;</div><div class="line">free(ivars);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)decode:(NSCoder *)aDecoder</div><div class="line">&#123;</div><div class="line">unsigned int outCount = 0;</div><div class="line">Ivar *ivars = class_copyIvarList([self class], &amp;outCount);</div><div class="line">for (unsigned int i = 0; i &lt; outCount; i++)</div><div class="line">&#123;</div><div class="line">Ivar ivar = ivars[i];</div><div class="line">NSString *key = [NSString stringWithUTF8String:ivar_getName(ivar)];</div><div class="line">if ([self.ignoredIvarNames containsObject:key])</div><div class="line">&#123;</div><div class="line">continue;</div><div class="line">&#125;</div><div class="line">id value = [aDecoder decodeObjectForKey:key];</div><div class="line">[self setValue:value forKey:key];</div><div class="line">&#125;</div><div class="line">free(ivars);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setIgnoredIvarNames:(NSArray *)ignoredIvarNames</div><div class="line">&#123;</div><div class="line">objc_setAssociatedObject(self,</div><div class="line">@selector(ignoredIvarNames),</div><div class="line">ignoredIvarNames,</div><div class="line">OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSArray *)ignoredIvarNames</div><div class="line">&#123;</div><div class="line">return objc_getAssociatedObject(self, _cmd);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>然后再去需要归档的类实现文件里面写上这几行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@implementation Person</div><div class="line"></div><div class="line">- (void)encodeWithCoder:(NSCoder *)aCoder</div><div class="line">&#123;</div><div class="line">[self encode:aCoder];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (instancetype)initWithCoder:(NSCoder *)aDecoder</div><div class="line">&#123;</div><div class="line">if (self = [super init])</div><div class="line">&#123;</div><div class="line">[self decode:aDecoder];</div><div class="line">&#125;</div><div class="line">return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>这几行代码都是固定写法，你也可以把它们定义成宏，这样就可以实现一行代码就归档了，思路源自MJExtension！</p>
<p><a href="http://blog.csdn.net/deft_mkjing/article/details/53789125" target="_blank" rel="external">Runtime基本知识点以及应用场景 deft_mkjing</a></p>
<p>runtime实现归档和解档<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">self.fish = [NSKeyedUnarchiver unarchiveObjectWithFile:self.path];</div><div class="line">[NSKeyedArchiver archiveRootObject:self.fish toFile:self.path];</div></pre></td></tr></table></figure></p>
<p>当外部调用上面归档解档的代码时会走如下方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line">- (NSArray *)ignoredNames</div><div class="line">&#123;</div><div class="line">return @[];</div><div class="line">&#125;</div><div class="line">// 解档的时候调用</div><div class="line">- (instancetype)initWithCoder:(NSCoder *)aDecoder</div><div class="line">&#123;</div><div class="line">if (self == [super init]) &#123;</div><div class="line">[self mkj_initWithCoder:aDecoder];</div><div class="line">&#125;</div><div class="line">return self;</div><div class="line">&#125;</div><div class="line">// 归档的时候调用</div><div class="line">- (void)encodeWithCoder:(NSCoder *)aCoder</div><div class="line">&#123;</div><div class="line">[self mkj_encodeWithCoder:aCoder];</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - 普通模式下的归档和解档</div><div class="line">//实现NSCoding协议中的归档方法，需要一个个列出属性来</div><div class="line">//- (void)encodeWithCoder:(NSCoder *)aCoder &#123;</div><div class="line">//    [aCoder encodeObject:self.name forKey:@&quot;name&quot;];</div><div class="line">//    [aCoder encodeObject:self.age forKey:@&quot;age&quot;];</div><div class="line">//&#125;</div><div class="line">//</div><div class="line">//</div><div class="line">////实现NSCoding协议中的解档方法</div><div class="line">//- (nullable instancetype)initWithCoder:(NSCoder *)aDecoder &#123;</div><div class="line">//    if (self = [super init]) &#123;</div><div class="line">//        self.name = [aDecoder decodeObjectForKey:@&quot;name&quot;];</div><div class="line">//        self.age = [aDecoder decodeObjectForKey:@&quot;age&quot;];</div><div class="line">//    &#125;</div><div class="line">//    return self;</div><div class="line">//&#125;</div><div class="line">- (NSArray *)ignoredProperty</div><div class="line">&#123;</div><div class="line">return @[];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)mkj_encodeWithCoder:(NSCoder *)aCoder</div><div class="line">&#123;</div><div class="line">Class selfClass = self.class;</div><div class="line">while (selfClass &amp;&amp; selfClass != [NSObject class]) &#123;</div><div class="line">unsigned int count = 0;</div><div class="line">Ivar *ivars = class_copyIvarList(selfClass, &amp;count);</div><div class="line">for (NSInteger i = 0; i &lt; count; i ++)</div><div class="line">&#123;</div><div class="line">Ivar ivar = ivars[i];</div><div class="line">const char *ivarName = ivar_getName(ivar);</div><div class="line">NSString *ivarStr = [[NSString stringWithUTF8String:ivarName] substringFromIndex:1];</div><div class="line">if ([self respondsToSelector:@selector(ignoredProperty)]) &#123;</div><div class="line">// 如果归档key为空</div><div class="line">if ([[self ignoredProperty] containsObject:ivarStr]) &#123;</div><div class="line">continue;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">id value = [self valueForKey:ivarStr];</div><div class="line">[aCoder encodeObject:value forKey:ivarStr];</div><div class="line">&#125;</div><div class="line">free(ivars);</div><div class="line">selfClass = [selfClass superclass];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)mkj_initWithCoder:(NSCoder *)aDecoder</div><div class="line">&#123;</div><div class="line">Class selfClass = self.class;</div><div class="line">while (selfClass &amp;&amp; selfClass != [NSObject class]) &#123;</div><div class="line">unsigned int count = 0;</div><div class="line">Ivar *ivars = class_copyIvarList(selfClass, &amp;count);</div><div class="line">for (NSInteger i = 0; i &lt; count; i ++)</div><div class="line">&#123;</div><div class="line">Ivar ivar = ivars[i];</div><div class="line">const char *ivarName = ivar_getName(ivar);</div><div class="line">NSString *ivarStr = [[NSString stringWithUTF8String:ivarName] substringFromIndex:1];</div><div class="line">if ([self respondsToSelector:@selector(ignoredProperty)]) &#123;</div><div class="line">// 如果归档key为空</div><div class="line">if ([[self ignoredProperty] containsObject:ivarStr]) &#123;</div><div class="line">continue;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">id value = [aDecoder decodeObjectForKey:ivarStr];</div><div class="line">[self setValue:value forKey:ivarStr];</div><div class="line"></div><div class="line">&#125;</div><div class="line">free(ivars);</div><div class="line">selfClass = [selfClass superclass];</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="十一"><a href="#十一" class="headerlink" title="十一"></a>十一</h2><p><a href="http://www.jianshu.com/p/d39f7d22db6c" target="_blank" rel="external">轻松学习之二——iOS利用Runtime自定义控制器POP手势动画 J_雨 </a><br>利用runtime获取系统手势的target和action<br><code>class_copyIvarList</code></p>
<h2 id="十二"><a href="#十二" class="headerlink" title="十二"></a>十二</h2><p><a href="http://www.jianshu.com/p/b3789d4580ac" target="_blank" rel="external">runtime运用 -从一个模型中找出所有属性赋值给另外一个模型 醋溜草莓便当</a></p>
<p><code>objc_property_t</code> <code>class_copyPropertyList</code> <code>property_getName</code></p>
<h2 id="十三"><a href="#十三" class="headerlink" title="十三"></a>十三</h2><p>热修复 JSPatch</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/17/hello-world/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/17/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-17T18:53:39+08:00">
                2016-11-17
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="John Doe" />
          <p class="site-author-name" itemprop="name">John Doe</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  

  


</body>
</html>
